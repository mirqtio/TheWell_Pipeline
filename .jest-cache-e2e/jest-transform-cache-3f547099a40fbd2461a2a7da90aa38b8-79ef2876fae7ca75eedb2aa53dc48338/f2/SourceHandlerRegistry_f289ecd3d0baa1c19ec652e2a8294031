5e2c64ff1a8c16c1c4fbad15a062d7a5
const {
  EventEmitter
} = require('events');
const SourceHandlerFactory = require('./SourceHandlerFactory');

/**
 * Registry for managing source handlers
 */
class SourceHandlerRegistry extends EventEmitter {
  constructor(factory = null, logger = null) {
    super();
    this.factory = factory || new SourceHandlerFactory();
    this.logger = logger || console;
    this.handlers = new Map();
    this.enabledHandlers = new Set();
    this.stats = {
      totalHandlers: 0,
      activeHandlers: 0,
      discoveredDocuments: 0,
      processedDocuments: 0
    };
  }

  /**
   * Register a handler with the registry
   */
  async registerHandler(config) {
    if (!config || !config.id) {
      throw new Error('Handler configuration with id is required');
    }
    if (this.handlers.has(config.id)) {
      throw new Error(`Handler with ID ${config.id} is already registered`);
    }

    // Validate configuration
    await this.factory.validateConfig(config);

    // Create handler instance
    const handler = this.factory.createHandler(config);

    // Initialize handler
    await handler.initialize();

    // Store handler
    this.handlers.set(config.id, handler);

    // Add to enabled handlers if enabled
    if (config.enabled !== false) {
      this.enabledHandlers.add(config.id);
      this.stats.activeHandlers++;
    }
    this.stats.totalHandlers++;
    this.emit('handlerRegistered', {
      id: config.id,
      type: config.type
    });
    return handler;
  }

  /**
   * Unregister a handler
   */
  async unregisterHandler(handlerId) {
    const handler = this.handlers.get(handlerId);
    if (!handler) {
      throw new Error(`Handler with ID ${handlerId} not found`);
    }

    // Cleanup handler
    if (typeof handler.cleanup === 'function') {
      await handler.cleanup();
    }

    // Remove from registry
    this.handlers.delete(handlerId);
    this.enabledHandlers.delete(handlerId);
    this.stats.totalHandlers--;
    if (this.stats.activeHandlers > 0) {
      this.stats.activeHandlers--;
    }
    this.emit('handlerUnregistered', {
      id: handlerId
    });
    return true;
  }

  /**
   * Get a handler by id
   */
  getHandler(handlerId) {
    return this.handlers.get(handlerId) || null;
  }

  /**
   * Get all registered handlers
   */
  getAllHandlers() {
    return Array.from(this.handlers.values());
  }

  /**
   * Get enabled handlers
   */
  getEnabledHandlers() {
    return Array.from(this.enabledHandlers).map(id => this.handlers.get(id)).filter(handler => handler);
  }

  /**
   * Enable a handler
   */
  enableHandler(handlerId) {
    if (!this.handlers.has(handlerId)) {
      throw new Error(`Handler ${handlerId} not found`);
    }
    const handler = this.handlers.get(handlerId);
    const wasEnabled = this.enabledHandlers.has(handlerId);
    this.enabledHandlers.add(handlerId);
    handler.config.enabled = true;
    if (!wasEnabled) {
      this.stats.activeHandlers++;
      this.logger.info('Handler enabled', {
        handlerId
      });
      this.emit('handlerEnabled', {
        id: handlerId
      });
    }
    return true;
  }

  /**
   * Disable a handler
   */
  disableHandler(handlerId) {
    if (!this.handlers.has(handlerId)) {
      throw new Error(`Handler ${handlerId} not found`);
    }
    const handler = this.handlers.get(handlerId);
    const wasEnabled = this.enabledHandlers.has(handlerId);
    this.enabledHandlers.delete(handlerId);
    handler.config.enabled = false;
    if (wasEnabled) {
      this.stats.activeHandlers--;
      this.logger.info('Handler disabled', {
        handlerId
      });
      this.emit('handlerDisabled', {
        id: handlerId
      });
    }
    return true;
  }

  /**
   * Check if handler is enabled
   */
  isHandlerEnabled(handlerId) {
    return this.enabledHandlers.has(handlerId);
  }

  /**
   * Register multiple handlers
   */
  async registerHandlers(configs) {
    if (!Array.isArray(configs)) {
      throw new Error('Configurations must be an array');
    }
    const results = [];
    for (const config of configs) {
      try {
        const handler = await this.registerHandler(config);
        results.push({
          success: true,
          id: config.id,
          handler
        });
      } catch (error) {
        results.push({
          success: false,
          id: config.id,
          error: error.message
        });
      }
    }
    return results;
  }

  /**
   * Discover documents from all enabled handlers
   */
  async discoverAll() {
    const enabledHandlers = this.getEnabledHandlers();
    const results = [];
    for (const handler of enabledHandlers) {
      try {
        const documents = await handler.discover();
        if (Array.isArray(documents)) {
          results.push({
            success: true,
            handlerId: handler.config?.id,
            documents: documents
          });
          this.stats.discoveredDocuments += documents.length;
        } else {
          results.push({
            success: false,
            handlerId: handler.config?.id,
            documents: [],
            error: 'Handler did not return array of documents'
          });
        }
      } catch (error) {
        // Log error but continue with other handlers
        this.logger.error(`Handler discovery failed for ${handler.config?.id}:`, error.message);
        results.push({
          success: false,
          handlerId: handler.config?.id,
          documents: [],
          error: error.message
        });
      }
    }
    return results;
  }

  /**
   * Cleanup all handlers
   */
  async cleanup() {
    const handlers = Array.from(this.handlers.values());
    for (const handler of handlers) {
      try {
        if (typeof handler.cleanup === 'function') {
          await handler.cleanup();
        }
      } catch (error) {
        // Log error but continue cleanup
        this.logger.error(`Error cleaning up handler: ${error.message}`);
      }
    }
    this.handlers.clear();
    this.enabledHandlers.clear();
    this.stats = {
      totalHandlers: 0,
      activeHandlers: 0,
      discoveredDocuments: 0,
      processedDocuments: 0
    };
    this.emit('registryCleanup');
  }

  /**
   * Cleanup all handlers (alias for cleanup)
   */
  async cleanupAll() {
    return this.cleanup();
  }

  /**
   * Get registry statistics
   */
  getStats() {
    return {
      ...this.stats
    };
  }

  /**
   * Get detailed statistics (alias for compatibility)
   */
  getStatistics() {
    const handlersByType = {};
    for (const handler of this.handlers.values()) {
      const type = handler.config?.type || 'unknown';
      handlersByType[type] = (handlersByType[type] || 0) + 1;
    }
    return {
      totalHandlers: this.handlers.size,
      enabledHandlers: this.enabledHandlers.size,
      disabledHandlers: this.handlers.size - this.enabledHandlers.size,
      handlersByType,
      ...this.stats
    };
  }

  /**
   * Get handler count
   */
  getHandlerCount() {
    return this.handlers.size;
  }

  /**
   * Get enabled handler count
   */
  getEnabledHandlerCount() {
    return this.enabledHandlers.size;
  }

  /**
   * Get all handler IDs
   */
  getAllHandlerIds() {
    return Array.from(this.handlers.keys());
  }

  /**
   * Update handler configuration
   */
  async updateHandlerConfig(handlerId, newConfig) {
    const handler = this.handlers.get(handlerId);
    if (!handler) {
      throw new Error(`Handler ${handlerId} not found`);
    }

    // Validate new configuration
    await this.factory.validateConfig(newConfig);

    // Update handler configuration
    handler.config = {
      ...handler.config,
      ...newConfig
    };
    this.emit('handlerConfigUpdated', {
      id: handlerId,
      config: newConfig
    });
    return handler;
  }

  /**
   * Get handler by type
   */
  getHandlersByType(type) {
    return Array.from(this.handlers.values()).filter(handler => handler.config.type === type);
  }

  /**
   * Get handlers by visibility
   */
  getHandlersByVisibility(visibility) {
    return Array.from(this.handlers.values()).filter(handler => handler.config.visibility === visibility);
  }

  /**
   * Check if any handlers are registered
   */
  hasHandlers() {
    return this.handlers.size > 0;
  }
}
module.exports = SourceHandlerRegistry;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJyZXF1aXJlIiwiU291cmNlSGFuZGxlckZhY3RvcnkiLCJTb3VyY2VIYW5kbGVyUmVnaXN0cnkiLCJjb25zdHJ1Y3RvciIsImZhY3RvcnkiLCJsb2dnZXIiLCJjb25zb2xlIiwiaGFuZGxlcnMiLCJNYXAiLCJlbmFibGVkSGFuZGxlcnMiLCJTZXQiLCJzdGF0cyIsInRvdGFsSGFuZGxlcnMiLCJhY3RpdmVIYW5kbGVycyIsImRpc2NvdmVyZWREb2N1bWVudHMiLCJwcm9jZXNzZWREb2N1bWVudHMiLCJyZWdpc3RlckhhbmRsZXIiLCJjb25maWciLCJpZCIsIkVycm9yIiwiaGFzIiwidmFsaWRhdGVDb25maWciLCJoYW5kbGVyIiwiY3JlYXRlSGFuZGxlciIsImluaXRpYWxpemUiLCJzZXQiLCJlbmFibGVkIiwiYWRkIiwiZW1pdCIsInR5cGUiLCJ1bnJlZ2lzdGVySGFuZGxlciIsImhhbmRsZXJJZCIsImdldCIsImNsZWFudXAiLCJkZWxldGUiLCJnZXRIYW5kbGVyIiwiZ2V0QWxsSGFuZGxlcnMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJnZXRFbmFibGVkSGFuZGxlcnMiLCJtYXAiLCJmaWx0ZXIiLCJlbmFibGVIYW5kbGVyIiwid2FzRW5hYmxlZCIsImluZm8iLCJkaXNhYmxlSGFuZGxlciIsImlzSGFuZGxlckVuYWJsZWQiLCJyZWdpc3RlckhhbmRsZXJzIiwiY29uZmlncyIsImlzQXJyYXkiLCJyZXN1bHRzIiwicHVzaCIsInN1Y2Nlc3MiLCJlcnJvciIsIm1lc3NhZ2UiLCJkaXNjb3ZlckFsbCIsImRvY3VtZW50cyIsImRpc2NvdmVyIiwibGVuZ3RoIiwiY2xlYXIiLCJjbGVhbnVwQWxsIiwiZ2V0U3RhdHMiLCJnZXRTdGF0aXN0aWNzIiwiaGFuZGxlcnNCeVR5cGUiLCJzaXplIiwiZGlzYWJsZWRIYW5kbGVycyIsImdldEhhbmRsZXJDb3VudCIsImdldEVuYWJsZWRIYW5kbGVyQ291bnQiLCJnZXRBbGxIYW5kbGVySWRzIiwia2V5cyIsInVwZGF0ZUhhbmRsZXJDb25maWciLCJuZXdDb25maWciLCJnZXRIYW5kbGVyc0J5VHlwZSIsImdldEhhbmRsZXJzQnlWaXNpYmlsaXR5IiwidmlzaWJpbGl0eSIsImhhc0hhbmRsZXJzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIlNvdXJjZUhhbmRsZXJSZWdpc3RyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IEV2ZW50RW1pdHRlciB9ID0gcmVxdWlyZSgnZXZlbnRzJyk7XG5jb25zdCBTb3VyY2VIYW5kbGVyRmFjdG9yeSA9IHJlcXVpcmUoJy4vU291cmNlSGFuZGxlckZhY3RvcnknKTtcblxuLyoqXG4gKiBSZWdpc3RyeSBmb3IgbWFuYWdpbmcgc291cmNlIGhhbmRsZXJzXG4gKi9cbmNsYXNzIFNvdXJjZUhhbmRsZXJSZWdpc3RyeSBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIGNvbnN0cnVjdG9yKGZhY3RvcnkgPSBudWxsLCBsb2dnZXIgPSBudWxsKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmZhY3RvcnkgPSBmYWN0b3J5IHx8IG5ldyBTb3VyY2VIYW5kbGVyRmFjdG9yeSgpO1xuICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyIHx8IGNvbnNvbGU7XG4gICAgdGhpcy5oYW5kbGVycyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLmVuYWJsZWRIYW5kbGVycyA9IG5ldyBTZXQoKTtcbiAgICB0aGlzLnN0YXRzID0ge1xuICAgICAgdG90YWxIYW5kbGVyczogMCxcbiAgICAgIGFjdGl2ZUhhbmRsZXJzOiAwLFxuICAgICAgZGlzY292ZXJlZERvY3VtZW50czogMCxcbiAgICAgIHByb2Nlc3NlZERvY3VtZW50czogMFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBoYW5kbGVyIHdpdGggdGhlIHJlZ2lzdHJ5XG4gICAqL1xuICBhc3luYyByZWdpc3RlckhhbmRsZXIoY29uZmlnKSB7XG4gICAgaWYgKCFjb25maWcgfHwgIWNvbmZpZy5pZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdIYW5kbGVyIGNvbmZpZ3VyYXRpb24gd2l0aCBpZCBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhhbmRsZXJzLmhhcyhjb25maWcuaWQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgd2l0aCBJRCAke2NvbmZpZy5pZH0gaXMgYWxyZWFkeSByZWdpc3RlcmVkYCk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgY29uZmlndXJhdGlvblxuICAgIGF3YWl0IHRoaXMuZmFjdG9yeS52YWxpZGF0ZUNvbmZpZyhjb25maWcpO1xuXG4gICAgLy8gQ3JlYXRlIGhhbmRsZXIgaW5zdGFuY2VcbiAgICBjb25zdCBoYW5kbGVyID0gdGhpcy5mYWN0b3J5LmNyZWF0ZUhhbmRsZXIoY29uZmlnKTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIGhhbmRsZXJcbiAgICBhd2FpdCBoYW5kbGVyLmluaXRpYWxpemUoKTtcblxuICAgIC8vIFN0b3JlIGhhbmRsZXJcbiAgICB0aGlzLmhhbmRsZXJzLnNldChjb25maWcuaWQsIGhhbmRsZXIpO1xuICAgIFxuICAgIC8vIEFkZCB0byBlbmFibGVkIGhhbmRsZXJzIGlmIGVuYWJsZWRcbiAgICBpZiAoY29uZmlnLmVuYWJsZWQgIT09IGZhbHNlKSB7XG4gICAgICB0aGlzLmVuYWJsZWRIYW5kbGVycy5hZGQoY29uZmlnLmlkKTtcbiAgICAgIHRoaXMuc3RhdHMuYWN0aXZlSGFuZGxlcnMrKztcbiAgICB9XG4gICAgXG4gICAgdGhpcy5zdGF0cy50b3RhbEhhbmRsZXJzKys7XG5cbiAgICB0aGlzLmVtaXQoJ2hhbmRsZXJSZWdpc3RlcmVkJywgeyBpZDogY29uZmlnLmlkLCB0eXBlOiBjb25maWcudHlwZSB9KTtcbiAgICBcbiAgICByZXR1cm4gaGFuZGxlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBVbnJlZ2lzdGVyIGEgaGFuZGxlclxuICAgKi9cbiAgYXN5bmMgdW5yZWdpc3RlckhhbmRsZXIoaGFuZGxlcklkKSB7XG4gICAgY29uc3QgaGFuZGxlciA9IHRoaXMuaGFuZGxlcnMuZ2V0KGhhbmRsZXJJZCk7XG4gICAgaWYgKCFoYW5kbGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgd2l0aCBJRCAke2hhbmRsZXJJZH0gbm90IGZvdW5kYCk7XG4gICAgfVxuXG4gICAgLy8gQ2xlYW51cCBoYW5kbGVyXG4gICAgaWYgKHR5cGVvZiBoYW5kbGVyLmNsZWFudXAgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGF3YWl0IGhhbmRsZXIuY2xlYW51cCgpO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBmcm9tIHJlZ2lzdHJ5XG4gICAgdGhpcy5oYW5kbGVycy5kZWxldGUoaGFuZGxlcklkKTtcbiAgICB0aGlzLmVuYWJsZWRIYW5kbGVycy5kZWxldGUoaGFuZGxlcklkKTtcbiAgICB0aGlzLnN0YXRzLnRvdGFsSGFuZGxlcnMtLTtcbiAgICBpZiAodGhpcy5zdGF0cy5hY3RpdmVIYW5kbGVycyA+IDApIHtcbiAgICAgIHRoaXMuc3RhdHMuYWN0aXZlSGFuZGxlcnMtLTtcbiAgICB9XG5cbiAgICB0aGlzLmVtaXQoJ2hhbmRsZXJVbnJlZ2lzdGVyZWQnLCB7IGlkOiBoYW5kbGVySWQgfSk7XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgaGFuZGxlciBieSBpZFxuICAgKi9cbiAgZ2V0SGFuZGxlcihoYW5kbGVySWQpIHtcbiAgICByZXR1cm4gdGhpcy5oYW5kbGVycy5nZXQoaGFuZGxlcklkKSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgcmVnaXN0ZXJlZCBoYW5kbGVyc1xuICAgKi9cbiAgZ2V0QWxsSGFuZGxlcnMoKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5oYW5kbGVycy52YWx1ZXMoKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVuYWJsZWQgaGFuZGxlcnNcbiAgICovXG4gIGdldEVuYWJsZWRIYW5kbGVycygpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmVuYWJsZWRIYW5kbGVycylcbiAgICAgIC5tYXAoaWQgPT4gdGhpcy5oYW5kbGVycy5nZXQoaWQpKVxuICAgICAgLmZpbHRlcihoYW5kbGVyID0+IGhhbmRsZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZSBhIGhhbmRsZXJcbiAgICovXG4gIGVuYWJsZUhhbmRsZXIoaGFuZGxlcklkKSB7XG4gICAgaWYgKCF0aGlzLmhhbmRsZXJzLmhhcyhoYW5kbGVySWQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgJHtoYW5kbGVySWR9IG5vdCBmb3VuZGApO1xuICAgIH1cblxuICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLmhhbmRsZXJzLmdldChoYW5kbGVySWQpO1xuICAgIGNvbnN0IHdhc0VuYWJsZWQgPSB0aGlzLmVuYWJsZWRIYW5kbGVycy5oYXMoaGFuZGxlcklkKTtcbiAgICBcbiAgICB0aGlzLmVuYWJsZWRIYW5kbGVycy5hZGQoaGFuZGxlcklkKTtcbiAgICBoYW5kbGVyLmNvbmZpZy5lbmFibGVkID0gdHJ1ZTtcbiAgICBcbiAgICBpZiAoIXdhc0VuYWJsZWQpIHtcbiAgICAgIHRoaXMuc3RhdHMuYWN0aXZlSGFuZGxlcnMrKztcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0hhbmRsZXIgZW5hYmxlZCcsIHsgaGFuZGxlcklkIH0pO1xuICAgICAgdGhpcy5lbWl0KCdoYW5kbGVyRW5hYmxlZCcsIHsgaWQ6IGhhbmRsZXJJZCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNhYmxlIGEgaGFuZGxlclxuICAgKi9cbiAgZGlzYWJsZUhhbmRsZXIoaGFuZGxlcklkKSB7XG4gICAgaWYgKCF0aGlzLmhhbmRsZXJzLmhhcyhoYW5kbGVySWQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgJHtoYW5kbGVySWR9IG5vdCBmb3VuZGApO1xuICAgIH1cblxuICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLmhhbmRsZXJzLmdldChoYW5kbGVySWQpO1xuICAgIGNvbnN0IHdhc0VuYWJsZWQgPSB0aGlzLmVuYWJsZWRIYW5kbGVycy5oYXMoaGFuZGxlcklkKTtcbiAgICBcbiAgICB0aGlzLmVuYWJsZWRIYW5kbGVycy5kZWxldGUoaGFuZGxlcklkKTtcbiAgICBoYW5kbGVyLmNvbmZpZy5lbmFibGVkID0gZmFsc2U7XG4gICAgXG4gICAgaWYgKHdhc0VuYWJsZWQpIHtcbiAgICAgIHRoaXMuc3RhdHMuYWN0aXZlSGFuZGxlcnMtLTtcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0hhbmRsZXIgZGlzYWJsZWQnLCB7IGhhbmRsZXJJZCB9KTtcbiAgICAgIHRoaXMuZW1pdCgnaGFuZGxlckRpc2FibGVkJywgeyBpZDogaGFuZGxlcklkIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGhhbmRsZXIgaXMgZW5hYmxlZFxuICAgKi9cbiAgaXNIYW5kbGVyRW5hYmxlZChoYW5kbGVySWQpIHtcbiAgICByZXR1cm4gdGhpcy5lbmFibGVkSGFuZGxlcnMuaGFzKGhhbmRsZXJJZCk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgbXVsdGlwbGUgaGFuZGxlcnNcbiAgICovXG4gIGFzeW5jIHJlZ2lzdGVySGFuZGxlcnMoY29uZmlncykge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShjb25maWdzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb25maWd1cmF0aW9ucyBtdXN0IGJlIGFuIGFycmF5Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoY29uc3QgY29uZmlnIG9mIGNvbmZpZ3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSBhd2FpdCB0aGlzLnJlZ2lzdGVySGFuZGxlcihjb25maWcpO1xuICAgICAgICByZXN1bHRzLnB1c2goeyBzdWNjZXNzOiB0cnVlLCBpZDogY29uZmlnLmlkLCBoYW5kbGVyIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHsgc3VjY2VzczogZmFsc2UsIGlkOiBjb25maWcuaWQsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc2NvdmVyIGRvY3VtZW50cyBmcm9tIGFsbCBlbmFibGVkIGhhbmRsZXJzXG4gICAqL1xuICBhc3luYyBkaXNjb3ZlckFsbCgpIHtcbiAgICBjb25zdCBlbmFibGVkSGFuZGxlcnMgPSB0aGlzLmdldEVuYWJsZWRIYW5kbGVycygpO1xuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcblxuICAgIGZvciAoY29uc3QgaGFuZGxlciBvZiBlbmFibGVkSGFuZGxlcnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50cyA9IGF3YWl0IGhhbmRsZXIuZGlzY292ZXIoKTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZG9jdW1lbnRzKSkge1xuICAgICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgaGFuZGxlcklkOiBoYW5kbGVyLmNvbmZpZz8uaWQsXG4gICAgICAgICAgICBkb2N1bWVudHM6IGRvY3VtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuc3RhdHMuZGlzY292ZXJlZERvY3VtZW50cyArPSBkb2N1bWVudHMubGVuZ3RoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGhhbmRsZXJJZDogaGFuZGxlci5jb25maWc/LmlkLFxuICAgICAgICAgICAgZG9jdW1lbnRzOiBbXSxcbiAgICAgICAgICAgIGVycm9yOiAnSGFuZGxlciBkaWQgbm90IHJldHVybiBhcnJheSBvZiBkb2N1bWVudHMnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIExvZyBlcnJvciBidXQgY29udGludWUgd2l0aCBvdGhlciBoYW5kbGVyc1xuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihgSGFuZGxlciBkaXNjb3ZlcnkgZmFpbGVkIGZvciAke2hhbmRsZXIuY29uZmlnPy5pZH06YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgaGFuZGxlcklkOiBoYW5kbGVyLmNvbmZpZz8uaWQsXG4gICAgICAgICAgZG9jdW1lbnRzOiBbXSxcbiAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIGFsbCBoYW5kbGVyc1xuICAgKi9cbiAgYXN5bmMgY2xlYW51cCgpIHtcbiAgICBjb25zdCBoYW5kbGVycyA9IEFycmF5LmZyb20odGhpcy5oYW5kbGVycy52YWx1ZXMoKSk7XG4gICAgXG4gICAgZm9yIChjb25zdCBoYW5kbGVyIG9mIGhhbmRsZXJzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIuY2xlYW51cCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGF3YWl0IGhhbmRsZXIuY2xlYW51cCgpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBMb2cgZXJyb3IgYnV0IGNvbnRpbnVlIGNsZWFudXBcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGNsZWFuaW5nIHVwIGhhbmRsZXI6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZXJzLmNsZWFyKCk7XG4gICAgdGhpcy5lbmFibGVkSGFuZGxlcnMuY2xlYXIoKTtcbiAgICB0aGlzLnN0YXRzID0ge1xuICAgICAgdG90YWxIYW5kbGVyczogMCxcbiAgICAgIGFjdGl2ZUhhbmRsZXJzOiAwLFxuICAgICAgZGlzY292ZXJlZERvY3VtZW50czogMCxcbiAgICAgIHByb2Nlc3NlZERvY3VtZW50czogMFxuICAgIH07XG5cbiAgICB0aGlzLmVtaXQoJ3JlZ2lzdHJ5Q2xlYW51cCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAgYWxsIGhhbmRsZXJzIChhbGlhcyBmb3IgY2xlYW51cClcbiAgICovXG4gIGFzeW5jIGNsZWFudXBBbGwoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2xlYW51cCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCByZWdpc3RyeSBzdGF0aXN0aWNzXG4gICAqL1xuICBnZXRTdGF0cygpIHtcbiAgICByZXR1cm4geyAuLi50aGlzLnN0YXRzIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGRldGFpbGVkIHN0YXRpc3RpY3MgKGFsaWFzIGZvciBjb21wYXRpYmlsaXR5KVxuICAgKi9cbiAgZ2V0U3RhdGlzdGljcygpIHtcbiAgICBjb25zdCBoYW5kbGVyc0J5VHlwZSA9IHt9O1xuICAgIGZvciAoY29uc3QgaGFuZGxlciBvZiB0aGlzLmhhbmRsZXJzLnZhbHVlcygpKSB7XG4gICAgICBjb25zdCB0eXBlID0gaGFuZGxlci5jb25maWc/LnR5cGUgfHwgJ3Vua25vd24nO1xuICAgICAgaGFuZGxlcnNCeVR5cGVbdHlwZV0gPSAoaGFuZGxlcnNCeVR5cGVbdHlwZV0gfHwgMCkgKyAxO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbEhhbmRsZXJzOiB0aGlzLmhhbmRsZXJzLnNpemUsXG4gICAgICBlbmFibGVkSGFuZGxlcnM6IHRoaXMuZW5hYmxlZEhhbmRsZXJzLnNpemUsXG4gICAgICBkaXNhYmxlZEhhbmRsZXJzOiB0aGlzLmhhbmRsZXJzLnNpemUgLSB0aGlzLmVuYWJsZWRIYW5kbGVycy5zaXplLFxuICAgICAgaGFuZGxlcnNCeVR5cGUsXG4gICAgICAuLi50aGlzLnN0YXRzXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaGFuZGxlciBjb3VudFxuICAgKi9cbiAgZ2V0SGFuZGxlckNvdW50KCkge1xuICAgIHJldHVybiB0aGlzLmhhbmRsZXJzLnNpemU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVuYWJsZWQgaGFuZGxlciBjb3VudFxuICAgKi9cbiAgZ2V0RW5hYmxlZEhhbmRsZXJDb3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy5lbmFibGVkSGFuZGxlcnMuc2l6ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGhhbmRsZXIgSURzXG4gICAqL1xuICBnZXRBbGxIYW5kbGVySWRzKCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuaGFuZGxlcnMua2V5cygpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgaGFuZGxlciBjb25maWd1cmF0aW9uXG4gICAqL1xuICBhc3luYyB1cGRhdGVIYW5kbGVyQ29uZmlnKGhhbmRsZXJJZCwgbmV3Q29uZmlnKSB7XG4gICAgY29uc3QgaGFuZGxlciA9IHRoaXMuaGFuZGxlcnMuZ2V0KGhhbmRsZXJJZCk7XG4gICAgaWYgKCFoYW5kbGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgJHtoYW5kbGVySWR9IG5vdCBmb3VuZGApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIG5ldyBjb25maWd1cmF0aW9uXG4gICAgYXdhaXQgdGhpcy5mYWN0b3J5LnZhbGlkYXRlQ29uZmlnKG5ld0NvbmZpZyk7XG5cbiAgICAvLyBVcGRhdGUgaGFuZGxlciBjb25maWd1cmF0aW9uXG4gICAgaGFuZGxlci5jb25maWcgPSB7IC4uLmhhbmRsZXIuY29uZmlnLCAuLi5uZXdDb25maWcgfTtcblxuICAgIHRoaXMuZW1pdCgnaGFuZGxlckNvbmZpZ1VwZGF0ZWQnLCB7IGlkOiBoYW5kbGVySWQsIGNvbmZpZzogbmV3Q29uZmlnIH0pO1xuICAgIFxuICAgIHJldHVybiBoYW5kbGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBoYW5kbGVyIGJ5IHR5cGVcbiAgICovXG4gIGdldEhhbmRsZXJzQnlUeXBlKHR5cGUpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmhhbmRsZXJzLnZhbHVlcygpKVxuICAgICAgLmZpbHRlcihoYW5kbGVyID0+IGhhbmRsZXIuY29uZmlnLnR5cGUgPT09IHR5cGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBoYW5kbGVycyBieSB2aXNpYmlsaXR5XG4gICAqL1xuICBnZXRIYW5kbGVyc0J5VmlzaWJpbGl0eSh2aXNpYmlsaXR5KSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5oYW5kbGVycy52YWx1ZXMoKSlcbiAgICAgIC5maWx0ZXIoaGFuZGxlciA9PiBoYW5kbGVyLmNvbmZpZy52aXNpYmlsaXR5ID09PSB2aXNpYmlsaXR5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhbnkgaGFuZGxlcnMgYXJlIHJlZ2lzdGVyZWRcbiAgICovXG4gIGhhc0hhbmRsZXJzKCkge1xuICAgIHJldHVybiB0aGlzLmhhbmRsZXJzLnNpemUgPiAwO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU291cmNlSGFuZGxlclJlZ2lzdHJ5O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNO0VBQUVBO0FBQWEsQ0FBQyxHQUFHQyxPQUFPLENBQUMsUUFBUSxDQUFDO0FBQzFDLE1BQU1DLG9CQUFvQixHQUFHRCxPQUFPLENBQUMsd0JBQXdCLENBQUM7O0FBRTlEO0FBQ0E7QUFDQTtBQUNBLE1BQU1FLHFCQUFxQixTQUFTSCxZQUFZLENBQUM7RUFDL0NJLFdBQVdBLENBQUNDLE9BQU8sR0FBRyxJQUFJLEVBQUVDLE1BQU0sR0FBRyxJQUFJLEVBQUU7SUFDekMsS0FBSyxDQUFDLENBQUM7SUFDUCxJ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