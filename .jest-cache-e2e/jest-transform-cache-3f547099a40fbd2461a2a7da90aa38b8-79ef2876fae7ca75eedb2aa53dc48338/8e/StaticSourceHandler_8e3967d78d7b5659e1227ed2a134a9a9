db151015eb8eaf91582527657de7fe68
const fs = require('fs').promises;
const path = require('path');
const mime = require('mime-types');
const crypto = require('crypto');
const {
  BaseSourceHandler,
  SOURCE_TYPES,
  VISIBILITY_LEVELS
} = require('../types');

/**
 * Static Source Handler
 * Handles one-time bulk loads from file systems, archives, or static datasets
 */
class StaticSourceHandler extends BaseSourceHandler {
  constructor(config) {
    super(config);
    // Handle fileTypes configuration and ensure proper extension format
    const fileTypes = config.config?.fileTypes || ['txt', 'md', 'pdf', 'docx', 'html', 'json', 'csv'];
    this.supportedExtensions = fileTypes.map(ext => ext.startsWith('.') ? ext : `.${ext}`);
  }

  /**
   * Initialize the static source handler
   */
  async initialize() {
    this.logger?.info('Initializing StaticSourceHandler', {
      sourceId: this.config.id
    });

    // Validate required configuration
    if (!this.config.config?.basePath) {
      throw new Error('StaticSourceHandler requires config.basePath');
    }

    // Ensure base path exists and is accessible
    try {
      await fs.access(this.config.config.basePath);
    } catch (error) {
      throw new Error(`Base path not accessible: ${this.config.config.basePath}`);
    }
    this.logger?.info('StaticSourceHandler initialized successfully');
  }

  /**
   * Validate static source configuration
   */
  async validateConfig(config) {
    const required = ['basePath'];
    const missing = required.filter(field => !config.config?.[field]);
    if (missing.length > 0) {
      throw new Error(`Missing required config fields: ${missing.join(', ')}`);
    }

    // Validate base path exists
    try {
      await fs.access(config.config.basePath);
      return true;
    } catch (error) {
      throw new Error(`Invalid basePath: ${config.config.basePath}`);
    }
  }

  /**
   * Discover all files in the static source
   */
  async discover() {
    this.logger?.info('Starting discovery for static source', {
      sourceId: this.config.id,
      basePath: this.config.config.basePath
    });
    const documents = [];
    const basePath = this.config.config.basePath;
    const includePatterns = this.config.config.includePatterns || ['**/*'];
    const excludePatterns = this.config.config.excludePatterns || [];
    try {
      const files = await this._walkDirectory(basePath);
      for (const filePath of files) {
        try {
          const relativePath = path.relative(basePath, filePath);

          // Check if file matches include/exclude patterns
          if (!this._matchesPatterns(relativePath, includePatterns, excludePatterns)) {
            continue;
          }

          // Check if file extension is supported
          const ext = path.extname(filePath).toLowerCase();
          if (!this.supportedExtensions.includes(ext)) {
            this.logger?.debug('Skipping unsupported file type', {
              filePath,
              ext
            });
            continue;
          }
          const stats = await fs.stat(filePath);
          const document = {
            id: this._generateDocumentId(filePath),
            title: path.basename(filePath),
            // Add title property for compatibility
            path: filePath,
            url: filePath,
            // Add url property for compatibility
            relativePath,
            name: path.basename(filePath),
            extension: ext,
            size: stats.size,
            lastModified: stats.mtime,
            contentType: mime.lookup(filePath) || 'application/octet-stream',
            metadata: {
              sourceId: this.config.id,
              sourceType: SOURCE_TYPES.STATIC,
              originalPath: filePath,
              fileExtension: ext,
              directory: path.dirname(relativePath),
              visibility: this.config.visibility || VISIBILITY_LEVELS.INTERNAL
            }
          };
          documents.push(document);
        } catch (error) {
          this.logger?.warn('Error processing file during discovery', {
            filePath,
            error: error.message
          });
        }
      }
      this.logger?.info('Discovery completed', {
        sourceId: this.config.id,
        documentsFound: documents.length
      });
      return documents;
    } catch (error) {
      this.logger?.error('Discovery failed', {
        sourceId: this.config.id,
        error: error.message
      });
      throw error;
    }
  }

  /**
   * Extract content from a static file
   */
  async extract(document) {
    this.logger?.info('Extracting content from document', {
      documentId: document.id,
      path: document.filePath || document.path
    });
    try {
      const filePath = document.filePath || document.path;
      const fileExtension = path.extname(filePath);
      let content;
      let encoding = 'utf-8';
      if (this._isBinaryExtension(fileExtension)) {
        // Handle binary files
        const fileName = path.basename(filePath);
        content = `[Binary file: ${fileName}]`;
        encoding = 'binary';
      } else {
        // Handle text files
        content = await fs.readFile(filePath, 'utf-8');
      }
      const hash = crypto.createHash('sha256').update(content).digest('hex');
      return {
        id: document.id,
        content,
        contentHash: hash,
        extractedAt: new Date(),
        metadata: {
          ...document.metadata,
          extractionMethod: 'file-system-read',
          encoding,
          originalSize: document.size
        }
      };
    } catch (error) {
      this.logger?.error('Content extraction failed', {
        documentId: document.id,
        path: document.filePath || document.path,
        error: error.message
      });
      throw error;
    }
  }

  /**
   * Transform extracted content to standard format
   */
  async transform(extractedContent) {
    this.logger?.debug('Transforming content', {
      documentId: extractedContent.id
    });

    // Basic transformation - can be extended for different file types
    const transformed = {
      id: extractedContent.id,
      title: this._extractTitle(extractedContent),
      content: this._cleanContent(extractedContent.content),
      contentHash: extractedContent.contentHash,
      metadata: {
        ...extractedContent.metadata,
        transformedAt: new Date(),
        wordCount: this._countWords(extractedContent.content),
        characterCount: extractedContent.content.length
      }
    };
    return transformed;
  }

  /**
   * Walk directory recursively to find all files
   */
  async _walkDirectory(dir) {
    const files = [];
    const entries = await fs.readdir(dir, {
      withFileTypes: true
    });
    const recursive = this.config.config.recursive !== false; // Default to true

    for (const entry of entries) {
      const fullPath = path.join(dir, entry.name);
      if (entry.isDirectory()) {
        // Skip hidden directories and common ignore patterns
        if (!entry.name.startsWith('.') && !['node_modules', 'dist', 'build'].includes(entry.name)) {
          if (recursive) {
            const subFiles = await this._walkDirectory(fullPath);
            files.push(...subFiles);
          }
        }
      } else if (entry.isFile()) {
        files.push(fullPath);
      }
    }
    return files;
  }

  /**
   * Check if file path matches include/exclude patterns
   */
  _matchesPatterns(filePath, includePatterns, excludePatterns) {
    // Simple pattern matching - can be enhanced with glob patterns
    const included = includePatterns.some(pattern => {
      if (pattern === '**/*') return true;
      return filePath.includes(pattern);
    });
    const excluded = excludePatterns.some(pattern => {
      return filePath.includes(pattern);
    });
    return included && !excluded;
  }

  /**
   * Generate unique document ID based on file path
   */
  _generateDocumentId(filePath) {
    return crypto.createHash('md5').update(filePath).digest('hex');
  }

  /**
   * Extract title from content or use filename
   */
  _extractTitle(extractedContent) {
    const content = extractedContent.content;
    const metadata = extractedContent.metadata;

    // Try to extract title from content (markdown, HTML, etc.)
    const titleMatch = content.match(/^#\s+(.+)$/m) ||
    // Markdown H1
    content.match(/<title>(.+)<\/title>/i); // HTML title

    if (titleMatch && titleMatch[1]) {
      return titleMatch[1].trim();
    }

    // Fallback to filename without extension
    return path.basename(metadata.originalPath, path.extname(metadata.originalPath));
  }

  /**
   * Clean and normalize content
   */
  _cleanContent(content) {
    return content.replace(/\r\n/g, '\n') // Normalize line endings
    .replace(/\n{3,}/g, '\n\n') // Remove excessive newlines
    .replace(/[ \t]+$/gm, '') // Remove trailing whitespace from each line
    .trim();
  }

  /**
   * Count words in content
   */
  _countWords(content) {
    return content.split(/\s+/).filter(word => word.length > 0).length;
  }

  /**
   * Check if file type is allowed
   */
  _isAllowedFileType(filePath) {
    const ext = path.extname(filePath).toLowerCase();
    return this.config.config.fileTypes.includes(ext);
  }

  /**
   * Check if file extension is binary
   */
  _isBinaryExtension(ext) {
    const binaryExtensions = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif', '.zip', '.tar', '.gz'];
    return binaryExtensions.includes(ext.toLowerCase());
  }
}
module.exports = StaticSourceHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJwcm9taXNlcyIsInBhdGgiLCJtaW1lIiwiY3J5cHRvIiwiQmFzZVNvdXJjZUhhbmRsZXIiLCJTT1VSQ0VfVFlQRVMiLCJWSVNJQklMSVRZX0xFVkVMUyIsIlN0YXRpY1NvdXJjZUhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsImZpbGVUeXBlcyIsInN1cHBvcnRlZEV4dGVuc2lvbnMiLCJtYXAiLCJleHQiLCJzdGFydHNXaXRoIiwiaW5pdGlhbGl6ZSIsImxvZ2dlciIsImluZm8iLCJzb3VyY2VJZCIsImlkIiwiYmFzZVBhdGgiLCJFcnJvciIsImFjY2VzcyIsImVycm9yIiwidmFsaWRhdGVDb25maWciLCJyZXF1aXJlZCIsIm1pc3NpbmciLCJmaWx0ZXIiLCJmaWVsZCIsImxlbmd0aCIsImpvaW4iLCJkaXNjb3ZlciIsImRvY3VtZW50cyIsImluY2x1ZGVQYXR0ZXJucyIsImV4Y2x1ZGVQYXR0ZXJucyIsImZpbGVzIiwiX3dhbGtEaXJlY3RvcnkiLCJmaWxlUGF0aCIsInJlbGF0aXZlUGF0aCIsInJlbGF0aXZlIiwiX21hdGNoZXNQYXR0ZXJucyIsImV4dG5hbWUiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwiZGVidWciLCJzdGF0cyIsInN0YXQiLCJkb2N1bWVudCIsIl9nZW5lcmF0ZURvY3VtZW50SWQiLCJ0aXRsZSIsImJhc2VuYW1lIiwidXJsIiwibmFtZSIsImV4dGVuc2lvbiIsInNpemUiLCJsYXN0TW9kaWZpZWQiLCJtdGltZSIsImNvbnRlbnRUeXBlIiwibG9va3VwIiwibWV0YWRhdGEiLCJzb3VyY2VUeXBlIiwiU1RBVElDIiwib3JpZ2luYWxQYXRoIiwiZmlsZUV4dGVuc2lvbiIsImRpcmVjdG9yeSIsImRpcm5hbWUiLCJ2aXNpYmlsaXR5IiwiSU5URVJOQUwiLCJwdXNoIiwid2FybiIsIm1lc3NhZ2UiLCJkb2N1bWVudHNGb3VuZCIsImV4dHJhY3QiLCJkb2N1bWVudElkIiwiY29udGVudCIsImVuY29kaW5nIiwiX2lzQmluYXJ5RXh0ZW5zaW9uIiwiZmlsZU5hbWUiLCJyZWFkRmlsZSIsImhhc2giLCJjcmVhdGVIYXNoIiwidXBkYXRlIiwiZGlnZXN0IiwiY29udGVudEhhc2giLCJleHRyYWN0ZWRBdCIsIkRhdGUiLCJleHRyYWN0aW9uTWV0aG9kIiwib3JpZ2luYWxTaXplIiwidHJhbnNmb3JtIiwiZXh0cmFjdGVkQ29udGVudCIsInRyYW5zZm9ybWVkIiwiX2V4dHJhY3RUaXRsZSIsIl9jbGVhbkNvbnRlbnQiLCJ0cmFuc2Zvcm1lZEF0Iiwid29yZENvdW50IiwiX2NvdW50V29yZHMiLCJjaGFyYWN0ZXJDb3VudCIsImRpciIsImVudHJpZXMiLCJyZWFkZGlyIiwid2l0aEZpbGVUeXBlcyIsInJlY3Vyc2l2ZSIsImVudHJ5IiwiZnVsbFBhdGgiLCJpc0RpcmVjdG9yeSIsInN1YkZpbGVzIiwiaXNGaWxlIiwiaW5jbHVkZWQiLCJzb21lIiwicGF0dGVybiIsImV4Y2x1ZGVkIiwidGl0bGVNYXRjaCIsIm1hdGNoIiwidHJpbSIsInJlcGxhY2UiLCJzcGxpdCIsIndvcmQiLCJfaXNBbGxvd2VkRmlsZVR5cGUiLCJiaW5hcnlFeHRlbnNpb25zIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIlN0YXRpY1NvdXJjZUhhbmRsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZnMgPSByZXF1aXJlKCdmcycpLnByb21pc2VzO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IG1pbWUgPSByZXF1aXJlKCdtaW1lLXR5cGVzJyk7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcbmNvbnN0IHsgQmFzZVNvdXJjZUhhbmRsZXIsIFNPVVJDRV9UWVBFUywgVklTSUJJTElUWV9MRVZFTFMgfSA9IHJlcXVpcmUoJy4uL3R5cGVzJyk7XG5cbi8qKlxuICogU3RhdGljIFNvdXJjZSBIYW5kbGVyXG4gKiBIYW5kbGVzIG9uZS10aW1lIGJ1bGsgbG9hZHMgZnJvbSBmaWxlIHN5c3RlbXMsIGFyY2hpdmVzLCBvciBzdGF0aWMgZGF0YXNldHNcbiAqL1xuY2xhc3MgU3RhdGljU291cmNlSGFuZGxlciBleHRlbmRzIEJhc2VTb3VyY2VIYW5kbGVyIHtcbiAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgc3VwZXIoY29uZmlnKTtcbiAgICAvLyBIYW5kbGUgZmlsZVR5cGVzIGNvbmZpZ3VyYXRpb24gYW5kIGVuc3VyZSBwcm9wZXIgZXh0ZW5zaW9uIGZvcm1hdFxuICAgIGNvbnN0IGZpbGVUeXBlcyA9IGNvbmZpZy5jb25maWc/LmZpbGVUeXBlcyB8fCBbJ3R4dCcsICdtZCcsICdwZGYnLCAnZG9jeCcsICdodG1sJywgJ2pzb24nLCAnY3N2J107XG4gICAgdGhpcy5zdXBwb3J0ZWRFeHRlbnNpb25zID0gZmlsZVR5cGVzLm1hcChleHQgPT4gZXh0LnN0YXJ0c1dpdGgoJy4nKSA/IGV4dCA6IGAuJHtleHR9YCk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgc3RhdGljIHNvdXJjZSBoYW5kbGVyXG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplKCkge1xuICAgIHRoaXMubG9nZ2VyPy5pbmZvKCdJbml0aWFsaXppbmcgU3RhdGljU291cmNlSGFuZGxlcicsIHsgc291cmNlSWQ6IHRoaXMuY29uZmlnLmlkIH0pO1xuICAgIFxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGNvbmZpZ3VyYXRpb25cbiAgICBpZiAoIXRoaXMuY29uZmlnLmNvbmZpZz8uYmFzZVBhdGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3RhdGljU291cmNlSGFuZGxlciByZXF1aXJlcyBjb25maWcuYmFzZVBhdGgnKTtcbiAgICB9XG5cbiAgICAvLyBFbnN1cmUgYmFzZSBwYXRoIGV4aXN0cyBhbmQgaXMgYWNjZXNzaWJsZVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy5hY2Nlc3ModGhpcy5jb25maWcuY29uZmlnLmJhc2VQYXRoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYXNlIHBhdGggbm90IGFjY2Vzc2libGU6ICR7dGhpcy5jb25maWcuY29uZmlnLmJhc2VQYXRofWApO1xuICAgIH1cblxuICAgIHRoaXMubG9nZ2VyPy5pbmZvKCdTdGF0aWNTb3VyY2VIYW5kbGVyIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHN0YXRpYyBzb3VyY2UgY29uZmlndXJhdGlvblxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVDb25maWcoY29uZmlnKSB7XG4gICAgY29uc3QgcmVxdWlyZWQgPSBbJ2Jhc2VQYXRoJ107XG4gICAgY29uc3QgbWlzc2luZyA9IHJlcXVpcmVkLmZpbHRlcihmaWVsZCA9PiAhY29uZmlnLmNvbmZpZz8uW2ZpZWxkXSk7XG4gICAgXG4gICAgaWYgKG1pc3NpbmcubGVuZ3RoID4gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIHJlcXVpcmVkIGNvbmZpZyBmaWVsZHM6ICR7bWlzc2luZy5qb2luKCcsICcpfWApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGJhc2UgcGF0aCBleGlzdHNcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMuYWNjZXNzKGNvbmZpZy5jb25maWcuYmFzZVBhdGgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBiYXNlUGF0aDogJHtjb25maWcuY29uZmlnLmJhc2VQYXRofWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNjb3ZlciBhbGwgZmlsZXMgaW4gdGhlIHN0YXRpYyBzb3VyY2VcbiAgICovXG4gIGFzeW5jIGRpc2NvdmVyKCkge1xuICAgIHRoaXMubG9nZ2VyPy5pbmZvKCdTdGFydGluZyBkaXNjb3ZlcnkgZm9yIHN0YXRpYyBzb3VyY2UnLCB7IFxuICAgICAgc291cmNlSWQ6IHRoaXMuY29uZmlnLmlkLFxuICAgICAgYmFzZVBhdGg6IHRoaXMuY29uZmlnLmNvbmZpZy5iYXNlUGF0aCBcbiAgICB9KTtcblxuICAgIGNvbnN0IGRvY3VtZW50cyA9IFtdO1xuICAgIGNvbnN0IGJhc2VQYXRoID0gdGhpcy5jb25maWcuY29uZmlnLmJhc2VQYXRoO1xuICAgIGNvbnN0IGluY2x1ZGVQYXR0ZXJucyA9IHRoaXMuY29uZmlnLmNvbmZpZy5pbmNsdWRlUGF0dGVybnMgfHwgWycqKi8qJ107XG4gICAgY29uc3QgZXhjbHVkZVBhdHRlcm5zID0gdGhpcy5jb25maWcuY29uZmlnLmV4Y2x1ZGVQYXR0ZXJucyB8fCBbXTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlcyA9IGF3YWl0IHRoaXMuX3dhbGtEaXJlY3RvcnkoYmFzZVBhdGgpO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGZpbGVzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aC5yZWxhdGl2ZShiYXNlUGF0aCwgZmlsZVBhdGgpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIGlmIGZpbGUgbWF0Y2hlcyBpbmNsdWRlL2V4Y2x1ZGUgcGF0dGVybnNcbiAgICAgICAgICBpZiAoIXRoaXMuX21hdGNoZXNQYXR0ZXJucyhyZWxhdGl2ZVBhdGgsIGluY2x1ZGVQYXR0ZXJucywgZXhjbHVkZVBhdHRlcm5zKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSBleHRlbnNpb24gaXMgc3VwcG9ydGVkXG4gICAgICAgICAgY29uc3QgZXh0ID0gcGF0aC5leHRuYW1lKGZpbGVQYXRoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGlmICghdGhpcy5zdXBwb3J0ZWRFeHRlbnNpb25zLmluY2x1ZGVzKGV4dCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyPy5kZWJ1ZygnU2tpcHBpbmcgdW5zdXBwb3J0ZWQgZmlsZSB0eXBlJywgeyBmaWxlUGF0aCwgZXh0IH0pO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBmcy5zdGF0KGZpbGVQYXRoKTtcbiAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IHtcbiAgICAgICAgICAgIGlkOiB0aGlzLl9nZW5lcmF0ZURvY3VtZW50SWQoZmlsZVBhdGgpLFxuICAgICAgICAgICAgdGl0bGU6IHBhdGguYmFzZW5hbWUoZmlsZVBhdGgpLCAvLyBBZGQgdGl0bGUgcHJvcGVydHkgZm9yIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgIHBhdGg6IGZpbGVQYXRoLFxuICAgICAgICAgICAgdXJsOiBmaWxlUGF0aCwgLy8gQWRkIHVybCBwcm9wZXJ0eSBmb3IgY29tcGF0aWJpbGl0eVxuICAgICAgICAgICAgcmVsYXRpdmVQYXRoLFxuICAgICAgICAgICAgbmFtZTogcGF0aC5iYXNlbmFtZShmaWxlUGF0aCksXG4gICAgICAgICAgICBleHRlbnNpb246IGV4dCxcbiAgICAgICAgICAgIHNpemU6IHN0YXRzLnNpemUsXG4gICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHN0YXRzLm10aW1lLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IG1pbWUubG9va3VwKGZpbGVQYXRoKSB8fCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIHNvdXJjZUlkOiB0aGlzLmNvbmZpZy5pZCxcbiAgICAgICAgICAgICAgc291cmNlVHlwZTogU09VUkNFX1RZUEVTLlNUQVRJQyxcbiAgICAgICAgICAgICAgb3JpZ2luYWxQYXRoOiBmaWxlUGF0aCxcbiAgICAgICAgICAgICAgZmlsZUV4dGVuc2lvbjogZXh0LFxuICAgICAgICAgICAgICBkaXJlY3Rvcnk6IHBhdGguZGlybmFtZShyZWxhdGl2ZVBhdGgpLFxuICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB0aGlzLmNvbmZpZy52aXNpYmlsaXR5IHx8IFZJU0lCSUxJVFlfTEVWRUxTLklOVEVSTkFMXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGRvY3VtZW50cy5wdXNoKGRvY3VtZW50KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmxvZ2dlcj8ud2FybignRXJyb3IgcHJvY2Vzc2luZyBmaWxlIGR1cmluZyBkaXNjb3ZlcnknLCB7IFxuICAgICAgICAgICAgZmlsZVBhdGgsIFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXI/LmluZm8oJ0Rpc2NvdmVyeSBjb21wbGV0ZWQnLCB7IFxuICAgICAgICBzb3VyY2VJZDogdGhpcy5jb25maWcuaWQsXG4gICAgICAgIGRvY3VtZW50c0ZvdW5kOiBkb2N1bWVudHMubGVuZ3RoIFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkb2N1bWVudHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyPy5lcnJvcignRGlzY292ZXJ5IGZhaWxlZCcsIHsgXG4gICAgICAgIHNvdXJjZUlkOiB0aGlzLmNvbmZpZy5pZCxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgXG4gICAgICB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGNvbnRlbnQgZnJvbSBhIHN0YXRpYyBmaWxlXG4gICAqL1xuICBhc3luYyBleHRyYWN0KGRvY3VtZW50KSB7XG4gICAgdGhpcy5sb2dnZXI/LmluZm8oJ0V4dHJhY3RpbmcgY29udGVudCBmcm9tIGRvY3VtZW50JywgeyBcbiAgICAgIGRvY3VtZW50SWQ6IGRvY3VtZW50LmlkLFxuICAgICAgcGF0aDogZG9jdW1lbnQuZmlsZVBhdGggfHwgZG9jdW1lbnQucGF0aCBcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGRvY3VtZW50LmZpbGVQYXRoIHx8IGRvY3VtZW50LnBhdGg7XG4gICAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gcGF0aC5leHRuYW1lKGZpbGVQYXRoKTtcbiAgICAgIFxuICAgICAgbGV0IGNvbnRlbnQ7XG4gICAgICBsZXQgZW5jb2RpbmcgPSAndXRmLTgnO1xuICAgICAgXG4gICAgICBpZiAodGhpcy5faXNCaW5hcnlFeHRlbnNpb24oZmlsZUV4dGVuc2lvbikpIHtcbiAgICAgICAgLy8gSGFuZGxlIGJpbmFyeSBmaWxlc1xuICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHBhdGguYmFzZW5hbWUoZmlsZVBhdGgpO1xuICAgICAgICBjb250ZW50ID0gYFtCaW5hcnkgZmlsZTogJHtmaWxlTmFtZX1dYDtcbiAgICAgICAgZW5jb2RpbmcgPSAnYmluYXJ5JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEhhbmRsZSB0ZXh0IGZpbGVzXG4gICAgICAgIGNvbnRlbnQgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlUGF0aCwgJ3V0Zi04Jyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKGNvbnRlbnQpLmRpZ2VzdCgnaGV4Jyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBkb2N1bWVudC5pZCxcbiAgICAgICAgY29udGVudCxcbiAgICAgICAgY29udGVudEhhc2g6IGhhc2gsXG4gICAgICAgIGV4dHJhY3RlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIC4uLmRvY3VtZW50Lm1ldGFkYXRhLFxuICAgICAgICAgIGV4dHJhY3Rpb25NZXRob2Q6ICdmaWxlLXN5c3RlbS1yZWFkJyxcbiAgICAgICAgICBlbmNvZGluZyxcbiAgICAgICAgICBvcmlnaW5hbFNpemU6IGRvY3VtZW50LnNpemVcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXI/LmVycm9yKCdDb250ZW50IGV4dHJhY3Rpb24gZmFpbGVkJywgeyBcbiAgICAgICAgZG9jdW1lbnRJZDogZG9jdW1lbnQuaWQsXG4gICAgICAgIHBhdGg6IGRvY3VtZW50LmZpbGVQYXRoIHx8IGRvY3VtZW50LnBhdGgsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIFxuICAgICAgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNmb3JtIGV4dHJhY3RlZCBjb250ZW50IHRvIHN0YW5kYXJkIGZvcm1hdFxuICAgKi9cbiAgYXN5bmMgdHJhbnNmb3JtKGV4dHJhY3RlZENvbnRlbnQpIHtcbiAgICB0aGlzLmxvZ2dlcj8uZGVidWcoJ1RyYW5zZm9ybWluZyBjb250ZW50JywgeyBcbiAgICAgIGRvY3VtZW50SWQ6IGV4dHJhY3RlZENvbnRlbnQuaWQgXG4gICAgfSk7XG5cbiAgICAvLyBCYXNpYyB0cmFuc2Zvcm1hdGlvbiAtIGNhbiBiZSBleHRlbmRlZCBmb3IgZGlmZmVyZW50IGZpbGUgdHlwZXNcbiAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHtcbiAgICAgIGlkOiBleHRyYWN0ZWRDb250ZW50LmlkLFxuICAgICAgdGl0bGU6IHRoaXMuX2V4dHJhY3RUaXRsZShleHRyYWN0ZWRDb250ZW50KSxcbiAgICAgIGNvbnRlbnQ6IHRoaXMuX2NsZWFuQ29udGVudChleHRyYWN0ZWRDb250ZW50LmNvbnRlbnQpLFxuICAgICAgY29udGVudEhhc2g6IGV4dHJhY3RlZENvbnRlbnQuY29udGVudEhhc2gsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5leHRyYWN0ZWRDb250ZW50Lm1ldGFkYXRhLFxuICAgICAgICB0cmFuc2Zvcm1lZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB3b3JkQ291bnQ6IHRoaXMuX2NvdW50V29yZHMoZXh0cmFjdGVkQ29udGVudC5jb250ZW50KSxcbiAgICAgICAgY2hhcmFjdGVyQ291bnQ6IGV4dHJhY3RlZENvbnRlbnQuY29udGVudC5sZW5ndGhcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFdhbGsgZGlyZWN0b3J5IHJlY3Vyc2l2ZWx5IHRvIGZpbmQgYWxsIGZpbGVzXG4gICAqL1xuICBhc3luYyBfd2Fsa0RpcmVjdG9yeShkaXIpIHtcbiAgICBjb25zdCBmaWxlcyA9IFtdO1xuICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCBmcy5yZWFkZGlyKGRpciwgeyB3aXRoRmlsZVR5cGVzOiB0cnVlIH0pO1xuICAgIGNvbnN0IHJlY3Vyc2l2ZSA9IHRoaXMuY29uZmlnLmNvbmZpZy5yZWN1cnNpdmUgIT09IGZhbHNlOyAvLyBEZWZhdWx0IHRvIHRydWVcblxuICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgY29uc3QgZnVsbFBhdGggPSBwYXRoLmpvaW4oZGlyLCBlbnRyeS5uYW1lKTtcbiAgICAgIFxuICAgICAgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgLy8gU2tpcCBoaWRkZW4gZGlyZWN0b3JpZXMgYW5kIGNvbW1vbiBpZ25vcmUgcGF0dGVybnNcbiAgICAgICAgaWYgKCFlbnRyeS5uYW1lLnN0YXJ0c1dpdGgoJy4nKSAmJiAhWydub2RlX21vZHVsZXMnLCAnZGlzdCcsICdidWlsZCddLmluY2x1ZGVzKGVudHJ5Lm5hbWUpKSB7XG4gICAgICAgICAgaWYgKHJlY3Vyc2l2ZSkge1xuICAgICAgICAgICAgY29uc3Qgc3ViRmlsZXMgPSBhd2FpdCB0aGlzLl93YWxrRGlyZWN0b3J5KGZ1bGxQYXRoKTtcbiAgICAgICAgICAgIGZpbGVzLnB1c2goLi4uc3ViRmlsZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0ZpbGUoKSkge1xuICAgICAgICBmaWxlcy5wdXNoKGZ1bGxQYXRoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmlsZXM7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgZmlsZSBwYXRoIG1hdGNoZXMgaW5jbHVkZS9leGNsdWRlIHBhdHRlcm5zXG4gICAqL1xuICBfbWF0Y2hlc1BhdHRlcm5zKGZpbGVQYXRoLCBpbmNsdWRlUGF0dGVybnMsIGV4Y2x1ZGVQYXR0ZXJucykge1xuICAgIC8vIFNpbXBsZSBwYXR0ZXJuIG1hdGNoaW5nIC0gY2FuIGJlIGVuaGFuY2VkIHdpdGggZ2xvYiBwYXR0ZXJuc1xuICAgIGNvbnN0IGluY2x1ZGVkID0gaW5jbHVkZVBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiB7XG4gICAgICBpZiAocGF0dGVybiA9PT0gJyoqLyonKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmaWxlUGF0aC5pbmNsdWRlcyhwYXR0ZXJuKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGV4Y2x1ZGVkID0gZXhjbHVkZVBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiB7XG4gICAgICByZXR1cm4gZmlsZVBhdGguaW5jbHVkZXMocGF0dGVybik7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5jbHVkZWQgJiYgIWV4Y2x1ZGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIHVuaXF1ZSBkb2N1bWVudCBJRCBiYXNlZCBvbiBmaWxlIHBhdGhcbiAgICovXG4gIF9nZW5lcmF0ZURvY3VtZW50SWQoZmlsZVBhdGgpIHtcbiAgICByZXR1cm4gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpLnVwZGF0ZShmaWxlUGF0aCkuZGlnZXN0KCdoZXgnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IHRpdGxlIGZyb20gY29udGVudCBvciB1c2UgZmlsZW5hbWVcbiAgICovXG4gIF9leHRyYWN0VGl0bGUoZXh0cmFjdGVkQ29udGVudCkge1xuICAgIGNvbnN0IGNvbnRlbnQgPSBleHRyYWN0ZWRDb250ZW50LmNvbnRlbnQ7XG4gICAgY29uc3QgbWV0YWRhdGEgPSBleHRyYWN0ZWRDb250ZW50Lm1ldGFkYXRhO1xuXG4gICAgLy8gVHJ5IHRvIGV4dHJhY3QgdGl0bGUgZnJvbSBjb250ZW50IChtYXJrZG93biwgSFRNTCwgZXRjLilcbiAgICBjb25zdCB0aXRsZU1hdGNoID0gY29udGVudC5tYXRjaCgvXiNcXHMrKC4rKSQvbSkgfHwgLy8gTWFya2Rvd24gSDFcbiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50Lm1hdGNoKC88dGl0bGU+KC4rKTxcXC90aXRsZT4vaSk7IC8vIEhUTUwgdGl0bGVcblxuICAgIGlmICh0aXRsZU1hdGNoICYmIHRpdGxlTWF0Y2hbMV0pIHtcbiAgICAgIHJldHVybiB0aXRsZU1hdGNoWzFdLnRyaW0oKTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjayB0byBmaWxlbmFtZSB3aXRob3V0IGV4dGVuc2lvblxuICAgIHJldHVybiBwYXRoLmJhc2VuYW1lKG1ldGFkYXRhLm9yaWdpbmFsUGF0aCwgcGF0aC5leHRuYW1lKG1ldGFkYXRhLm9yaWdpbmFsUGF0aCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIGFuZCBub3JtYWxpemUgY29udGVudFxuICAgKi9cbiAgX2NsZWFuQ29udGVudChjb250ZW50KSB7XG4gICAgcmV0dXJuIGNvbnRlbnRcbiAgICAgIC5yZXBsYWNlKC9cXHJcXG4vZywgJ1xcbicpIC8vIE5vcm1hbGl6ZSBsaW5lIGVuZGluZ3NcbiAgICAgIC5yZXBsYWNlKC9cXG57Myx9L2csICdcXG5cXG4nKSAvLyBSZW1vdmUgZXhjZXNzaXZlIG5ld2xpbmVzXG4gICAgICAucmVwbGFjZSgvWyBcXHRdKyQvZ20sICcnKSAvLyBSZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBmcm9tIGVhY2ggbGluZVxuICAgICAgLnRyaW0oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3VudCB3b3JkcyBpbiBjb250ZW50XG4gICAqL1xuICBfY291bnRXb3Jkcyhjb250ZW50KSB7XG4gICAgcmV0dXJuIGNvbnRlbnQuc3BsaXQoL1xccysvKS5maWx0ZXIod29yZCA9PiB3b3JkLmxlbmd0aCA+IDApLmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBmaWxlIHR5cGUgaXMgYWxsb3dlZFxuICAgKi9cbiAgX2lzQWxsb3dlZEZpbGVUeXBlKGZpbGVQYXRoKSB7XG4gICAgY29uc3QgZXh0ID0gcGF0aC5leHRuYW1lKGZpbGVQYXRoKS50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5jb25maWcuZmlsZVR5cGVzLmluY2x1ZGVzKGV4dCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgZmlsZSBleHRlbnNpb24gaXMgYmluYXJ5XG4gICAqL1xuICBfaXNCaW5hcnlFeHRlbnNpb24oZXh0KSB7XG4gICAgY29uc3QgYmluYXJ5RXh0ZW5zaW9ucyA9IFsnLnBkZicsICcuZG9jJywgJy5kb2N4JywgJy5qcGcnLCAnLmpwZWcnLCAnLnBuZycsICcuZ2lmJywgJy56aXAnLCAnLnRhcicsICcuZ3onXTtcbiAgICByZXR1cm4gYmluYXJ5RXh0ZW5zaW9ucy5pbmNsdWRlcyhleHQudG9Mb3dlckNhc2UoKSk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTdGF0aWNTb3VyY2VIYW5kbGVyO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxFQUFFLEdBQUdDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQ0MsUUFBUTtBQUNqQyxNQUFNQyxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDNUIsTUFBTUcsSUFBSSxHQUFHSCxPQUFPLENBQUMsWUFBWSxDQUFDO0FBQ2xDLE1BQU1JLE1BQU0sR0FBR0osT0FBTyxDQUFDLFFBQVEsQ0FBQztBQUNoQyxNQUFNO0VBQUVLLGlCQUFpQjtFQUFFQyxZQUFZO0VBQUVDO0FBQWtCLENBQUMsR0FBR1AsT0FBTyxDQUFDLFVBQVUsQ0FBQzs7QUFFbEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNUSxtQkFB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Q0FBQyxFQUFFO01BQy9CLE9BQU9BLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQ0UsSUFBSSxDQUFDLENBQUM7SUFDN0I7O0lBRUE7SUFDQSxPQUFPaEgsSUFBSSxDQUFDaUQsUUFBUSxDQUFDUyxRQUFRLENBQUNHLFlBQVksRUFBRTdELElBQUksQ0FBQ3dDLE9BQU8sQ0FBQ2tCLFFBQVEsQ0FBQ0csWUFBWSxDQUFDLENBQUM7RUFDbEY7O0VBRUE7QUFDRjtBQUNBO0VBQ0U4QixhQUFhQSxDQUFDbEIsT0FBTyxFQUFFO0lBQ3JCLE9BQU9BLE9BQU8sQ0FDWHdDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFBQSxDQUN2QkEsT0FBTyxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUFBLENBQzNCQSxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQUEsQ0FDekJELElBQUksQ0FBQyxDQUFDO0VBQ1g7O0VBRUE7QUFDRjtBQUNBO0VBQ0VsQixXQUFXQSxDQUFDckIsT0FBTyxFQUFFO0lBQ25CLE9BQU9BLE9BQU8sQ0FBQ3lDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQ3hGLE1BQU0sQ0FBQ3lGLElBQUksSUFBSUEsSUFBSSxDQUFDdkYsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDQSxNQUFNO0VBQ3BFOztFQUVBO0FBQ0Y7QUFDQTtFQUNFd0Ysa0JBQWtCQSxDQUFDaEYsUUFBUSxFQUFFO0lBQzNCLE1BQU14QixHQUFHLEdBQUdaLElBQUksQ0FBQ3dDLE9BQU8sQ0FBQ0osUUFBUSxDQUFDLENBQUNLLFdBQVcsQ0FBQyxDQUFDO0lBQ2hELE9BQU8sSUFBSSxDQUFDakMsTUFBTSxDQUFDQSxNQUFNLENBQUNDLFNBQVMsQ0FBQ2lDLFFBQVEsQ0FBQzlCLEdBQUcsQ0FBQztFQUNuRDs7RUFFQTtBQUNGO0FBQ0E7RUFDRStELGtCQUFrQkEsQ0FBQy9ELEdBQUcsRUFBRTtJQUN0QixNQUFNeUcsZ0JBQWdCLEdBQUcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUM7SUFDMUcsT0FBT0EsZ0JBQWdCLENBQUMzRSxRQUFRLENBQUM5QixHQUFHLENBQUM2QixXQUFXLENBQUMsQ0FBQyxDQUFDO0VBQ3JEO0FBQ0Y7QUFFQTZFLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHakgsbUJBQW1CIiwiaWdub3JlTGlzdCI6W119