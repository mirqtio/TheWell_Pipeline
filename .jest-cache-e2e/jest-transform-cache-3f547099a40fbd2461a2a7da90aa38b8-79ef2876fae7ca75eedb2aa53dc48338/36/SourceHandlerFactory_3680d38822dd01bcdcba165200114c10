b8eaf6743d7ba962fa1b359036a5c94c
const {
  SOURCE_TYPES
} = require('../types');
const StaticSourceHandler = require('./StaticSourceHandler');
const SemiStaticSourceHandler = require('./SemiStaticSourceHandler');
const DynamicConsistentSourceHandler = require('./DynamicConsistentSourceHandler');
const DynamicUnstructuredSourceHandler = require('./DynamicUnstructuredSourceHandler');

/**
 * Factory for creating source handlers
 */
class SourceHandlerFactory {
  constructor() {
    this.handlers = new Map();
    this.registerDefaultHandlers();
  }

  /**
   * Register default handlers
   */
  registerDefaultHandlers() {
    this.registerHandler(SOURCE_TYPES.STATIC, StaticSourceHandler);
    this.registerHandler(SOURCE_TYPES.SEMI_STATIC, SemiStaticSourceHandler);
    this.registerHandler(SOURCE_TYPES.DYNAMIC_CONSISTENT, DynamicConsistentSourceHandler);
    this.registerHandler(SOURCE_TYPES.DYNAMIC_UNSTRUCTURED, DynamicUnstructuredSourceHandler);
  }

  /**
   * Register a handler class for a source type
   */
  registerHandler(sourceType, handlerClass, force = false) {
    if (!sourceType || !handlerClass) {
      throw new Error('Source type and handler class are required');
    }
    if (this.handlers.has(sourceType) && !force) {
      throw new Error(`Handler for type ${sourceType} is already registered`);
    }
    this.handlers.set(sourceType, handlerClass);
  }

  /**
   * Unregister a handler for a source type
   */
  unregisterHandler(sourceType) {
    return this.handlers.delete(sourceType);
  }

  /**
   * Create a handler instance for the given configuration
   */
  createHandler(config) {
    if (!config) {
      throw new Error('Configuration is required');
    }
    if (!config.type) {
      throw new Error('Configuration must specify a type');
    }
    const HandlerClass = this.handlers.get(config.type);
    if (!HandlerClass) {
      throw new Error(`No handler registered for type: ${config.type}`);
    }
    return new HandlerClass(config);
  }

  /**
   * Check if a handler is registered for the given source type
   */
  hasHandler(sourceType) {
    return this.handlers.has(sourceType);
  }

  /**
   * Get all registered source types
   */
  getRegisteredTypes() {
    return Array.from(this.handlers.keys());
  }

  /**
   * Get handler class for source type
   */
  getHandlerClass(sourceType) {
    return this.handlers.get(sourceType) || null;
  }

  /**
   * Validate configuration for a source type
   */
  async validateConfig(config) {
    if (!config || !config.type) {
      throw new Error('Configuration with type is required');
    }
    const HandlerClass = this.handlers.get(config.type);
    if (!HandlerClass) {
      throw new Error(`No handler registered for source type: ${config.type}`);
    }

    // Create temporary instance to validate config
    const tempHandler = new HandlerClass(config);
    if (typeof tempHandler.validateConfig === 'function') {
      return await tempHandler.validateConfig(config);
    }
    return true;
  }

  /**
   * Validate handler configuration (alias for validateConfig)
   */
  async validateHandlerConfig(config) {
    return await this.validateConfig(config);
  }

  /**
   * Check if a handler type is supported
   */
  isTypeSupported(sourceType) {
    return this.handlers.has(sourceType);
  }

  /**
   * Validate multiple configurations
   */
  async validateHandlerConfigs(configs) {
    if (!Array.isArray(configs)) {
      throw new Error('Configurations must be an array');
    }
    const results = [];
    for (const config of configs) {
      try {
        await this.validateConfig(config);
        results.push({
          valid: true,
          config
        });
      } catch (error) {
        results.push({
          valid: false,
          config,
          error: error.message
        });
      }
    }
    return results;
  }

  /**
   * Get default configuration for a handler type
   */
  getDefaultConfig(sourceType) {
    const HandlerClass = this.handlers.get(sourceType);
    if (!HandlerClass) {
      return null;
    }

    // Return basic default config
    return {
      type: sourceType,
      enabled: true,
      config: {}
    };
  }

  /**
   * Merge user config with defaults
   */
  mergeWithDefaults(userConfig) {
    if (!userConfig || !userConfig.type) {
      throw new Error('User configuration with type is required');
    }
    const defaultConfig = this.getDefaultConfig(userConfig.type);
    if (!defaultConfig) {
      throw new Error(`No default configuration available for type: ${userConfig.type}`);
    }
    return {
      ...defaultConfig,
      ...userConfig,
      config: {
        ...defaultConfig.config,
        ...userConfig.config
      }
    };
  }

  /**
   * Initialize a handler
   */
  async initializeHandler(handler) {
    if (handler && typeof handler.initialize === 'function') {
      await handler.initialize();
    }
  }

  /**
   * Cleanup a handler
   */
  async cleanupHandler(handler) {
    if (handler && typeof handler.cleanup === 'function') {
      await handler.cleanup();
    }
  }

  /**
   * Create multiple handlers from configurations
   */
  createHandlers(configs) {
    if (!Array.isArray(configs)) {
      throw new Error('Configurations must be an array');
    }
    return configs.map(config => this.createHandler(config));
  }

  /**
   * Get factory statistics
   */
  getStats() {
    return {
      registeredTypes: this.handlers.size,
      types: Array.from(this.handlers.keys())
    };
  }

  /**
   * Clear all registered handlers
   */
  clear() {
    this.handlers.clear();
  }

  /**
   * Reset to default handlers
   */
  reset() {
    this.clear();
    this.registerDefaultHandlers();
  }
}
module.exports = SourceHandlerFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTT1VSQ0VfVFlQRVMiLCJyZXF1aXJlIiwiU3RhdGljU291cmNlSGFuZGxlciIsIlNlbWlTdGF0aWNTb3VyY2VIYW5kbGVyIiwiRHluYW1pY0NvbnNpc3RlbnRTb3VyY2VIYW5kbGVyIiwiRHluYW1pY1Vuc3RydWN0dXJlZFNvdXJjZUhhbmRsZXIiLCJTb3VyY2VIYW5kbGVyRmFjdG9yeSIsImNvbnN0cnVjdG9yIiwiaGFuZGxlcnMiLCJNYXAiLCJyZWdpc3RlckRlZmF1bHRIYW5kbGVycyIsInJlZ2lzdGVySGFuZGxlciIsIlNUQVRJQyIsIlNFTUlfU1RBVElDIiwiRFlOQU1JQ19DT05TSVNURU5UIiwiRFlOQU1JQ19VTlNUUlVDVFVSRUQiLCJzb3VyY2VUeXBlIiwiaGFuZGxlckNsYXNzIiwiZm9yY2UiLCJFcnJvciIsImhhcyIsInNldCIsInVucmVnaXN0ZXJIYW5kbGVyIiwiZGVsZXRlIiwiY3JlYXRlSGFuZGxlciIsImNvbmZpZyIsInR5cGUiLCJIYW5kbGVyQ2xhc3MiLCJnZXQiLCJoYXNIYW5kbGVyIiwiZ2V0UmVnaXN0ZXJlZFR5cGVzIiwiQXJyYXkiLCJmcm9tIiwia2V5cyIsImdldEhhbmRsZXJDbGFzcyIsInZhbGlkYXRlQ29uZmlnIiwidGVtcEhhbmRsZXIiLCJ2YWxpZGF0ZUhhbmRsZXJDb25maWciLCJpc1R5cGVTdXBwb3J0ZWQiLCJ2YWxpZGF0ZUhhbmRsZXJDb25maWdzIiwiY29uZmlncyIsImlzQXJyYXkiLCJyZXN1bHRzIiwicHVzaCIsInZhbGlkIiwiZXJyb3IiLCJtZXNzYWdlIiwiZ2V0RGVmYXVsdENvbmZpZyIsImVuYWJsZWQiLCJtZXJnZVdpdGhEZWZhdWx0cyIsInVzZXJDb25maWciLCJkZWZhdWx0Q29uZmlnIiwiaW5pdGlhbGl6ZUhhbmRsZXIiLCJoYW5kbGVyIiwiaW5pdGlhbGl6ZSIsImNsZWFudXBIYW5kbGVyIiwiY2xlYW51cCIsImNyZWF0ZUhhbmRsZXJzIiwibWFwIiwiZ2V0U3RhdHMiLCJyZWdpc3RlcmVkVHlwZXMiLCJzaXplIiwidHlwZXMiLCJjbGVhciIsInJlc2V0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIlNvdXJjZUhhbmRsZXJGYWN0b3J5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgU09VUkNFX1RZUEVTIH0gPSByZXF1aXJlKCcuLi90eXBlcycpO1xuY29uc3QgU3RhdGljU291cmNlSGFuZGxlciA9IHJlcXVpcmUoJy4vU3RhdGljU291cmNlSGFuZGxlcicpO1xuY29uc3QgU2VtaVN0YXRpY1NvdXJjZUhhbmRsZXIgPSByZXF1aXJlKCcuL1NlbWlTdGF0aWNTb3VyY2VIYW5kbGVyJyk7XG5jb25zdCBEeW5hbWljQ29uc2lzdGVudFNvdXJjZUhhbmRsZXIgPSByZXF1aXJlKCcuL0R5bmFtaWNDb25zaXN0ZW50U291cmNlSGFuZGxlcicpO1xuY29uc3QgRHluYW1pY1Vuc3RydWN0dXJlZFNvdXJjZUhhbmRsZXIgPSByZXF1aXJlKCcuL0R5bmFtaWNVbnN0cnVjdHVyZWRTb3VyY2VIYW5kbGVyJyk7XG5cbi8qKlxuICogRmFjdG9yeSBmb3IgY3JlYXRpbmcgc291cmNlIGhhbmRsZXJzXG4gKi9cbmNsYXNzIFNvdXJjZUhhbmRsZXJGYWN0b3J5IHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5oYW5kbGVycyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLnJlZ2lzdGVyRGVmYXVsdEhhbmRsZXJzKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgZGVmYXVsdCBoYW5kbGVyc1xuICAgKi9cbiAgcmVnaXN0ZXJEZWZhdWx0SGFuZGxlcnMoKSB7XG4gICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoU09VUkNFX1RZUEVTLlNUQVRJQywgU3RhdGljU291cmNlSGFuZGxlcik7XG4gICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoU09VUkNFX1RZUEVTLlNFTUlfU1RBVElDLCBTZW1pU3RhdGljU291cmNlSGFuZGxlcik7XG4gICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoU09VUkNFX1RZUEVTLkRZTkFNSUNfQ09OU0lTVEVOVCwgRHluYW1pY0NvbnNpc3RlbnRTb3VyY2VIYW5kbGVyKTtcbiAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcihTT1VSQ0VfVFlQRVMuRFlOQU1JQ19VTlNUUlVDVFVSRUQsIER5bmFtaWNVbnN0cnVjdHVyZWRTb3VyY2VIYW5kbGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGhhbmRsZXIgY2xhc3MgZm9yIGEgc291cmNlIHR5cGVcbiAgICovXG4gIHJlZ2lzdGVySGFuZGxlcihzb3VyY2VUeXBlLCBoYW5kbGVyQ2xhc3MsIGZvcmNlID0gZmFsc2UpIHtcbiAgICBpZiAoIXNvdXJjZVR5cGUgfHwgIWhhbmRsZXJDbGFzcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTb3VyY2UgdHlwZSBhbmQgaGFuZGxlciBjbGFzcyBhcmUgcmVxdWlyZWQnKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHRoaXMuaGFuZGxlcnMuaGFzKHNvdXJjZVR5cGUpICYmICFmb3JjZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBIYW5kbGVyIGZvciB0eXBlICR7c291cmNlVHlwZX0gaXMgYWxyZWFkeSByZWdpc3RlcmVkYCk7XG4gICAgfVxuICAgIFxuICAgIHRoaXMuaGFuZGxlcnMuc2V0KHNvdXJjZVR5cGUsIGhhbmRsZXJDbGFzcyk7XG4gIH1cblxuICAvKipcbiAgICogVW5yZWdpc3RlciBhIGhhbmRsZXIgZm9yIGEgc291cmNlIHR5cGVcbiAgICovXG4gIHVucmVnaXN0ZXJIYW5kbGVyKHNvdXJjZVR5cGUpIHtcbiAgICByZXR1cm4gdGhpcy5oYW5kbGVycy5kZWxldGUoc291cmNlVHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgaGFuZGxlciBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGNyZWF0ZUhhbmRsZXIoY29uZmlnKSB7XG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ29uZmlndXJhdGlvbiBpcyByZXF1aXJlZCcpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoIWNvbmZpZy50eXBlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbmZpZ3VyYXRpb24gbXVzdCBzcGVjaWZ5IGEgdHlwZScpO1xuICAgIH1cblxuICAgIGNvbnN0IEhhbmRsZXJDbGFzcyA9IHRoaXMuaGFuZGxlcnMuZ2V0KGNvbmZpZy50eXBlKTtcbiAgICBpZiAoIUhhbmRsZXJDbGFzcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBoYW5kbGVyIHJlZ2lzdGVyZWQgZm9yIHR5cGU6ICR7Y29uZmlnLnR5cGV9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBIYW5kbGVyQ2xhc3MoY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhIGhhbmRsZXIgaXMgcmVnaXN0ZXJlZCBmb3IgdGhlIGdpdmVuIHNvdXJjZSB0eXBlXG4gICAqL1xuICBoYXNIYW5kbGVyKHNvdXJjZVR5cGUpIHtcbiAgICByZXR1cm4gdGhpcy5oYW5kbGVycy5oYXMoc291cmNlVHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCByZWdpc3RlcmVkIHNvdXJjZSB0eXBlc1xuICAgKi9cbiAgZ2V0UmVnaXN0ZXJlZFR5cGVzKCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuaGFuZGxlcnMua2V5cygpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaGFuZGxlciBjbGFzcyBmb3Igc291cmNlIHR5cGVcbiAgICovXG4gIGdldEhhbmRsZXJDbGFzcyhzb3VyY2VUeXBlKSB7XG4gICAgcmV0dXJuIHRoaXMuaGFuZGxlcnMuZ2V0KHNvdXJjZVR5cGUpIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgY29uZmlndXJhdGlvbiBmb3IgYSBzb3VyY2UgdHlwZVxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVDb25maWcoY29uZmlnKSB7XG4gICAgaWYgKCFjb25maWcgfHwgIWNvbmZpZy50eXBlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbmZpZ3VyYXRpb24gd2l0aCB0eXBlIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgSGFuZGxlckNsYXNzID0gdGhpcy5oYW5kbGVycy5nZXQoY29uZmlnLnR5cGUpO1xuICAgIGlmICghSGFuZGxlckNsYXNzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGhhbmRsZXIgcmVnaXN0ZXJlZCBmb3Igc291cmNlIHR5cGU6ICR7Y29uZmlnLnR5cGV9YCk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHRlbXBvcmFyeSBpbnN0YW5jZSB0byB2YWxpZGF0ZSBjb25maWdcbiAgICBjb25zdCB0ZW1wSGFuZGxlciA9IG5ldyBIYW5kbGVyQ2xhc3MoY29uZmlnKTtcbiAgICBpZiAodHlwZW9mIHRlbXBIYW5kbGVyLnZhbGlkYXRlQ29uZmlnID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGVtcEhhbmRsZXIudmFsaWRhdGVDb25maWcoY29uZmlnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBoYW5kbGVyIGNvbmZpZ3VyYXRpb24gKGFsaWFzIGZvciB2YWxpZGF0ZUNvbmZpZylcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlSGFuZGxlckNvbmZpZyhjb25maWcpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy52YWxpZGF0ZUNvbmZpZyhjb25maWcpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGEgaGFuZGxlciB0eXBlIGlzIHN1cHBvcnRlZFxuICAgKi9cbiAgaXNUeXBlU3VwcG9ydGVkKHNvdXJjZVR5cGUpIHtcbiAgICByZXR1cm4gdGhpcy5oYW5kbGVycy5oYXMoc291cmNlVHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgbXVsdGlwbGUgY29uZmlndXJhdGlvbnNcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlSGFuZGxlckNvbmZpZ3MoY29uZmlncykge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShjb25maWdzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb25maWd1cmF0aW9ucyBtdXN0IGJlIGFuIGFycmF5Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoY29uc3QgY29uZmlnIG9mIGNvbmZpZ3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMudmFsaWRhdGVDb25maWcoY29uZmlnKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHsgdmFsaWQ6IHRydWUsIGNvbmZpZyB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7IHZhbGlkOiBmYWxzZSwgY29uZmlnLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZGVmYXVsdCBjb25maWd1cmF0aW9uIGZvciBhIGhhbmRsZXIgdHlwZVxuICAgKi9cbiAgZ2V0RGVmYXVsdENvbmZpZyhzb3VyY2VUeXBlKSB7XG4gICAgY29uc3QgSGFuZGxlckNsYXNzID0gdGhpcy5oYW5kbGVycy5nZXQoc291cmNlVHlwZSk7XG4gICAgaWYgKCFIYW5kbGVyQ2xhc3MpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIFJldHVybiBiYXNpYyBkZWZhdWx0IGNvbmZpZ1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBzb3VyY2VUeXBlLFxuICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgIGNvbmZpZzoge31cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE1lcmdlIHVzZXIgY29uZmlnIHdpdGggZGVmYXVsdHNcbiAgICovXG4gIG1lcmdlV2l0aERlZmF1bHRzKHVzZXJDb25maWcpIHtcbiAgICBpZiAoIXVzZXJDb25maWcgfHwgIXVzZXJDb25maWcudHlwZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIGNvbmZpZ3VyYXRpb24gd2l0aCB0eXBlIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgZGVmYXVsdENvbmZpZyA9IHRoaXMuZ2V0RGVmYXVsdENvbmZpZyh1c2VyQ29uZmlnLnR5cGUpO1xuICAgIGlmICghZGVmYXVsdENvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gYXZhaWxhYmxlIGZvciB0eXBlOiAke3VzZXJDb25maWcudHlwZX1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZyxcbiAgICAgIC4uLnVzZXJDb25maWcsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgLi4uZGVmYXVsdENvbmZpZy5jb25maWcsXG4gICAgICAgIC4uLnVzZXJDb25maWcuY29uZmlnXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGEgaGFuZGxlclxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZUhhbmRsZXIoaGFuZGxlcikge1xuICAgIGlmIChoYW5kbGVyICYmIHR5cGVvZiBoYW5kbGVyLmluaXRpYWxpemUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGF3YWl0IGhhbmRsZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIGEgaGFuZGxlclxuICAgKi9cbiAgYXN5bmMgY2xlYW51cEhhbmRsZXIoaGFuZGxlcikge1xuICAgIGlmIChoYW5kbGVyICYmIHR5cGVvZiBoYW5kbGVyLmNsZWFudXAgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGF3YWl0IGhhbmRsZXIuY2xlYW51cCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgbXVsdGlwbGUgaGFuZGxlcnMgZnJvbSBjb25maWd1cmF0aW9uc1xuICAgKi9cbiAgY3JlYXRlSGFuZGxlcnMoY29uZmlncykge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShjb25maWdzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb25maWd1cmF0aW9ucyBtdXN0IGJlIGFuIGFycmF5Jyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbmZpZ3MubWFwKGNvbmZpZyA9PiB0aGlzLmNyZWF0ZUhhbmRsZXIoY29uZmlnKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZhY3Rvcnkgc3RhdGlzdGljc1xuICAgKi9cbiAgZ2V0U3RhdHMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlZ2lzdGVyZWRUeXBlczogdGhpcy5oYW5kbGVycy5zaXplLFxuICAgICAgdHlwZXM6IEFycmF5LmZyb20odGhpcy5oYW5kbGVycy5rZXlzKCkpXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciBhbGwgcmVnaXN0ZXJlZCBoYW5kbGVyc1xuICAgKi9cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5oYW5kbGVycy5jbGVhcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRvIGRlZmF1bHQgaGFuZGxlcnNcbiAgICovXG4gIHJlc2V0KCkge1xuICAgIHRoaXMuY2xlYXIoKTtcbiAgICB0aGlzLnJlZ2lzdGVyRGVmYXVsdEhhbmRsZXJzKCk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTb3VyY2VIYW5kbGVyRmFjdG9yeTtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTTtFQUFFQTtBQUFhLENBQUMsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUM1QyxNQUFNQyxtQkFBbUIsR0FBR0QsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQzVELE1BQU1FLHVCQUF1QixHQUFHRixPQUFPLENBQUMsMkJBQTJCLENBQUM7QUFDcEUsTUFBTUcsOEJBQThCLEdBQUdILE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQztBQUNsRixNQUFNSSxnQ0FBZ0MsR0FBR0osT0FBTyxDQUFDLG9DQUFvQyxDQUFDOztBQUV0RjtBQUNBO0FB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