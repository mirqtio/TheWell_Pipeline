{"version":3,"names":["crypto","require","axios","BaseSourceHandler","SOURCE_TYPES","VISIBILITY_LEVELS","SemiStaticSourceHandler","constructor","config","httpClient","lastPollTime","initialize","logger","info","sourceId","id","endpoints","Array","isArray","Error","create","timeout","headers","authentication","_configureAuthentication","endpoint","head","url","error","name","message","validateConfig","required","missing","filter","field","length","join","validAuthTypes","includes","type","discover","endpointCount","documents","debug","lastModified","_checkLastModified","document","_generateDocumentId","contentType","metadata","sourceType","SEMI_STATIC","originalUrl","endpointName","visibility","EXTERNAL","pollFrequency","tags","customMetadata","push","warn","documentsFound","extract","documentId","response","get","_getAcceptHeader","toUTCString","undefined","status","content","data","contentHash","createHash","update","JSON","stringify","digest","extractedAt","Date","httpStatus","extractionMethod","responseHeaders","_sanitizeHeaders","contentLength","etag","transform","extractedContent","transformedContent","title","htmlTransform","_transformHtml","jsonTransform","_transformJson","_transformPlainText","transformed","transformedAt","wordCount","_countWords","characterCount","split","auth","defaults","common","token","username","password","headerName","key","_checkForChanges","currentEtag","currentLastModified","currentDate","storedDate","acceptMap","sanitized","keepHeaders","header","html","titleMatch","match","trim","replace","json","parse","heading","body","text","description","word","cleanup","module","exports"],"sources":["SemiStaticSourceHandler.js"],"sourcesContent":["const crypto = require('crypto');\nconst axios = require('axios');\nconst { BaseSourceHandler, SOURCE_TYPES, VISIBILITY_LEVELS } = require('../types');\n\n/**\n * Semi-Static Source Handler\n * Handles weekly polling of platform policies and semi-static content\n * Examples: Terms of Service, Privacy Policies, API documentation\n */\nclass SemiStaticSourceHandler extends BaseSourceHandler {\n  constructor(config) {\n    super(config);\n    this.httpClient = null;\n    this.lastPollTime = null;\n  }\n\n  /**\n   * Initialize the semi-static source handler\n   */\n  async initialize() {\n    this.logger?.info('Initializing SemiStaticSourceHandler', { sourceId: this.config.id });\n    \n    // Validate required configuration\n    if (!this.config.config?.endpoints || !Array.isArray(this.config.config.endpoints)) {\n      throw new Error('SemiStaticSourceHandler requires config.endpoints array');\n    }\n\n    // Initialize HTTP client with default settings\n    this.httpClient = axios.create({\n      timeout: this.config.config.timeout || 30000,\n      headers: {\n        'User-Agent': 'TheWell-Pipeline/1.0',\n        ...this.config.config.headers\n      }\n    });\n\n    // Add authentication if configured\n    if (this.config.authentication) {\n      this._configureAuthentication();\n    }\n\n    // Validate endpoint accessibility\n    for (const endpoint of this.config.config.endpoints) {\n      try {\n        await this.httpClient.head(endpoint.url);\n      } catch (error) {\n        throw new Error(`Failed to validate endpoint ${endpoint.name}: ${error.message}`);\n      }\n    }\n\n    this.logger?.info('SemiStaticSourceHandler initialized successfully');\n  }\n\n  /**\n   * Validate semi-static source configuration\n   */\n  async validateConfig(config) {\n    const required = ['baseUrl', 'endpoints'];\n    const missing = required.filter(field => !config.config?.[field]);\n    \n    if (missing.length > 0) {\n      throw new Error(`Missing required config fields: ${missing.join(', ')}`);\n    }\n\n    // Validate endpoints array\n    if (!Array.isArray(config.config.endpoints) || config.config.endpoints.length === 0) {\n      throw new Error('endpoints must be a non-empty array');\n    }\n\n    // Validate each endpoint\n    for (const endpoint of config.config.endpoints) {\n      if (!endpoint.url || !endpoint.name) {\n        throw new Error('Each endpoint must have url and name properties');\n      }\n    }\n\n    // Validate authentication if present\n    if (config.config.authentication) {\n      const validAuthTypes = ['bearer', 'basic', 'api-key'];\n      if (!validAuthTypes.includes(config.config.authentication.type)) {\n        throw new Error(`Invalid authentication type: ${config.config.authentication.type}`);\n      }\n    }\n\n    // Validate endpoint accessibility if httpClient is available\n    if (this.httpClient) {\n      for (const endpoint of config.config.endpoints) {\n        try {\n          await this.httpClient.head(endpoint.url);\n        } catch (error) {\n          throw new Error('Endpoint validation failed');\n        }\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Discover documents from configured endpoints\n   */\n  async discover() {\n    this.logger?.info('Starting discovery for semi-static source', { \n      sourceId: this.config.id,\n      endpointCount: this.config.config.endpoints.length \n    });\n\n    const documents = [];\n    const endpoints = this.config.config.endpoints;\n\n    for (const endpoint of endpoints) {\n      try {\n        this.logger?.debug('Discovering endpoint', { \n          sourceId: this.config.id,\n          endpoint: endpoint.name,\n          url: endpoint.url \n        });\n\n        // Check if endpoint has changed since last poll\n        const lastModified = await this._checkLastModified(endpoint);\n        \n        const document = {\n          id: this._generateDocumentId(endpoint.url),\n          url: endpoint.url,\n          name: endpoint.name,\n          type: endpoint.type || 'webpage',\n          lastModified,\n          contentType: endpoint.contentType || 'text/html',\n          metadata: {\n            sourceId: this.config.id,\n            sourceType: SOURCE_TYPES.SEMI_STATIC,\n            originalUrl: endpoint.url,\n            endpointName: endpoint.name,\n            visibility: endpoint.visibility || this.config.visibility || VISIBILITY_LEVELS.EXTERNAL,\n            pollFrequency: this.config.config.pollFrequency || 'weekly',\n            tags: endpoint.tags || [],\n            customMetadata: endpoint.metadata || {}\n          }\n        };\n\n        documents.push(document);\n      } catch (error) {\n        this.logger?.warn('Error discovering endpoint', { \n          sourceId: this.config.id,\n          endpoint: endpoint.name,\n          error: error.message \n        });\n      }\n    }\n\n    this.logger?.info('Discovery completed', { \n      sourceId: this.config.id,\n      documentsFound: documents.length \n    });\n\n    return documents;\n  }\n\n  /**\n   * Extract content from a semi-static endpoint\n   */\n  async extract(document) {\n    this.logger?.info('Extracting content from document', { \n      documentId: document.id,\n      url: document.url \n    });\n\n    try {\n      const response = await this.httpClient.get(document.url, {\n        headers: {\n          'Accept': this._getAcceptHeader(document.contentType),\n          'If-Modified-Since': document.lastModified ? document.lastModified.toUTCString() : undefined\n        }\n      });\n\n      // Handle 304 Not Modified\n      if (response.status === 304) {\n        this.logger?.info('Content not modified since last fetch', { \n          documentId: document.id \n        });\n        return null;\n      }\n\n      const content = response.data;\n      const contentHash = crypto.createHash('sha256').update(JSON.stringify(content)).digest('hex');\n\n      return {\n        id: document.id,\n        content,\n        contentHash,\n        extractedAt: new Date(),\n        httpStatus: response.status,\n        headers: response.headers,\n        metadata: {\n          ...document.metadata,\n          extractionMethod: 'http-request',\n          responseHeaders: this._sanitizeHeaders(response.headers),\n          contentLength: response.headers['content-length'],\n          lastModified: response.headers['last-modified'],\n          etag: response.headers.etag\n        }\n      };\n    } catch (error) {\n      if (error.response?.status === 404) {\n        this.logger?.warn('Document not found', { \n          documentId: document.id,\n          url: document.url \n        });\n        return null;\n      }\n\n      this.logger?.error('Content extraction failed', { \n        documentId: document.id,\n        url: document.url,\n        error: error.message,\n        status: error.response?.status \n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Transform extracted content to standard format\n   */\n  async transform(extractedContent) {\n    if (!extractedContent) {\n      return null; // Content not modified\n    }\n\n    this.logger?.debug('Transforming content', { \n      documentId: extractedContent.id \n    });\n\n    const contentType = extractedContent.metadata.responseHeaders?.['content-type'] || \n                        extractedContent.metadata.contentType || '';\n    let transformedContent = extractedContent.content;\n    let title = extractedContent.metadata.endpointName || extractedContent.metadata.endpoint;\n\n    // Transform based on content type\n    if (contentType.includes('text/html')) {\n      const htmlTransform = this._transformHtml(extractedContent.content);\n      transformedContent = htmlTransform.content;\n      title = htmlTransform.title || title;\n    } else if (contentType.includes('application/json')) {\n      const jsonTransform = this._transformJson(extractedContent.content);\n      transformedContent = jsonTransform.content;\n      title = jsonTransform.title || title;\n    } else if (contentType.includes('text/plain')) {\n      transformedContent = this._transformPlainText(extractedContent.content);\n    }\n\n    const transformed = {\n      id: extractedContent.id,\n      title,\n      content: transformedContent,\n      contentHash: extractedContent.contentHash,\n      metadata: {\n        ...extractedContent.metadata,\n        transformedAt: new Date(),\n        wordCount: this._countWords(transformedContent),\n        characterCount: transformedContent.length,\n        contentType: contentType.split(';')[0] // Remove charset info\n      }\n    };\n\n    return transformed;\n  }\n\n  /**\n   * Configure authentication for HTTP requests\n   */\n  _configureAuthentication() {\n    const auth = this.config.authentication;\n    \n    if (auth.type === 'bearer') {\n      this.httpClient.defaults.headers.common['Authorization'] = `Bearer ${auth.token}`;\n    } else if (auth.type === 'basic') {\n      this.httpClient.defaults.auth = {\n        username: auth.username,\n        password: auth.password\n      };\n    } else if (auth.type === 'api-key') {\n      this.httpClient.defaults.headers.common[auth.headerName || 'X-API-Key'] = auth.key;\n    }\n  }\n\n  /**\n   * Check last modified date for an endpoint\n   */\n  async _checkLastModified(endpoint) {\n    try {\n      const response = await this.httpClient.head(endpoint.url);\n      const lastModified = response.headers['last-modified'];\n      return lastModified ? new Date(lastModified) : new Date();\n    } catch (error) {\n      this.logger?.debug('Could not check last modified date', { \n        endpoint: endpoint.name,\n        error: error.message \n      });\n      return new Date();\n    }\n  }\n\n  /**\n   * Check if document has changed since last fetch using ETag or last-modified\n   */\n  async _checkForChanges(document) {\n    try {\n      const response = await this.httpClient.head(document.url);\n      const currentEtag = response.headers.etag;\n      const currentLastModified = response.headers['last-modified'];\n      \n      // Check ETag first if available\n      if (currentEtag && document.metadata.etag) {\n        return currentEtag !== document.metadata.etag;\n      }\n      \n      // Fallback to last-modified comparison\n      if (currentLastModified && document.metadata.lastModified) {\n        const currentDate = new Date(currentLastModified);\n        const storedDate = new Date(document.metadata.lastModified);\n        return currentDate > storedDate;\n      }\n      \n      // If no comparison data available, assume changed\n      return true;\n    } catch (error) {\n      this.logger?.debug('Could not check for changes', { \n        documentId: document.id,\n        error: error.message \n      });\n      return true; // Assume changed on error\n    }\n  }\n\n  /**\n   * Generate appropriate Accept header based on content type\n   */\n  _getAcceptHeader(contentType) {\n    const acceptMap = {\n      'text/html': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n      'application/json': 'application/json,*/*;q=0.8',\n      'text/plain': 'text/plain,*/*;q=0.8'\n    };\n    \n    return acceptMap[contentType] || '*/*';\n  }\n\n  /**\n   * Sanitize response headers for storage\n   */\n  _sanitizeHeaders(headers) {\n    const sanitized = {};\n    const keepHeaders = ['content-type', 'content-length', 'last-modified', 'etag', 'cache-control'];\n    \n    for (const header of keepHeaders) {\n      if (headers[header]) {\n        sanitized[header] = headers[header];\n      }\n    }\n    \n    return sanitized;\n  }\n\n  /**\n   * Transform HTML content\n   */\n  _transformHtml(html) {\n    // Basic HTML parsing - would use a proper parser like cheerio in production\n    const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n    const title = titleMatch ? titleMatch[1].trim() : null;\n    \n    // Remove title, scripts, styles, then extract text content\n    let content = html\n      .replace(/<title[^>]*>[\\s\\S]*?<\\/title>/gi, '') // Remove title\n      .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '') // Remove scripts\n      .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '') // Remove styles\n      .replace(/<[^>]+>/g, ' ') // Remove HTML tags\n      .replace(/\\s+/g, ' ') // Normalize whitespace\n      .trim();\n    \n    return { title, content };\n  }\n\n  /**\n   * Transform JSON content by extracting title and content\n   */\n  _transformJson(json) {\n    if (typeof json === 'string') {\n      try {\n        json = JSON.parse(json);\n      } catch (error) {\n        return { content: json, title: null }; // Return as-is if not valid JSON\n      }\n    }\n    \n    // Extract title and content from JSON\n    let title = null;\n    let content = null;\n    \n    if (json && typeof json === 'object') {\n      // Try common title fields\n      title = json.title || json.name || json.heading || null;\n      \n      // Try common content fields\n      content = json.content || json.body || json.text || json.description || null;\n      \n      // If no specific content field, use the whole JSON as content\n      if (!content) {\n        content = JSON.stringify(json, null, 2);\n      }\n    } else {\n      content = JSON.stringify(json, null, 2);\n    }\n    \n    return { title, content };\n  }\n\n  /**\n   * Transform plain text content\n   */\n  _transformPlainText(text) {\n    return text\n      .replace(/\\r\\n/g, '\\n') // Normalize line endings\n      .replace(/\\n{3,}/g, '\\n\\n') // Remove excessive newlines\n      .trim();\n  }\n\n  /**\n   * Generate unique document ID based on URL\n   */\n  _generateDocumentId(url) {\n    return crypto.createHash('md5').update(url).digest('hex');\n  }\n\n  /**\n   * Count words in content\n   */\n  _countWords(content) {\n    return content.split(/\\s+/).filter(word => word.length > 0).length;\n  }\n\n  /**\n   * Clean up resources\n   */\n  async cleanup() {\n    this.logger?.info('Cleaning up SemiStaticSourceHandler', { sourceId: this.config.id });\n    // No specific cleanup needed for HTTP client\n  }\n}\n\nmodule.exports = SemiStaticSourceHandler;\n"],"mappings":"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","ignoreList":[]}