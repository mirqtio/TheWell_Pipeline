50788a60bb71b2b098987ad60cc0425b
const logger = require('../utils/logger');

/**
 * DocumentDAO - Data Access Object for documents
 */
class DocumentDAO {
  constructor(databaseManager) {
    this.db = databaseManager;
  }

  /**
     * Create a new document
     */
  async create(documentData) {
    const {
      source_id,
      external_id,
      title,
      content,
      content_type = 'text/plain',
      url,
      metadata = {},
      hash,
      word_count,
      language
    } = documentData;
    try {
      const query = `
                INSERT INTO documents (
                    source_id, external_id, title, content, content_type,
                    url, metadata, hash, word_count, language
                ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
                RETURNING *
            `;
      const values = [source_id, external_id, title, content, content_type, url, JSON.stringify(metadata), hash, word_count, language];
      const result = await this.db.query(query, values);
      logger.info('Document created', {
        document_id: result.rows[0].id
      });
      return result.rows[0];
    } catch (error) {
      logger.error('Failed to create document', {
        error: error.message,
        documentData
      });
      throw error;
    }
  }

  /**
     * Find document by ID
     */
  async findById(id) {
    try {
      const query = `
                SELECT d.*, dv.visibility_level, dv.access_groups
                FROM documents d
                LEFT JOIN document_visibility dv ON d.id = dv.document_id
                WHERE d.id = $1
            `;
      const result = await this.db.query(query, [id]);
      return result.rows[0] || null;
    } catch (error) {
      logger.error('Failed to find document by ID', {
        error: error.message,
        id
      });
      throw error;
    }
  }

  /**
     * Find document by hash (for deduplication)
     */
  async findByHash(hash) {
    try {
      const query = 'SELECT * FROM documents WHERE hash = $1';
      const result = await this.db.query(query, [hash]);
      return result.rows[0] || null;
    } catch (error) {
      logger.error('Failed to find document by hash', {
        error: error.message,
        hash
      });
      throw error;
    }
  }

  /**
     * Search documents with full-text search
     */
  async search(searchTerm, options = {}) {
    const {
      limit = 50,
      offset = 0,
      source_id,
      visibility_level,
      content_type,
      language
    } = options;
    try {
      let query = `
                SELECT d.*, dv.visibility_level, dv.access_groups,
                       ts_rank(d.search_vector, plainto_tsquery('english', $1)) as rank
                FROM documents d
                LEFT JOIN document_visibility dv ON d.id = dv.document_id
                WHERE d.search_vector @@ plainto_tsquery('english', $1)
            `;
      const values = [searchTerm];
      let paramCount = 1;
      if (source_id) {
        query += ` AND d.source_id = $${++paramCount}`;
        values.push(source_id);
      }
      if (visibility_level) {
        query += ` AND dv.visibility_level = $${++paramCount}`;
        values.push(visibility_level);
      }
      if (content_type) {
        query += ` AND d.content_type = $${++paramCount}`;
        values.push(content_type);
      }
      if (language) {
        query += ` AND d.language = $${++paramCount}`;
        values.push(language);
      }
      query += ` ORDER BY rank DESC, d.created_at DESC LIMIT $${++paramCount} OFFSET $${++paramCount}`;
      values.push(limit, offset);
      const result = await this.db.query(query, values);
      return result.rows;
    } catch (error) {
      logger.error('Failed to search documents', {
        error: error.message,
        searchTerm,
        options
      });
      throw error;
    }
  }

  /**
     * Get documents by source
     */
  async findBySource(source_id, options = {}) {
    const {
      limit = 100,
      offset = 0,
      order = 'created_at DESC'
    } = options;
    try {
      const query = `
                SELECT d.*, dv.visibility_level, dv.access_groups
                FROM documents d
                LEFT JOIN document_visibility dv ON d.id = dv.document_id
                WHERE d.source_id = $1
                ORDER BY ${order}
                LIMIT $2 OFFSET $3
            `;
      const result = await this.db.query(query, [source_id, limit, offset]);
      return result.rows;
    } catch (error) {
      logger.error('Failed to find documents by source', {
        error: error.message,
        source_id
      });
      throw error;
    }
  }

  /**
     * Update document
     */
  async update(id, updateData) {
    try {
      const fields = [];
      const values = [];
      let paramCount = 0;
      for (const [key, value] of Object.entries(updateData)) {
        if (key === 'metadata') {
          fields.push(`${key} = $${++paramCount}`);
          values.push(JSON.stringify(value));
        } else {
          fields.push(`${key} = $${++paramCount}`);
          values.push(value);
        }
      }
      if (fields.length === 0) {
        throw new Error('No fields to update');
      }
      const query = `
                UPDATE documents 
                SET ${fields.join(', ')}, updated_at = NOW()
                WHERE id = $${++paramCount}
                RETURNING *
            `;
      values.push(id);
      const result = await this.db.query(query, values);
      if (result.rows.length === 0) {
        throw new Error('Document not found');
      }
      logger.info('Document updated', {
        document_id: id
      });
      return result.rows[0];
    } catch (error) {
      logger.error('Failed to update document', {
        error: error.message,
        id,
        updateData
      });
      throw error;
    }
  }

  /**
     * Delete document
     */
  async delete(id) {
    try {
      const query = 'DELETE FROM documents WHERE id = $1 RETURNING id';
      const result = await this.db.query(query, [id]);
      if (result.rows.length === 0) {
        throw new Error('Document not found');
      }
      logger.info('Document deleted', {
        document_id: id
      });
      return true;
    } catch (error) {
      logger.error('Failed to delete document', {
        error: error.message,
        id
      });
      throw error;
    }
  }

  /**
     * Get documents pending review
     */
  async findPendingReview(options = {}) {
    const {
      limit = 50,
      offset = 0
    } = options;
    try {
      const query = `
                SELECT d.*, dv.visibility_level
                FROM documents d
                LEFT JOIN document_visibility dv ON d.id = dv.document_id
                LEFT JOIN document_reviews dr ON d.id = dr.document_id
                WHERE dr.id IS NULL
                ORDER BY d.created_at ASC
                LIMIT $1 OFFSET $2
            `;
      const result = await this.db.query(query, [limit, offset]);
      return result.rows;
    } catch (error) {
      logger.error('Failed to find documents pending review', {
        error: error.message
      });
      throw error;
    }
  }

  /**
     * Get document statistics
     */
  async getStats() {
    try {
      const queries = [{
        key: 'total',
        query: 'SELECT COUNT(*) as count FROM documents'
      }, {
        key: 'by_visibility',
        query: `
                    SELECT dv.visibility_level, COUNT(*) as count
                    FROM documents d
                    LEFT JOIN document_visibility dv ON d.id = dv.document_id
                    GROUP BY dv.visibility_level
                `
      }, {
        key: 'by_content_type',
        query: `
                    SELECT content_type, COUNT(*) as count
                    FROM documents
                    GROUP BY content_type
                    ORDER BY count DESC
                `
      }, {
        key: 'recent',
        query: `
                    SELECT COUNT(*) as count
                    FROM documents
                    WHERE created_at > NOW() - INTERVAL '24 hours'
                `
      }];
      const stats = {};
      for (const {
        key,
        query
      } of queries) {
        const result = await this.db.query(query);
        if (key === 'total' || key === 'recent') {
          stats[key] = parseInt(result.rows[0].count);
        } else {
          stats[key] = result.rows;
        }
      }
      return stats;
    } catch (error) {
      logger.error('Failed to get document stats', {
        error: error.message
      });
      throw error;
    }
  }

  /**
     * Bulk create documents
     */
  async bulkCreate(documents) {
    try {
      const results = [];
      await this.db.transaction(async client => {
        for (const doc of documents) {
          const query = `
                        INSERT INTO documents (
                            source_id, external_id, title, content, content_type,
                            url, metadata, hash, word_count, language
                        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
                        RETURNING *
                    `;
          const values = [doc.source_id, doc.external_id, doc.title, doc.content, doc.content_type || 'text/plain', doc.url, JSON.stringify(doc.metadata || {}), doc.hash, doc.word_count, doc.language];
          const result = await client.query(query, values);
          results.push(result.rows[0]);
        }
      });
      logger.info('Bulk document creation completed', {
        count: results.length
      });
      return results;
    } catch (error) {
      logger.error('Failed to bulk create documents', {
        error: error.message
      });
      throw error;
    }
  }
}
module.exports = DocumentDAO;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiRG9jdW1lbnREQU8iLCJjb25zdHJ1Y3RvciIsImRhdGFiYXNlTWFuYWdlciIsImRiIiwiY3JlYXRlIiwiZG9jdW1lbnREYXRhIiwic291cmNlX2lkIiwiZXh0ZXJuYWxfaWQiLCJ0aXRsZSIsImNvbnRlbnQiLCJjb250ZW50X3R5cGUiLCJ1cmwiLCJtZXRhZGF0YSIsImhhc2giLCJ3b3JkX2NvdW50IiwibGFuZ3VhZ2UiLCJxdWVyeSIsInZhbHVlcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXN1bHQiLCJpbmZvIiwiZG9jdW1lbnRfaWQiLCJyb3dzIiwiaWQiLCJlcnJvciIsIm1lc3NhZ2UiLCJmaW5kQnlJZCIsImZpbmRCeUhhc2giLCJzZWFyY2giLCJzZWFyY2hUZXJtIiwib3B0aW9ucyIsImxpbWl0Iiwib2Zmc2V0IiwidmlzaWJpbGl0eV9sZXZlbCIsInBhcmFtQ291bnQiLCJwdXNoIiwiZmluZEJ5U291cmNlIiwib3JkZXIiLCJ1cGRhdGUiLCJ1cGRhdGVEYXRhIiwiZmllbGRzIiwia2V5IiwidmFsdWUiLCJPYmplY3QiLCJlbnRyaWVzIiwibGVuZ3RoIiwiRXJyb3IiLCJqb2luIiwiZGVsZXRlIiwiZmluZFBlbmRpbmdSZXZpZXciLCJnZXRTdGF0cyIsInF1ZXJpZXMiLCJzdGF0cyIsInBhcnNlSW50IiwiY291bnQiLCJidWxrQ3JlYXRlIiwiZG9jdW1lbnRzIiwicmVzdWx0cyIsInRyYW5zYWN0aW9uIiwiY2xpZW50IiwiZG9jIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIkRvY3VtZW50REFPLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJy4uL3V0aWxzL2xvZ2dlcicpO1xuXG4vKipcbiAqIERvY3VtZW50REFPIC0gRGF0YSBBY2Nlc3MgT2JqZWN0IGZvciBkb2N1bWVudHNcbiAqL1xuY2xhc3MgRG9jdW1lbnREQU8ge1xuICBjb25zdHJ1Y3RvcihkYXRhYmFzZU1hbmFnZXIpIHtcbiAgICB0aGlzLmRiID0gZGF0YWJhc2VNYW5hZ2VyO1xuICB9XG5cbiAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IGRvY3VtZW50XG4gICAgICovXG4gIGFzeW5jIGNyZWF0ZShkb2N1bWVudERhdGEpIHtcbiAgICBjb25zdCB7XG4gICAgICBzb3VyY2VfaWQsXG4gICAgICBleHRlcm5hbF9pZCxcbiAgICAgIHRpdGxlLFxuICAgICAgY29udGVudCxcbiAgICAgIGNvbnRlbnRfdHlwZSA9ICd0ZXh0L3BsYWluJyxcbiAgICAgIHVybCxcbiAgICAgIG1ldGFkYXRhID0ge30sXG4gICAgICBoYXNoLFxuICAgICAgd29yZF9jb3VudCxcbiAgICAgIGxhbmd1YWdlXG4gICAgfSA9IGRvY3VtZW50RGF0YTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgICAgICAgICBJTlNFUlQgSU5UTyBkb2N1bWVudHMgKFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfaWQsIGV4dGVybmFsX2lkLCB0aXRsZSwgY29udGVudCwgY29udGVudF90eXBlLFxuICAgICAgICAgICAgICAgICAgICB1cmwsIG1ldGFkYXRhLCBoYXNoLCB3b3JkX2NvdW50LCBsYW5ndWFnZVxuICAgICAgICAgICAgICAgICkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5LCAkMTApXG4gICAgICAgICAgICAgICAgUkVUVVJOSU5HICpcbiAgICAgICAgICAgIGA7XG4gICAgICAgICAgICBcbiAgICAgIGNvbnN0IHZhbHVlcyA9IFtcbiAgICAgICAgc291cmNlX2lkLCBleHRlcm5hbF9pZCwgdGl0bGUsIGNvbnRlbnQsIGNvbnRlbnRfdHlwZSxcbiAgICAgICAgdXJsLCBKU09OLnN0cmluZ2lmeShtZXRhZGF0YSksIGhhc2gsIHdvcmRfY291bnQsIGxhbmd1YWdlXG4gICAgICBdO1xuICAgICAgICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5KHF1ZXJ5LCB2YWx1ZXMpO1xuICAgICAgbG9nZ2VyLmluZm8oJ0RvY3VtZW50IGNyZWF0ZWQnLCB7IGRvY3VtZW50X2lkOiByZXN1bHQucm93c1swXS5pZCB9KTtcbiAgICAgICAgICAgIFxuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgZG9jdW1lbnQnLCB7IGVycm9yOiBlcnJvci5tZXNzYWdlLCBkb2N1bWVudERhdGEgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAgKiBGaW5kIGRvY3VtZW50IGJ5IElEXG4gICAgICovXG4gIGFzeW5jIGZpbmRCeUlkKGlkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgICAgICAgICAgIFNFTEVDVCBkLiosIGR2LnZpc2liaWxpdHlfbGV2ZWwsIGR2LmFjY2Vzc19ncm91cHNcbiAgICAgICAgICAgICAgICBGUk9NIGRvY3VtZW50cyBkXG4gICAgICAgICAgICAgICAgTEVGVCBKT0lOIGRvY3VtZW50X3Zpc2liaWxpdHkgZHYgT04gZC5pZCA9IGR2LmRvY3VtZW50X2lkXG4gICAgICAgICAgICAgICAgV0hFUkUgZC5pZCA9ICQxXG4gICAgICAgICAgICBgO1xuICAgICAgICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5KHF1ZXJ5LCBbaWRdKTtcbiAgICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBmaW5kIGRvY3VtZW50IGJ5IElEJywgeyBlcnJvcjogZXJyb3IubWVzc2FnZSwgaWQgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAgKiBGaW5kIGRvY3VtZW50IGJ5IGhhc2ggKGZvciBkZWR1cGxpY2F0aW9uKVxuICAgICAqL1xuICBhc3luYyBmaW5kQnlIYXNoKGhhc2gpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcXVlcnkgPSAnU0VMRUNUICogRlJPTSBkb2N1bWVudHMgV0hFUkUgaGFzaCA9ICQxJztcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnkocXVlcnksIFtoYXNoXSk7XG4gICAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZmluZCBkb2N1bWVudCBieSBoYXNoJywgeyBlcnJvcjogZXJyb3IubWVzc2FnZSwgaGFzaCB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgICAqIFNlYXJjaCBkb2N1bWVudHMgd2l0aCBmdWxsLXRleHQgc2VhcmNoXG4gICAgICovXG4gIGFzeW5jIHNlYXJjaChzZWFyY2hUZXJtLCBvcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB7XG4gICAgICBsaW1pdCA9IDUwLFxuICAgICAgb2Zmc2V0ID0gMCxcbiAgICAgIHNvdXJjZV9pZCxcbiAgICAgIHZpc2liaWxpdHlfbGV2ZWwsXG4gICAgICBjb250ZW50X3R5cGUsXG4gICAgICBsYW5ndWFnZVxuICAgIH0gPSBvcHRpb25zO1xuXG4gICAgdHJ5IHtcbiAgICAgIGxldCBxdWVyeSA9IGBcbiAgICAgICAgICAgICAgICBTRUxFQ1QgZC4qLCBkdi52aXNpYmlsaXR5X2xldmVsLCBkdi5hY2Nlc3NfZ3JvdXBzLFxuICAgICAgICAgICAgICAgICAgICAgICB0c19yYW5rKGQuc2VhcmNoX3ZlY3RvciwgcGxhaW50b190c3F1ZXJ5KCdlbmdsaXNoJywgJDEpKSBhcyByYW5rXG4gICAgICAgICAgICAgICAgRlJPTSBkb2N1bWVudHMgZFxuICAgICAgICAgICAgICAgIExFRlQgSk9JTiBkb2N1bWVudF92aXNpYmlsaXR5IGR2IE9OIGQuaWQgPSBkdi5kb2N1bWVudF9pZFxuICAgICAgICAgICAgICAgIFdIRVJFIGQuc2VhcmNoX3ZlY3RvciBAQCBwbGFpbnRvX3RzcXVlcnkoJ2VuZ2xpc2gnLCAkMSlcbiAgICAgICAgICAgIGA7XG4gICAgICAgICAgICBcbiAgICAgIGNvbnN0IHZhbHVlcyA9IFtzZWFyY2hUZXJtXTtcbiAgICAgIGxldCBwYXJhbUNvdW50ID0gMTtcbiAgICAgICAgICAgIFxuICAgICAgaWYgKHNvdXJjZV9pZCkge1xuICAgICAgICBxdWVyeSArPSBgIEFORCBkLnNvdXJjZV9pZCA9ICQkeysrcGFyYW1Db3VudH1gO1xuICAgICAgICB2YWx1ZXMucHVzaChzb3VyY2VfaWQpO1xuICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICBpZiAodmlzaWJpbGl0eV9sZXZlbCkge1xuICAgICAgICBxdWVyeSArPSBgIEFORCBkdi52aXNpYmlsaXR5X2xldmVsID0gJCR7KytwYXJhbUNvdW50fWA7XG4gICAgICAgIHZhbHVlcy5wdXNoKHZpc2liaWxpdHlfbGV2ZWwpO1xuICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICBpZiAoY29udGVudF90eXBlKSB7XG4gICAgICAgIHF1ZXJ5ICs9IGAgQU5EIGQuY29udGVudF90eXBlID0gJCR7KytwYXJhbUNvdW50fWA7XG4gICAgICAgIHZhbHVlcy5wdXNoKGNvbnRlbnRfdHlwZSk7XG4gICAgICB9XG4gICAgICAgICAgICBcbiAgICAgIGlmIChsYW5ndWFnZSkge1xuICAgICAgICBxdWVyeSArPSBgIEFORCBkLmxhbmd1YWdlID0gJCR7KytwYXJhbUNvdW50fWA7XG4gICAgICAgIHZhbHVlcy5wdXNoKGxhbmd1YWdlKTtcbiAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgcXVlcnkgKz0gYCBPUkRFUiBCWSByYW5rIERFU0MsIGQuY3JlYXRlZF9hdCBERVNDIExJTUlUICQkeysrcGFyYW1Db3VudH0gT0ZGU0VUICQkeysrcGFyYW1Db3VudH1gO1xuICAgICAgdmFsdWVzLnB1c2gobGltaXQsIG9mZnNldCk7XG4gICAgICAgICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnkocXVlcnksIHZhbHVlcyk7XG4gICAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHNlYXJjaCBkb2N1bWVudHMnLCB7IGVycm9yOiBlcnJvci5tZXNzYWdlLCBzZWFyY2hUZXJtLCBvcHRpb25zIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAgICogR2V0IGRvY3VtZW50cyBieSBzb3VyY2VcbiAgICAgKi9cbiAgYXN5bmMgZmluZEJ5U291cmNlKHNvdXJjZV9pZCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgeyBsaW1pdCA9IDEwMCwgb2Zmc2V0ID0gMCwgb3JkZXIgPSAnY3JlYXRlZF9hdCBERVNDJyB9ID0gb3B0aW9ucztcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgICAgICAgICBTRUxFQ1QgZC4qLCBkdi52aXNpYmlsaXR5X2xldmVsLCBkdi5hY2Nlc3NfZ3JvdXBzXG4gICAgICAgICAgICAgICAgRlJPTSBkb2N1bWVudHMgZFxuICAgICAgICAgICAgICAgIExFRlQgSk9JTiBkb2N1bWVudF92aXNpYmlsaXR5IGR2IE9OIGQuaWQgPSBkdi5kb2N1bWVudF9pZFxuICAgICAgICAgICAgICAgIFdIRVJFIGQuc291cmNlX2lkID0gJDFcbiAgICAgICAgICAgICAgICBPUkRFUiBCWSAke29yZGVyfVxuICAgICAgICAgICAgICAgIExJTUlUICQyIE9GRlNFVCAkM1xuICAgICAgICAgICAgYDtcbiAgICAgICAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeShxdWVyeSwgW3NvdXJjZV9pZCwgbGltaXQsIG9mZnNldF0pO1xuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBmaW5kIGRvY3VtZW50cyBieSBzb3VyY2UnLCB7IGVycm9yOiBlcnJvci5tZXNzYWdlLCBzb3VyY2VfaWQgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAgKiBVcGRhdGUgZG9jdW1lbnRcbiAgICAgKi9cbiAgYXN5bmMgdXBkYXRlKGlkLCB1cGRhdGVEYXRhKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpZWxkcyA9IFtdO1xuICAgICAgY29uc3QgdmFsdWVzID0gW107XG4gICAgICBsZXQgcGFyYW1Db3VudCA9IDA7XG5cbiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHVwZGF0ZURhdGEpKSB7XG4gICAgICAgIGlmIChrZXkgPT09ICdtZXRhZGF0YScpIHtcbiAgICAgICAgICBmaWVsZHMucHVzaChgJHtrZXl9ID0gJCR7KytwYXJhbUNvdW50fWApO1xuICAgICAgICAgIHZhbHVlcy5wdXNoKEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZmllbGRzLnB1c2goYCR7a2V5fSA9ICQkeysrcGFyYW1Db3VudH1gKTtcbiAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBmaWVsZHMgdG8gdXBkYXRlJyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgICAgICAgICAgIFVQREFURSBkb2N1bWVudHMgXG4gICAgICAgICAgICAgICAgU0VUICR7ZmllbGRzLmpvaW4oJywgJyl9LCB1cGRhdGVkX2F0ID0gTk9XKClcbiAgICAgICAgICAgICAgICBXSEVSRSBpZCA9ICQkeysrcGFyYW1Db3VudH1cbiAgICAgICAgICAgICAgICBSRVRVUk5JTkcgKlxuICAgICAgICAgICAgYDtcbiAgICAgIHZhbHVlcy5wdXNoKGlkKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeShxdWVyeSwgdmFsdWVzKTtcbiAgICAgICAgICAgIFxuICAgICAgaWYgKHJlc3VsdC5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvY3VtZW50IG5vdCBmb3VuZCcpO1xuICAgICAgfVxuXG4gICAgICBsb2dnZXIuaW5mbygnRG9jdW1lbnQgdXBkYXRlZCcsIHsgZG9jdW1lbnRfaWQ6IGlkIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgZG9jdW1lbnQnLCB7IGVycm9yOiBlcnJvci5tZXNzYWdlLCBpZCwgdXBkYXRlRGF0YSB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgICAqIERlbGV0ZSBkb2N1bWVudFxuICAgICAqL1xuICBhc3luYyBkZWxldGUoaWQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcXVlcnkgPSAnREVMRVRFIEZST00gZG9jdW1lbnRzIFdIRVJFIGlkID0gJDEgUkVUVVJOSU5HIGlkJztcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnkocXVlcnksIFtpZF0pO1xuICAgICAgICAgICAgXG4gICAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRG9jdW1lbnQgbm90IGZvdW5kJyk7XG4gICAgICB9XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdEb2N1bWVudCBkZWxldGVkJywgeyBkb2N1bWVudF9pZDogaWQgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIGRvY3VtZW50JywgeyBlcnJvcjogZXJyb3IubWVzc2FnZSwgaWQgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAgKiBHZXQgZG9jdW1lbnRzIHBlbmRpbmcgcmV2aWV3XG4gICAgICovXG4gIGFzeW5jIGZpbmRQZW5kaW5nUmV2aWV3KG9wdGlvbnMgPSB7fSkge1xuICAgIGNvbnN0IHsgbGltaXQgPSA1MCwgb2Zmc2V0ID0gMCB9ID0gb3B0aW9ucztcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgICAgICAgICBTRUxFQ1QgZC4qLCBkdi52aXNpYmlsaXR5X2xldmVsXG4gICAgICAgICAgICAgICAgRlJPTSBkb2N1bWVudHMgZFxuICAgICAgICAgICAgICAgIExFRlQgSk9JTiBkb2N1bWVudF92aXNpYmlsaXR5IGR2IE9OIGQuaWQgPSBkdi5kb2N1bWVudF9pZFxuICAgICAgICAgICAgICAgIExFRlQgSk9JTiBkb2N1bWVudF9yZXZpZXdzIGRyIE9OIGQuaWQgPSBkci5kb2N1bWVudF9pZFxuICAgICAgICAgICAgICAgIFdIRVJFIGRyLmlkIElTIE5VTExcbiAgICAgICAgICAgICAgICBPUkRFUiBCWSBkLmNyZWF0ZWRfYXQgQVNDXG4gICAgICAgICAgICAgICAgTElNSVQgJDEgT0ZGU0VUICQyXG4gICAgICAgICAgICBgO1xuICAgICAgICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLnF1ZXJ5KHF1ZXJ5LCBbbGltaXQsIG9mZnNldF0pO1xuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBmaW5kIGRvY3VtZW50cyBwZW5kaW5nIHJldmlldycsIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAgKiBHZXQgZG9jdW1lbnQgc3RhdGlzdGljc1xuICAgICAqL1xuICBhc3luYyBnZXRTdGF0cygpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcXVlcmllcyA9IFtcbiAgICAgICAgeyBrZXk6ICd0b3RhbCcsIHF1ZXJ5OiAnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gZG9jdW1lbnRzJyB9LFxuICAgICAgICB7IGtleTogJ2J5X3Zpc2liaWxpdHknLCBxdWVyeTogYFxuICAgICAgICAgICAgICAgICAgICBTRUxFQ1QgZHYudmlzaWJpbGl0eV9sZXZlbCwgQ09VTlQoKikgYXMgY291bnRcbiAgICAgICAgICAgICAgICAgICAgRlJPTSBkb2N1bWVudHMgZFxuICAgICAgICAgICAgICAgICAgICBMRUZUIEpPSU4gZG9jdW1lbnRfdmlzaWJpbGl0eSBkdiBPTiBkLmlkID0gZHYuZG9jdW1lbnRfaWRcbiAgICAgICAgICAgICAgICAgICAgR1JPVVAgQlkgZHYudmlzaWJpbGl0eV9sZXZlbFxuICAgICAgICAgICAgICAgIGAgfSxcbiAgICAgICAgeyBrZXk6ICdieV9jb250ZW50X3R5cGUnLCBxdWVyeTogYFxuICAgICAgICAgICAgICAgICAgICBTRUxFQ1QgY29udGVudF90eXBlLCBDT1VOVCgqKSBhcyBjb3VudFxuICAgICAgICAgICAgICAgICAgICBGUk9NIGRvY3VtZW50c1xuICAgICAgICAgICAgICAgICAgICBHUk9VUCBCWSBjb250ZW50X3R5cGVcbiAgICAgICAgICAgICAgICAgICAgT1JERVIgQlkgY291bnQgREVTQ1xuICAgICAgICAgICAgICAgIGAgfSxcbiAgICAgICAgeyBrZXk6ICdyZWNlbnQnLCBxdWVyeTogYFxuICAgICAgICAgICAgICAgICAgICBTRUxFQ1QgQ09VTlQoKikgYXMgY291bnRcbiAgICAgICAgICAgICAgICAgICAgRlJPTSBkb2N1bWVudHNcbiAgICAgICAgICAgICAgICAgICAgV0hFUkUgY3JlYXRlZF9hdCA+IE5PVygpIC0gSU5URVJWQUwgJzI0IGhvdXJzJ1xuICAgICAgICAgICAgICAgIGAgfVxuICAgICAgXTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSB7fTtcbiAgICAgICAgICAgIFxuICAgICAgZm9yIChjb25zdCB7IGtleSwgcXVlcnkgfSBvZiBxdWVyaWVzKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIucXVlcnkocXVlcnkpO1xuICAgICAgICBpZiAoa2V5ID09PSAndG90YWwnIHx8IGtleSA9PT0gJ3JlY2VudCcpIHtcbiAgICAgICAgICBzdGF0c1trZXldID0gcGFyc2VJbnQocmVzdWx0LnJvd3NbMF0uY291bnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0YXRzW2tleV0gPSByZXN1bHQucm93cztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3RhdHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBkb2N1bWVudCBzdGF0cycsIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAgKiBCdWxrIGNyZWF0ZSBkb2N1bWVudHNcbiAgICAgKi9cbiAgYXN5bmMgYnVsa0NyZWF0ZShkb2N1bWVudHMpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgXG4gICAgICBhd2FpdCB0aGlzLmRiLnRyYW5zYWN0aW9uKGFzeW5jIChjbGllbnQpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBkb2Mgb2YgZG9jdW1lbnRzKSB7XG4gICAgICAgICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICAgICAgICAgICAgICAgICAgICBJTlNFUlQgSU5UTyBkb2N1bWVudHMgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZV9pZCwgZXh0ZXJuYWxfaWQsIHRpdGxlLCBjb250ZW50LCBjb250ZW50X3R5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLCBtZXRhZGF0YSwgaGFzaCwgd29yZF9jb3VudCwgbGFuZ3VhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5LCAkMTApXG4gICAgICAgICAgICAgICAgICAgICAgICBSRVRVUk5JTkcgKlxuICAgICAgICAgICAgICAgICAgICBgO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBbXG4gICAgICAgICAgICBkb2Muc291cmNlX2lkLCBkb2MuZXh0ZXJuYWxfaWQsIGRvYy50aXRsZSwgZG9jLmNvbnRlbnQsXG4gICAgICAgICAgICBkb2MuY29udGVudF90eXBlIHx8ICd0ZXh0L3BsYWluJywgZG9jLnVybCxcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGRvYy5tZXRhZGF0YSB8fCB7fSksIGRvYy5oYXNoLFxuICAgICAgICAgICAgZG9jLndvcmRfY291bnQsIGRvYy5sYW5ndWFnZVxuICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5xdWVyeShxdWVyeSwgdmFsdWVzKTtcbiAgICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0LnJvd3NbMF0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgbG9nZ2VyLmluZm8oJ0J1bGsgZG9jdW1lbnQgY3JlYXRpb24gY29tcGxldGVkJywgeyBjb3VudDogcmVzdWx0cy5sZW5ndGggfSk7XG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gYnVsayBjcmVhdGUgZG9jdW1lbnRzJywgeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IERvY3VtZW50REFPO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQzs7QUFFekM7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsV0FBVyxDQUFDO0VBQ2hCQyxXQUFXQSxDQUFDQyxlQUFlLEVBQUU7SUFDM0IsSUFBSSxDQUFDQyxFQUFFLEdBQUdELGVBQWU7RUFDM0I7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsTUFBTUUsTUFBTUEsQ0FBQ0MsWUFBWSxFQUFFO0lBQ3pCLE1BQU07TUFDSkMsU0FBUztNQUNUQyxXQUFXO01BQ1hDLEtBQUs7TUFDTEMsT0FBTztNQUNQQyxZQUFZLEdBQUcsWUFBWTtNQUMzQkMsR0FBRztNQUNIQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO01BQ2JDLElBQUk7TUFDSkMsVUFBVTtNQUNWQztJQUNGLENBQUMsR0FBR1YsWUFBWTtJQUVoQixJQUFJO01BQ0YsTUFBTVcsS0FBSyxHQUFHO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO01BRVAsTUFBTUMsTUFBTSxHQUFHLENBQ2JYLFNBQVMsRUFBRUMsV0FBVyxFQUFFQyxLQUFLLEVBQUVDLE9BQU8sRUFBRUMsWUFBWSxFQUNwREMsR0FBRyxFQUFFTyxJQUFJLENBQUNDLFNBQVMsQ0FBQ1AsUUFBUSxDQUFDLEVBQUVDLElBQUksRUFBRUMsVUFBVSxFQUFFQyxRQUFRLENBQzFEO01BRUQsTUFBTUssTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDakIsRUFBRSxDQUFDYSxLQUFLLENBQUNBLEtBQUssRUFBRUMsTUFBTSxDQUFDO01BQ2pEbkIsTUFBTSxDQUFDdUIsSUFBSSxDQUFDLGtCQUFrQixFQUFFO1FBQUVDLFdBQVcsRUFBRUYsTUFBTSxDQUFDRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUNDO01BQUcsQ0FBQyxDQUFDO01BRW5FLE9BQU9KLE1BQU0sQ0FBQ0csSUFBSSxDQUFD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