9f3fb770e19c9548e0f62a2811a184f6
const EventEmitter = require('events');

/**
 * Document Visibility Management System
 * Handles document visibility states, access controls, and workflow integration
 */
class VisibilityManager extends EventEmitter {
  constructor(options = {}) {
    super();
    this.options = {
      defaultVisibility: 'internal',
      allowedVisibilities: ['internal', 'external', 'restricted', 'public'],
      requireApprovalFor: ['external', 'public'],
      ...options
    };
    this.visibilityRules = new Map();
    this.accessPolicies = new Map();
    this.pendingApprovals = new Map();
  }

  /**
   * Visibility states enum
   */
  static VISIBILITY_STATES = {
    INTERNAL: 'internal',
    // Only visible to internal users
    EXTERNAL: 'external',
    // Visible to external partners
    RESTRICTED: 'restricted',
    // Requires special permissions
    PUBLIC: 'public',
    // Publicly accessible
    DRAFT: 'draft',
    // Work in progress
    ARCHIVED: 'archived' // Historical/inactive
  };

  /**
   * Access levels enum
   */
  static ACCESS_LEVELS = {
    READ: 'read',
    WRITE: 'write',
    ADMIN: 'admin',
    APPROVE: 'approve'
  };

  /**
   * Set document visibility with validation
   */
  async setDocumentVisibility(documentId, visibility, metadata = {}) {
    this._validateVisibility(visibility);
    const visibilityData = {
      documentId,
      visibility,
      previousVisibility: await this.getDocumentVisibility(documentId),
      setBy: metadata.userId || 'system',
      setAt: new Date().toISOString(),
      reason: metadata.reason || 'Manual update',
      approvalRequired: this._requiresApproval(visibility),
      metadata
    };

    // Check if approval is required
    if (visibilityData.approvalRequired) {
      return await this._requestApproval(visibilityData);
    }

    // Apply visibility immediately
    return await this._applyVisibility(visibilityData);
  }

  /**
   * Get document visibility state
   */
  async getDocumentVisibility(documentId) {
    try {
      // In a real implementation, this would query the database
      // For now, return default visibility
      return {
        documentId,
        visibility: this.options.defaultVisibility,
        setBy: 'system',
        setAt: new Date().toISOString(),
        approvalStatus: 'approved'
      };
    } catch (error) {
      this.emit('error', {
        type: 'visibility_query_failed',
        documentId,
        error: error.message
      });
      throw error;
    }
  }

  /**
   * Check if user has access to document
   */
  async checkAccess(documentId, userId, accessLevel = VisibilityManager.ACCESS_LEVELS.READ) {
    try {
      const visibility = await this.getDocumentVisibility(documentId);
      const userPermissions = await this.getUserPermissions(userId);
      return this._evaluateAccess(visibility, userPermissions, accessLevel);
    } catch (error) {
      this.emit('error', {
        type: 'access_check_failed',
        documentId,
        userId,
        error: error.message
      });
      return false;
    }
  }

  /**
   * Bulk update document visibilities
   */
  async bulkUpdateVisibility(updates, metadata = {}) {
    const results = [];
    const errors = [];
    for (const update of updates) {
      try {
        const result = await this.setDocumentVisibility(update.documentId, update.visibility, {
          ...metadata,
          ...update.metadata
        });
        results.push(result);
      } catch (error) {
        errors.push({
          documentId: update.documentId,
          error: error.message
        });
      }
    }
    this.emit('bulkUpdate', {
      successful: results.length,
      failed: errors.length,
      errors
    });
    return {
      results,
      errors
    };
  }

  /**
   * Get documents pending approval
   */
  async getPendingApprovals(filters = {}) {
    const pending = Array.from(this.pendingApprovals.values());
    let filtered = pending;
    if (filters.visibility) {
      filtered = filtered.filter(item => item.visibility === filters.visibility);
    }
    if (filters.requestedBy) {
      filtered = filtered.filter(item => item.setBy === filters.requestedBy);
    }
    if (filters.since) {
      const since = new Date(filters.since);
      filtered = filtered.filter(item => new Date(item.setAt) >= since);
    }
    return filtered.sort((a, b) => new Date(b.setAt) - new Date(a.setAt));
  }

  /**
   * Approve visibility change
   */
  async approveVisibilityChange(approvalId, approvedBy, notes = '') {
    const approval = this.pendingApprovals.get(approvalId);
    if (!approval) {
      throw new Error(`Approval request ${approvalId} not found`);
    }
    const approvalData = {
      ...approval,
      approvedBy,
      approvedAt: new Date().toISOString(),
      approvalNotes: notes,
      status: 'approved'
    };

    // Apply the visibility change
    const result = await this._applyVisibility(approvalData);

    // Remove from pending approvals
    this.pendingApprovals.delete(approvalId);
    this.emit('visibilityApproved', approvalData);
    return result;
  }

  /**
   * Reject visibility change
   */
  async rejectVisibilityChange(approvalId, rejectedBy, reason = '') {
    const approval = this.pendingApprovals.get(approvalId);
    if (!approval) {
      throw new Error(`Approval request ${approvalId} not found`);
    }
    const rejectionData = {
      ...approval,
      rejectedBy,
      rejectedAt: new Date().toISOString(),
      rejectionReason: reason,
      status: 'rejected'
    };

    // Remove from pending approvals
    this.pendingApprovals.delete(approvalId);
    this.emit('visibilityRejected', rejectionData);
    return rejectionData;
  }

  /**
   * Add visibility rule
   */
  addVisibilityRule(ruleId, rule) {
    this._validateRule(rule);
    this.visibilityRules.set(ruleId, {
      ...rule,
      createdAt: new Date().toISOString()
    });
    this.emit('ruleAdded', {
      ruleId,
      rule
    });
  }

  /**
   * Remove visibility rule
   */
  removeVisibilityRule(ruleId) {
    const removed = this.visibilityRules.delete(ruleId);
    if (removed) {
      this.emit('ruleRemoved', {
        ruleId
      });
    }
    return removed;
  }

  /**
   * Get user permissions
   */
  async getUserPermissions(userId) {
    // In a real implementation, this would query user roles/permissions
    // For now, return basic permissions
    return {
      userId,
      roles: ['reviewer'],
      permissions: [VisibilityManager.ACCESS_LEVELS.READ, VisibilityManager.ACCESS_LEVELS.WRITE],
      visibilityLevels: ['internal', 'external']
    };
  }

  /**
   * Apply visibility rules to document
   */
  async applyVisibilityRules(documentId, documentMetadata) {
    const applicableRules = this._findApplicableRules(documentMetadata);
    if (applicableRules.length === 0) {
      return this.options.defaultVisibility;
    }

    // Apply rules in priority order
    const sortedRules = applicableRules.sort((a, b) => (b.priority || 0) - (a.priority || 0));
    for (const rule of sortedRules) {
      if (this._evaluateRuleConditions(rule, documentMetadata)) {
        this.emit('ruleApplied', {
          documentId,
          ruleId: rule.id,
          visibility: rule.visibility
        });
        return rule.visibility;
      }
    }
    return this.options.defaultVisibility;
  }

  /**
   * Private methods
   */

  _validateVisibility(visibility) {
    if (!this.options.allowedVisibilities.includes(visibility)) {
      throw new Error(`Invalid visibility: ${visibility}. Allowed: ${this.options.allowedVisibilities.join(', ')}`);
    }
  }
  _requiresApproval(visibility) {
    return this.options.requireApprovalFor.includes(visibility);
  }
  async _requestApproval(visibilityData) {
    const approvalId = `approval_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    const approvalRequest = {
      ...visibilityData,
      approvalId,
      status: 'pending',
      requestedAt: new Date().toISOString()
    };
    this.pendingApprovals.set(approvalId, approvalRequest);
    this.emit('approvalRequested', approvalRequest);
    return {
      success: true,
      approvalId,
      status: 'pending_approval',
      message: `Visibility change to '${visibilityData.visibility}' requires approval`
    };
  }
  async _applyVisibility(visibilityData) {
    try {
      // In a real implementation, this would update the database
      // For now, emit the change event

      this.emit('visibilityChanged', {
        documentId: visibilityData.documentId,
        oldVisibility: visibilityData.previousVisibility?.visibility,
        newVisibility: visibilityData.visibility,
        changedBy: visibilityData.setBy,
        changedAt: visibilityData.setAt,
        reason: visibilityData.reason
      });
      return {
        success: true,
        documentId: visibilityData.documentId,
        visibility: visibilityData.visibility,
        appliedAt: new Date().toISOString()
      };
    } catch (error) {
      this.emit('error', {
        type: 'visibility_apply_failed',
        documentId: visibilityData.documentId,
        error: error.message
      });
      throw error;
    }
  }
  _evaluateAccess(visibility, userPermissions, accessLevel) {
    // Check if user has required access level
    if (!userPermissions.permissions.includes(accessLevel)) {
      return false;
    }

    // Check if user can access this visibility level
    if (!userPermissions.visibilityLevels.includes(visibility.visibility)) {
      return false;
    }
    return true;
  }
  _validateRule(rule) {
    if (!rule.conditions || !rule.visibility) {
      throw new Error('Rule must have conditions and visibility');
    }
    this._validateVisibility(rule.visibility);
  }
  _findApplicableRules(documentMetadata) {
    return Array.from(this.visibilityRules.values()).filter(rule => {
      return this._ruleMatchesDocument(rule, documentMetadata);
    });
  }
  _ruleMatchesDocument(rule, documentMetadata) {
    // Simple rule matching - can be extended for complex conditions
    if (rule.conditions.sourceType && documentMetadata.sourceType !== rule.conditions.sourceType) {
      return false;
    }
    if (rule.conditions.fileType && documentMetadata.fileType !== rule.conditions.fileType) {
      return false;
    }
    if (rule.conditions.tags && rule.conditions.tags.length > 0) {
      const documentTags = documentMetadata.tags || [];
      const hasRequiredTags = rule.conditions.tags.every(tag => documentTags.includes(tag));
      if (!hasRequiredTags) {
        return false;
      }
    }
    return true;
  }
  _evaluateRuleConditions(rule, documentMetadata) {
    // Additional condition evaluation logic
    // For now, if the rule matches the document, conditions are met
    return true;
  }
}
module.exports = VisibilityManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJyZXF1aXJlIiwiVmlzaWJpbGl0eU1hbmFnZXIiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJkZWZhdWx0VmlzaWJpbGl0eSIsImFsbG93ZWRWaXNpYmlsaXRpZXMiLCJyZXF1aXJlQXBwcm92YWxGb3IiLCJ2aXNpYmlsaXR5UnVsZXMiLCJNYXAiLCJhY2Nlc3NQb2xpY2llcyIsInBlbmRpbmdBcHByb3ZhbHMiLCJWSVNJQklMSVRZX1NUQVRFUyIsIklOVEVSTkFMIiwiRVhURVJOQUwiLCJSRVNUUklDVEVEIiwiUFVCTElDIiwiRFJBRlQiLCJBUkNISVZFRCIsIkFDQ0VTU19MRVZFTFMiLCJSRUFEIiwiV1JJVEUiLCJBRE1JTiIsIkFQUFJPVkUiLCJzZXREb2N1bWVudFZpc2liaWxpdHkiLCJkb2N1bWVudElkIiwidmlzaWJpbGl0eSIsIm1ldGFkYXRhIiwiX3ZhbGlkYXRlVmlzaWJpbGl0eSIsInZpc2liaWxpdHlEYXRhIiwicHJldmlvdXNWaXNpYmlsaXR5IiwiZ2V0RG9jdW1lbnRWaXNpYmlsaXR5Iiwic2V0QnkiLCJ1c2VySWQiLCJzZXRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInJlYXNvbiIsImFwcHJvdmFsUmVxdWlyZWQiLCJfcmVxdWlyZXNBcHByb3ZhbCIsIl9yZXF1ZXN0QXBwcm92YWwiLCJfYXBwbHlWaXNpYmlsaXR5IiwiYXBwcm92YWxTdGF0dXMiLCJlcnJvciIsImVtaXQiLCJ0eXBlIiwibWVzc2FnZSIsImNoZWNrQWNjZXNzIiwiYWNjZXNzTGV2ZWwiLCJ1c2VyUGVybWlzc2lvbnMiLCJnZXRVc2VyUGVybWlzc2lvbnMiLCJfZXZhbHVhdGVBY2Nlc3MiLCJidWxrVXBkYXRlVmlzaWJpbGl0eSIsInVwZGF0ZXMiLCJyZXN1bHRzIiwiZXJyb3JzIiwidXBkYXRlIiwicmVzdWx0IiwicHVzaCIsInN1Y2Nlc3NmdWwiLCJsZW5ndGgiLCJmYWlsZWQiLCJnZXRQZW5kaW5nQXBwcm92YWxzIiwiZmlsdGVycyIsInBlbmRpbmciLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJmaWx0ZXJlZCIsImZpbHRlciIsIml0ZW0iLCJyZXF1ZXN0ZWRCeSIsInNpbmNlIiwic29ydCIsImEiLCJiIiwiYXBwcm92ZVZpc2liaWxpdHlDaGFuZ2UiLCJhcHByb3ZhbElkIiwiYXBwcm92ZWRCeSIsIm5vdGVzIiwiYXBwcm92YWwiLCJnZXQiLCJFcnJvciIsImFwcHJvdmFsRGF0YSIsImFwcHJvdmVkQXQiLCJhcHByb3ZhbE5vdGVzIiwic3RhdHVzIiwiZGVsZXRlIiwicmVqZWN0VmlzaWJpbGl0eUNoYW5nZSIsInJlamVjdGVkQnkiLCJyZWplY3Rpb25EYXRhIiwicmVqZWN0ZWRBdCIsInJlamVjdGlvblJlYXNvbiIsImFkZFZpc2liaWxpdHlSdWxlIiwicnVsZUlkIiwicnVsZSIsIl92YWxpZGF0ZVJ1bGUiLCJzZXQiLCJjcmVhdGVkQXQiLCJyZW1vdmVWaXNpYmlsaXR5UnVsZSIsInJlbW92ZWQiLCJyb2xlcyIsInBlcm1pc3Npb25zIiwidmlzaWJpbGl0eUxldmVscyIsImFwcGx5VmlzaWJpbGl0eVJ1bGVzIiwiZG9jdW1lbnRNZXRhZGF0YSIsImFwcGxpY2FibGVSdWxlcyIsIl9maW5kQXBwbGljYWJsZVJ1bGVzIiwic29ydGVkUnVsZXMiLCJwcmlvcml0eSIsIl9ldmFsdWF0ZVJ1bGVDb25kaXRpb25zIiwiaWQiLCJpbmNsdWRlcyIsImpvaW4iLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJhcHByb3ZhbFJlcXVlc3QiLCJyZXF1ZXN0ZWRBdCIsInN1Y2Nlc3MiLCJvbGRWaXNpYmlsaXR5IiwibmV3VmlzaWJpbGl0eSIsImNoYW5nZWRCeSIsImNoYW5nZWRBdCIsImFwcGxpZWRBdCIsImNvbmRpdGlvbnMiLCJfcnVsZU1hdGNoZXNEb2N1bWVudCIsInNvdXJjZVR5cGUiLCJmaWxlVHlwZSIsInRhZ3MiLCJkb2N1bWVudFRhZ3MiLCJoYXNSZXF1aXJlZFRhZ3MiLCJldmVyeSIsInRhZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJWaXNpYmlsaXR5TWFuYWdlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKTtcblxuLyoqXG4gKiBEb2N1bWVudCBWaXNpYmlsaXR5IE1hbmFnZW1lbnQgU3lzdGVtXG4gKiBIYW5kbGVzIGRvY3VtZW50IHZpc2liaWxpdHkgc3RhdGVzLCBhY2Nlc3MgY29udHJvbHMsIGFuZCB3b3JrZmxvdyBpbnRlZ3JhdGlvblxuICovXG5jbGFzcyBWaXNpYmlsaXR5TWFuYWdlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgIHN1cGVyKCk7XG4gICAgXG4gICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgZGVmYXVsdFZpc2liaWxpdHk6ICdpbnRlcm5hbCcsXG4gICAgICBhbGxvd2VkVmlzaWJpbGl0aWVzOiBbJ2ludGVybmFsJywgJ2V4dGVybmFsJywgJ3Jlc3RyaWN0ZWQnLCAncHVibGljJ10sXG4gICAgICByZXF1aXJlQXBwcm92YWxGb3I6IFsnZXh0ZXJuYWwnLCAncHVibGljJ10sXG4gICAgICAuLi5vcHRpb25zXG4gICAgfTtcblxuICAgIHRoaXMudmlzaWJpbGl0eVJ1bGVzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuYWNjZXNzUG9saWNpZXMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5wZW5kaW5nQXBwcm92YWxzID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZpc2liaWxpdHkgc3RhdGVzIGVudW1cbiAgICovXG4gIHN0YXRpYyBWSVNJQklMSVRZX1NUQVRFUyA9IHtcbiAgICBJTlRFUk5BTDogJ2ludGVybmFsJywgICAgIC8vIE9ubHkgdmlzaWJsZSB0byBpbnRlcm5hbCB1c2Vyc1xuICAgIEVYVEVSTkFMOiAnZXh0ZXJuYWwnLCAgICAgLy8gVmlzaWJsZSB0byBleHRlcm5hbCBwYXJ0bmVyc1xuICAgIFJFU1RSSUNURUQ6ICdyZXN0cmljdGVkJywgLy8gUmVxdWlyZXMgc3BlY2lhbCBwZXJtaXNzaW9uc1xuICAgIFBVQkxJQzogJ3B1YmxpYycsICAgICAgICAgLy8gUHVibGljbHkgYWNjZXNzaWJsZVxuICAgIERSQUZUOiAnZHJhZnQnLCAgICAgICAgICAvLyBXb3JrIGluIHByb2dyZXNzXG4gICAgQVJDSElWRUQ6ICdhcmNoaXZlZCcgICAgICAvLyBIaXN0b3JpY2FsL2luYWN0aXZlXG4gIH07XG5cbiAgLyoqXG4gICAqIEFjY2VzcyBsZXZlbHMgZW51bVxuICAgKi9cbiAgc3RhdGljIEFDQ0VTU19MRVZFTFMgPSB7XG4gICAgUkVBRDogJ3JlYWQnLFxuICAgIFdSSVRFOiAnd3JpdGUnLFxuICAgIEFETUlOOiAnYWRtaW4nLFxuICAgIEFQUFJPVkU6ICdhcHByb3ZlJ1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXQgZG9jdW1lbnQgdmlzaWJpbGl0eSB3aXRoIHZhbGlkYXRpb25cbiAgICovXG4gIGFzeW5jIHNldERvY3VtZW50VmlzaWJpbGl0eShkb2N1bWVudElkLCB2aXNpYmlsaXR5LCBtZXRhZGF0YSA9IHt9KSB7XG4gICAgdGhpcy5fdmFsaWRhdGVWaXNpYmlsaXR5KHZpc2liaWxpdHkpO1xuXG4gICAgY29uc3QgdmlzaWJpbGl0eURhdGEgPSB7XG4gICAgICBkb2N1bWVudElkLFxuICAgICAgdmlzaWJpbGl0eSxcbiAgICAgIHByZXZpb3VzVmlzaWJpbGl0eTogYXdhaXQgdGhpcy5nZXREb2N1bWVudFZpc2liaWxpdHkoZG9jdW1lbnRJZCksXG4gICAgICBzZXRCeTogbWV0YWRhdGEudXNlcklkIHx8ICdzeXN0ZW0nLFxuICAgICAgc2V0QXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHJlYXNvbjogbWV0YWRhdGEucmVhc29uIHx8ICdNYW51YWwgdXBkYXRlJyxcbiAgICAgIGFwcHJvdmFsUmVxdWlyZWQ6IHRoaXMuX3JlcXVpcmVzQXBwcm92YWwodmlzaWJpbGl0eSksXG4gICAgICBtZXRhZGF0YVxuICAgIH07XG5cbiAgICAvLyBDaGVjayBpZiBhcHByb3ZhbCBpcyByZXF1aXJlZFxuICAgIGlmICh2aXNpYmlsaXR5RGF0YS5hcHByb3ZhbFJlcXVpcmVkKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5fcmVxdWVzdEFwcHJvdmFsKHZpc2liaWxpdHlEYXRhKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSB2aXNpYmlsaXR5IGltbWVkaWF0ZWx5XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuX2FwcGx5VmlzaWJpbGl0eSh2aXNpYmlsaXR5RGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGRvY3VtZW50IHZpc2liaWxpdHkgc3RhdGVcbiAgICovXG4gIGFzeW5jIGdldERvY3VtZW50VmlzaWJpbGl0eShkb2N1bWVudElkKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBxdWVyeSB0aGUgZGF0YWJhc2VcbiAgICAgIC8vIEZvciBub3csIHJldHVybiBkZWZhdWx0IHZpc2liaWxpdHlcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgIHZpc2liaWxpdHk6IHRoaXMub3B0aW9ucy5kZWZhdWx0VmlzaWJpbGl0eSxcbiAgICAgICAgc2V0Qnk6ICdzeXN0ZW0nLFxuICAgICAgICBzZXRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBhcHByb3ZhbFN0YXR1czogJ2FwcHJvdmVkJ1xuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIHsgXG4gICAgICAgIHR5cGU6ICd2aXNpYmlsaXR5X3F1ZXJ5X2ZhaWxlZCcsIFxuICAgICAgICBkb2N1bWVudElkLCBcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgXG4gICAgICB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gZG9jdW1lbnRcbiAgICovXG4gIGFzeW5jIGNoZWNrQWNjZXNzKGRvY3VtZW50SWQsIHVzZXJJZCwgYWNjZXNzTGV2ZWwgPSBWaXNpYmlsaXR5TWFuYWdlci5BQ0NFU1NfTEVWRUxTLlJFQUQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdmlzaWJpbGl0eSA9IGF3YWl0IHRoaXMuZ2V0RG9jdW1lbnRWaXNpYmlsaXR5KGRvY3VtZW50SWQpO1xuICAgICAgY29uc3QgdXNlclBlcm1pc3Npb25zID0gYXdhaXQgdGhpcy5nZXRVc2VyUGVybWlzc2lvbnModXNlcklkKTtcblxuICAgICAgcmV0dXJuIHRoaXMuX2V2YWx1YXRlQWNjZXNzKHZpc2liaWxpdHksIHVzZXJQZXJtaXNzaW9ucywgYWNjZXNzTGV2ZWwpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmVtaXQoJ2Vycm9yJywgeyBcbiAgICAgICAgdHlwZTogJ2FjY2Vzc19jaGVja19mYWlsZWQnLCBcbiAgICAgICAgZG9jdW1lbnRJZCwgXG4gICAgICAgIHVzZXJJZCwgXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJ1bGsgdXBkYXRlIGRvY3VtZW50IHZpc2liaWxpdGllc1xuICAgKi9cbiAgYXN5bmMgYnVsa1VwZGF0ZVZpc2liaWxpdHkodXBkYXRlcywgbWV0YWRhdGEgPSB7fSkge1xuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICBjb25zdCBlcnJvcnMgPSBbXTtcblxuICAgIGZvciAoY29uc3QgdXBkYXRlIG9mIHVwZGF0ZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc2V0RG9jdW1lbnRWaXNpYmlsaXR5KFxuICAgICAgICAgIHVwZGF0ZS5kb2N1bWVudElkLCBcbiAgICAgICAgICB1cGRhdGUudmlzaWJpbGl0eSwgXG4gICAgICAgICAgeyAuLi5tZXRhZGF0YSwgLi4udXBkYXRlLm1ldGFkYXRhIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBlcnJvcnMucHVzaCh7XG4gICAgICAgICAgZG9jdW1lbnRJZDogdXBkYXRlLmRvY3VtZW50SWQsXG4gICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5lbWl0KCdidWxrVXBkYXRlJywgeyBcbiAgICAgIHN1Y2Nlc3NmdWw6IHJlc3VsdHMubGVuZ3RoLCBcbiAgICAgIGZhaWxlZDogZXJyb3JzLmxlbmd0aCwgXG4gICAgICBlcnJvcnMgXG4gICAgfSk7XG5cbiAgICByZXR1cm4geyByZXN1bHRzLCBlcnJvcnMgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZG9jdW1lbnRzIHBlbmRpbmcgYXBwcm92YWxcbiAgICovXG4gIGFzeW5jIGdldFBlbmRpbmdBcHByb3ZhbHMoZmlsdGVycyA9IHt9KSB7XG4gICAgY29uc3QgcGVuZGluZyA9IEFycmF5LmZyb20odGhpcy5wZW5kaW5nQXBwcm92YWxzLnZhbHVlcygpKTtcbiAgICBcbiAgICBsZXQgZmlsdGVyZWQgPSBwZW5kaW5nO1xuICAgIFxuICAgIGlmIChmaWx0ZXJzLnZpc2liaWxpdHkpIHtcbiAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQuZmlsdGVyKGl0ZW0gPT4gaXRlbS52aXNpYmlsaXR5ID09PSBmaWx0ZXJzLnZpc2liaWxpdHkpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZmlsdGVycy5yZXF1ZXN0ZWRCeSkge1xuICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC5maWx0ZXIoaXRlbSA9PiBpdGVtLnNldEJ5ID09PSBmaWx0ZXJzLnJlcXVlc3RlZEJ5KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGZpbHRlcnMuc2luY2UpIHtcbiAgICAgIGNvbnN0IHNpbmNlID0gbmV3IERhdGUoZmlsdGVycy5zaW5jZSk7XG4gICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLmZpbHRlcihpdGVtID0+IG5ldyBEYXRlKGl0ZW0uc2V0QXQpID49IHNpbmNlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmlsdGVyZWQuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5zZXRBdCkgLSBuZXcgRGF0ZShhLnNldEF0KSk7XG4gIH1cblxuICAvKipcbiAgICogQXBwcm92ZSB2aXNpYmlsaXR5IGNoYW5nZVxuICAgKi9cbiAgYXN5bmMgYXBwcm92ZVZpc2liaWxpdHlDaGFuZ2UoYXBwcm92YWxJZCwgYXBwcm92ZWRCeSwgbm90ZXMgPSAnJykge1xuICAgIGNvbnN0IGFwcHJvdmFsID0gdGhpcy5wZW5kaW5nQXBwcm92YWxzLmdldChhcHByb3ZhbElkKTtcbiAgICBcbiAgICBpZiAoIWFwcHJvdmFsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFwcHJvdmFsIHJlcXVlc3QgJHthcHByb3ZhbElkfSBub3QgZm91bmRgKTtcbiAgICB9XG5cbiAgICBjb25zdCBhcHByb3ZhbERhdGEgPSB7XG4gICAgICAuLi5hcHByb3ZhbCxcbiAgICAgIGFwcHJvdmVkQnksXG4gICAgICBhcHByb3ZlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBhcHByb3ZhbE5vdGVzOiBub3RlcyxcbiAgICAgIHN0YXR1czogJ2FwcHJvdmVkJ1xuICAgIH07XG5cbiAgICAvLyBBcHBseSB0aGUgdmlzaWJpbGl0eSBjaGFuZ2VcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9hcHBseVZpc2liaWxpdHkoYXBwcm92YWxEYXRhKTtcbiAgICBcbiAgICAvLyBSZW1vdmUgZnJvbSBwZW5kaW5nIGFwcHJvdmFsc1xuICAgIHRoaXMucGVuZGluZ0FwcHJvdmFscy5kZWxldGUoYXBwcm92YWxJZCk7XG5cbiAgICB0aGlzLmVtaXQoJ3Zpc2liaWxpdHlBcHByb3ZlZCcsIGFwcHJvdmFsRGF0YSk7XG4gICAgXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWplY3QgdmlzaWJpbGl0eSBjaGFuZ2VcbiAgICovXG4gIGFzeW5jIHJlamVjdFZpc2liaWxpdHlDaGFuZ2UoYXBwcm92YWxJZCwgcmVqZWN0ZWRCeSwgcmVhc29uID0gJycpIHtcbiAgICBjb25zdCBhcHByb3ZhbCA9IHRoaXMucGVuZGluZ0FwcHJvdmFscy5nZXQoYXBwcm92YWxJZCk7XG4gICAgXG4gICAgaWYgKCFhcHByb3ZhbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBcHByb3ZhbCByZXF1ZXN0ICR7YXBwcm92YWxJZH0gbm90IGZvdW5kYCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVqZWN0aW9uRGF0YSA9IHtcbiAgICAgIC4uLmFwcHJvdmFsLFxuICAgICAgcmVqZWN0ZWRCeSxcbiAgICAgIHJlamVjdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHJlamVjdGlvblJlYXNvbjogcmVhc29uLFxuICAgICAgc3RhdHVzOiAncmVqZWN0ZWQnXG4gICAgfTtcblxuICAgIC8vIFJlbW92ZSBmcm9tIHBlbmRpbmcgYXBwcm92YWxzXG4gICAgdGhpcy5wZW5kaW5nQXBwcm92YWxzLmRlbGV0ZShhcHByb3ZhbElkKTtcblxuICAgIHRoaXMuZW1pdCgndmlzaWJpbGl0eVJlamVjdGVkJywgcmVqZWN0aW9uRGF0YSk7XG4gICAgXG4gICAgcmV0dXJuIHJlamVjdGlvbkRhdGE7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHZpc2liaWxpdHkgcnVsZVxuICAgKi9cbiAgYWRkVmlzaWJpbGl0eVJ1bGUocnVsZUlkLCBydWxlKSB7XG4gICAgdGhpcy5fdmFsaWRhdGVSdWxlKHJ1bGUpO1xuICAgIHRoaXMudmlzaWJpbGl0eVJ1bGVzLnNldChydWxlSWQsIHtcbiAgICAgIC4uLnJ1bGUsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH0pO1xuICAgIFxuICAgIHRoaXMuZW1pdCgncnVsZUFkZGVkJywgeyBydWxlSWQsIHJ1bGUgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIHZpc2liaWxpdHkgcnVsZVxuICAgKi9cbiAgcmVtb3ZlVmlzaWJpbGl0eVJ1bGUocnVsZUlkKSB7XG4gICAgY29uc3QgcmVtb3ZlZCA9IHRoaXMudmlzaWJpbGl0eVJ1bGVzLmRlbGV0ZShydWxlSWQpO1xuICAgIGlmIChyZW1vdmVkKSB7XG4gICAgICB0aGlzLmVtaXQoJ3J1bGVSZW1vdmVkJywgeyBydWxlSWQgfSk7XG4gICAgfVxuICAgIHJldHVybiByZW1vdmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB1c2VyIHBlcm1pc3Npb25zXG4gICAqL1xuICBhc3luYyBnZXRVc2VyUGVybWlzc2lvbnModXNlcklkKSB7XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHF1ZXJ5IHVzZXIgcm9sZXMvcGVybWlzc2lvbnNcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gYmFzaWMgcGVybWlzc2lvbnNcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcklkLFxuICAgICAgcm9sZXM6IFsncmV2aWV3ZXInXSxcbiAgICAgIHBlcm1pc3Npb25zOiBbXG4gICAgICAgIFZpc2liaWxpdHlNYW5hZ2VyLkFDQ0VTU19MRVZFTFMuUkVBRCxcbiAgICAgICAgVmlzaWJpbGl0eU1hbmFnZXIuQUNDRVNTX0xFVkVMUy5XUklURVxuICAgICAgXSxcbiAgICAgIHZpc2liaWxpdHlMZXZlbHM6IFsnaW50ZXJuYWwnLCAnZXh0ZXJuYWwnXVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQXBwbHkgdmlzaWJpbGl0eSBydWxlcyB0byBkb2N1bWVudFxuICAgKi9cbiAgYXN5bmMgYXBwbHlWaXNpYmlsaXR5UnVsZXMoZG9jdW1lbnRJZCwgZG9jdW1lbnRNZXRhZGF0YSkge1xuICAgIGNvbnN0IGFwcGxpY2FibGVSdWxlcyA9IHRoaXMuX2ZpbmRBcHBsaWNhYmxlUnVsZXMoZG9jdW1lbnRNZXRhZGF0YSk7XG4gICAgXG4gICAgaWYgKGFwcGxpY2FibGVSdWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZGVmYXVsdFZpc2liaWxpdHk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgcnVsZXMgaW4gcHJpb3JpdHkgb3JkZXJcbiAgICBjb25zdCBzb3J0ZWRSdWxlcyA9IGFwcGxpY2FibGVSdWxlcy5zb3J0KChhLCBiKSA9PiAoYi5wcmlvcml0eSB8fCAwKSAtIChhLnByaW9yaXR5IHx8IDApKTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IHJ1bGUgb2Ygc29ydGVkUnVsZXMpIHtcbiAgICAgIGlmICh0aGlzLl9ldmFsdWF0ZVJ1bGVDb25kaXRpb25zKHJ1bGUsIGRvY3VtZW50TWV0YWRhdGEpKSB7XG4gICAgICAgIHRoaXMuZW1pdCgncnVsZUFwcGxpZWQnLCB7IFxuICAgICAgICAgIGRvY3VtZW50SWQsIFxuICAgICAgICAgIHJ1bGVJZDogcnVsZS5pZCwgXG4gICAgICAgICAgdmlzaWJpbGl0eTogcnVsZS52aXNpYmlsaXR5IFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBydWxlLnZpc2liaWxpdHk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5kZWZhdWx0VmlzaWJpbGl0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIG1ldGhvZHNcbiAgICovXG5cbiAgX3ZhbGlkYXRlVmlzaWJpbGl0eSh2aXNpYmlsaXR5KSB7XG4gICAgaWYgKCF0aGlzLm9wdGlvbnMuYWxsb3dlZFZpc2liaWxpdGllcy5pbmNsdWRlcyh2aXNpYmlsaXR5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHZpc2liaWxpdHk6ICR7dmlzaWJpbGl0eX0uIEFsbG93ZWQ6ICR7dGhpcy5vcHRpb25zLmFsbG93ZWRWaXNpYmlsaXRpZXMuam9pbignLCAnKX1gKTtcbiAgICB9XG4gIH1cblxuICBfcmVxdWlyZXNBcHByb3ZhbCh2aXNpYmlsaXR5KSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yZXF1aXJlQXBwcm92YWxGb3IuaW5jbHVkZXModmlzaWJpbGl0eSk7XG4gIH1cblxuICBhc3luYyBfcmVxdWVzdEFwcHJvdmFsKHZpc2liaWxpdHlEYXRhKSB7XG4gICAgY29uc3QgYXBwcm92YWxJZCA9IGBhcHByb3ZhbF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG4gICAgXG4gICAgY29uc3QgYXBwcm92YWxSZXF1ZXN0ID0ge1xuICAgICAgLi4udmlzaWJpbGl0eURhdGEsXG4gICAgICBhcHByb3ZhbElkLFxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcblxuICAgIHRoaXMucGVuZGluZ0FwcHJvdmFscy5zZXQoYXBwcm92YWxJZCwgYXBwcm92YWxSZXF1ZXN0KTtcbiAgICBcbiAgICB0aGlzLmVtaXQoJ2FwcHJvdmFsUmVxdWVzdGVkJywgYXBwcm92YWxSZXF1ZXN0KTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGFwcHJvdmFsSWQsXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nX2FwcHJvdmFsJyxcbiAgICAgIG1lc3NhZ2U6IGBWaXNpYmlsaXR5IGNoYW5nZSB0byAnJHt2aXNpYmlsaXR5RGF0YS52aXNpYmlsaXR5fScgcmVxdWlyZXMgYXBwcm92YWxgXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIF9hcHBseVZpc2liaWxpdHkodmlzaWJpbGl0eURhdGEpIHtcbiAgICB0cnkge1xuICAgICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHVwZGF0ZSB0aGUgZGF0YWJhc2VcbiAgICAgIC8vIEZvciBub3csIGVtaXQgdGhlIGNoYW5nZSBldmVudFxuICAgICAgXG4gICAgICB0aGlzLmVtaXQoJ3Zpc2liaWxpdHlDaGFuZ2VkJywge1xuICAgICAgICBkb2N1bWVudElkOiB2aXNpYmlsaXR5RGF0YS5kb2N1bWVudElkLFxuICAgICAgICBvbGRWaXNpYmlsaXR5OiB2aXNpYmlsaXR5RGF0YS5wcmV2aW91c1Zpc2liaWxpdHk/LnZpc2liaWxpdHksXG4gICAgICAgIG5ld1Zpc2liaWxpdHk6IHZpc2liaWxpdHlEYXRhLnZpc2liaWxpdHksXG4gICAgICAgIGNoYW5nZWRCeTogdmlzaWJpbGl0eURhdGEuc2V0QnksXG4gICAgICAgIGNoYW5nZWRBdDogdmlzaWJpbGl0eURhdGEuc2V0QXQsXG4gICAgICAgIHJlYXNvbjogdmlzaWJpbGl0eURhdGEucmVhc29uXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZG9jdW1lbnRJZDogdmlzaWJpbGl0eURhdGEuZG9jdW1lbnRJZCxcbiAgICAgICAgdmlzaWJpbGl0eTogdmlzaWJpbGl0eURhdGEudmlzaWJpbGl0eSxcbiAgICAgICAgYXBwbGllZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCB7IFxuICAgICAgICB0eXBlOiAndmlzaWJpbGl0eV9hcHBseV9mYWlsZWQnLCBcbiAgICAgICAgZG9jdW1lbnRJZDogdmlzaWJpbGl0eURhdGEuZG9jdW1lbnRJZCwgXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIFxuICAgICAgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBfZXZhbHVhdGVBY2Nlc3ModmlzaWJpbGl0eSwgdXNlclBlcm1pc3Npb25zLCBhY2Nlc3NMZXZlbCkge1xuICAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIHJlcXVpcmVkIGFjY2VzcyBsZXZlbFxuICAgIGlmICghdXNlclBlcm1pc3Npb25zLnBlcm1pc3Npb25zLmluY2x1ZGVzKGFjY2Vzc0xldmVsKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHVzZXIgY2FuIGFjY2VzcyB0aGlzIHZpc2liaWxpdHkgbGV2ZWxcbiAgICBpZiAoIXVzZXJQZXJtaXNzaW9ucy52aXNpYmlsaXR5TGV2ZWxzLmluY2x1ZGVzKHZpc2liaWxpdHkudmlzaWJpbGl0eSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIF92YWxpZGF0ZVJ1bGUocnVsZSkge1xuICAgIGlmICghcnVsZS5jb25kaXRpb25zIHx8ICFydWxlLnZpc2liaWxpdHkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUnVsZSBtdXN0IGhhdmUgY29uZGl0aW9ucyBhbmQgdmlzaWJpbGl0eScpO1xuICAgIH1cbiAgICBcbiAgICB0aGlzLl92YWxpZGF0ZVZpc2liaWxpdHkocnVsZS52aXNpYmlsaXR5KTtcbiAgfVxuXG4gIF9maW5kQXBwbGljYWJsZVJ1bGVzKGRvY3VtZW50TWV0YWRhdGEpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnZpc2liaWxpdHlSdWxlcy52YWx1ZXMoKSkuZmlsdGVyKHJ1bGUgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuX3J1bGVNYXRjaGVzRG9jdW1lbnQocnVsZSwgZG9jdW1lbnRNZXRhZGF0YSk7XG4gICAgfSk7XG4gIH1cblxuICBfcnVsZU1hdGNoZXNEb2N1bWVudChydWxlLCBkb2N1bWVudE1ldGFkYXRhKSB7XG4gICAgLy8gU2ltcGxlIHJ1bGUgbWF0Y2hpbmcgLSBjYW4gYmUgZXh0ZW5kZWQgZm9yIGNvbXBsZXggY29uZGl0aW9uc1xuICAgIGlmIChydWxlLmNvbmRpdGlvbnMuc291cmNlVHlwZSAmJiBkb2N1bWVudE1ldGFkYXRhLnNvdXJjZVR5cGUgIT09IHJ1bGUuY29uZGl0aW9ucy5zb3VyY2VUeXBlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIGlmIChydWxlLmNvbmRpdGlvbnMuZmlsZVR5cGUgJiYgZG9jdW1lbnRNZXRhZGF0YS5maWxlVHlwZSAhPT0gcnVsZS5jb25kaXRpb25zLmZpbGVUeXBlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIGlmIChydWxlLmNvbmRpdGlvbnMudGFncyAmJiBydWxlLmNvbmRpdGlvbnMudGFncy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBkb2N1bWVudFRhZ3MgPSBkb2N1bWVudE1ldGFkYXRhLnRhZ3MgfHwgW107XG4gICAgICBjb25zdCBoYXNSZXF1aXJlZFRhZ3MgPSBydWxlLmNvbmRpdGlvbnMudGFncy5ldmVyeSh0YWcgPT4gZG9jdW1lbnRUYWdzLmluY2x1ZGVzKHRhZykpO1xuICAgICAgaWYgKCFoYXNSZXF1aXJlZFRhZ3MpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgX2V2YWx1YXRlUnVsZUNvbmRpdGlvbnMocnVsZSwgZG9jdW1lbnRNZXRhZGF0YSkge1xuICAgIC8vIEFkZGl0aW9uYWwgY29uZGl0aW9uIGV2YWx1YXRpb24gbG9naWNcbiAgICAvLyBGb3Igbm93LCBpZiB0aGUgcnVsZSBtYXRjaGVzIHRoZSBkb2N1bWVudCwgY29uZGl0aW9ucyBhcmUgbWV0XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBWaXNpYmlsaXR5TWFuYWdlcjtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsWUFBWSxHQUFHQyxPQUFPLENBQUMsUUFBUSxDQUFDOztBQUV0QztBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLGlCQUFpQixTQUFTRixZQUFZLENBQUM7RUFDM0NHLFdBQVdBLENBQUNDLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRTtJQUN4QixLQUFLLENBQUMsQ0FBQztJQUVQLElBQUksQ0FBQ0EsT0FBTyxHQUFHO01BQ2JDLGlCQUFpQixFQUFFLFVBQVU7TUFDN0JDLG1CQUFtQixFQUFFLENBQUMsVUFBVSxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUFDO01BQ3JFQyxrQkFBa0IsRUFBRSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUM7TUFDMUMsR0FBR0g7SUFDTCxDQUFDO0lBRUQsSUFBSSxDQUFDSSxlQUFlLEdBQUcsSUFBSUMsR0FBRyxDQUFDLENBQUM7SUFDaEMsSUFBSSxDQUFDQyxjQUFjLEdBQUcsSUFBSUQsR0FBRyxDQUFDLENBQUM7SUFDL0IsSUFBSSxDQUFDRSxnQkFBZ0IsR0FBRyxJQUFJRixHQUFHLENBQUMsQ0FBQztFQUNuQzs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxPQUFPRyxpQkFBaUIsR0FBRztJQUN6QkMsUUFBUSxFQUFFLFVBQVU7SUFBTTtJQUMxQkMsUUFBUSxFQUFFLFVBQVU7SUFBTTtJQUMxQkMsVUFBVSxFQUFFLFlBQVk7SUFBRTtJQUMxQkMsTUFBTSxFQUFFLFFBQVE7SUFBVTtJQUMxQkMsS0FBSyxFQUFFLE9BQU87SUFBVztJQUN6QkMsUUFBUSxFQUFFLFVBQVUsQ0FBTTtFQUM1QixDQUFDOztFQUVEO0FBQ0Y7QUFDQTtFQUNFLE9BQU9DLGFBQWEsR0FBRztJQUNyQkMsSUFBSSxFQUFFLE1BQU07SUFDWkMsS0FBSyxFQUFFLE9BQU87SUFDZEMsS0FBSyxFQUFFLE9BQU87SUFDZEMsT0FBTyxFQUFFO0VBQ1gsQ0FBQzs7RUFFRDtBQUNGO0FBQ0E7RUFDRSxNQUFNQyxxQkFBcUJBLENBQUNDLFVBQVUsRUFBRUMsVUFBVSxFQUFFQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDakUsSUFBSSxDQUFDQyxtQkFBbUIsQ0FBQ0YsVUFBVSxDQUFDO0lBRXBDLE1BQU1HLGNBQWMsR0FBRztNQUNyQkosVUFBVTtNQUNWQyxVQUFVO01BQ1ZJLGtCQUFrQixFQUFFLE1BQU0sSUFBSSxDQUFDQyxxQkFBcUIsQ0FBQ04sVUFBVSxDQUFDO01BQ2hFTyxLQUFLLEVBQUVMLFFBQVEsQ0FBQ00sTUFBTSxJQUFJLFFBQVE7TUFDbENDLEtBQUssRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUMsQ0FBQztNQUMvQkMsTUFBTSxFQUFFVixRQUFRLENBQUNVLE1BQU0sSUFBSSxlQUFlO01BQzFDQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUNDLGlCQUFpQixDQUFDYixVQUFVLENBQUM7TUFDcERDO0lBQ0YsQ0FBQzs7SUFFRDtJQUNBLElBQUlFLGNBQWMsQ0FBQ1MsZ0JBQWdCLEVBQUU7TUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQ0UsZ0JBQWdCLENBQUNYLGNBQWMsQ0FBQztJQUNwRDs7SUFFQTtJQUNBLE9BQU8sTUFBTSxJQUFJLENBQUNZLGdCQUFnQixDQUFDWixjQUFjLENBQUM7RUFDcEQ7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsTUFBTUUscUJBQXFCQSxDQUFDTixVQUFVLEVBQUU7SUFDdEMsSUFBSTtNQUNGO01BQ0E7TUFDQSxPQUFPO1FBQ0xBLFVBQVU7UUFDVkMsVUFBVSxFQUFFLElBQUksQ0FBQ3RCLE9BQU8sQ0FBQ0MsaUJBQWlCO1FBQzFDMkIsS0FBSyxFQUFFLFFBQVE7UUFDZkUsS0FBSyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxDQUFDO1FBQy9CTSxjQUFjLEVBQUU7TUFDbEIsQ0FBQztJQUNILENBQUMsQ0FBQyxPQUFPQyxLQUFLLEVBQUU7TUFDZCxJQUFJLENBQUNDLElBQUksQ0FBQyxPQUFPLEVBQUU7UUFDakJDLElBQUksRUFBRSx5QkFBeUI7UUFDL0JwQixVQUFVO1FBQ1ZrQixLQUFLLEVBQUVBLEtBQUssQ0FBQ0c7TUFDZixDQUFDLENBQUM7TUFDRixNQUFNSCxLQUFLO0lBQ2I7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFNSSxXQUFXQSxDQUFDdEIsVUFBVSxFQUFFUSxNQUFNLEVBQUVlLFdBQVcsR0FBRzlDLGlCQUFpQixDQUFDaUIsYUFBYSxDQUFDQyxJQUFJLEVBQUU7SUFDeEYsSUFBSTtNQUNGLE1BQU1NLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQ0sscUJBQXFCLENBQUNOLFVBQVUsQ0FBQztNQUMvRCxNQUFNd0IsZUFBZSxHQUFHLE1BQU0sSUFBSSxDQUFDQyxrQkFBa0IsQ0FBQ2pCLE1BQU0sQ0FBQztNQUU3RCxPQUFPLElBQUksQ0FBQ2tCLGVBQWUsQ0FBQ3pCLFVBQVUsRUFBRXVCLGVBQWUsRUFBRUQsV0FBVyxDQUFDO0lBQ3ZFLENBQUMsQ0FBQyxPQUFPTCxLQUFLLEVBQUU7TUFDZCxJQUFJLENBQUNDLElBQUksQ0FBQyxPQUFPLEVBQUU7UUFDakJDLElBQUksRUFBRSxxQkFBcUI7UUFDM0JwQixVQUFVO1FBQ1ZRLE1BQU07UUFDTlUsS0FBSyxFQUFFQSxLQUFLLENBQUNHO01BQ2YsQ0FBQyxDQUFDO01BQ0YsT0FBTyxLQUFLO0lBQ2Q7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFNTSxvQkFBb0JBLENBQUNDLE9BQU8sRUFBRTFCLFFBQVEsR0FBRyxDQUFDLENBQUMsRUFBRTtJQUNqRCxNQUFNMkIsT0FBTyxHQUFHLEVBQUU7SUFDbEIsTUFBTUMsTUFBTSxHQUFHLEVBQUU7SUFFakIsS0FBSyxNQUFNQyxNQUFNLElBQUlILE9BQU8sRUFBRTtNQUM1QixJQUFJO1FBQ0YsTUFBTUksTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDakMscUJBQXFCLENBQzdDZ0MsTUFBTSxDQUFDL0IsVUFBVSxFQUNqQitCLE1BQU0sQ0FBQzlCLFVBQVUsRUFDakI7VUFBRSxHQUFHQyxRQUFRO1VBQUUsR0FBRzZCLE1BQU0sQ0FBQzdCO1FBQVMsQ0FDcEMsQ0FBQztRQUNEMkIsT0FBTyxDQUFDSSxJQUFJLENBQUNELE1BQU0sQ0FBQztNQUN0QixDQUFDLENBQUMsT0FBT2QsS0FBSyxFQUFFO1FBQ2RZLE1BQU0sQ0FBQ0csSUFBSSxDQUFDO1VBQ1ZqQyxVQUFVLEVBQUUrQixNQUFNLENBQUMvQixVQUFVO1VBQzdCa0IsS0FBSyxFQUFFQSxLQUFLLENBQUNHO1FBQ2YsQ0FBQyxDQUFDO01BQ0o7SUFDRjtJQUVBLElBQUksQ0FBQ0YsSUFBSSxDQUFDLFlBQVksRUFBRTtNQUN0QmUsVUFBVSxFQUFFTCxPQUFPLENBQUNNLE1BQU07TUFDMUJDLE1BQU0sRUFBRU4sTUFBTSxDQUFDSyxNQUFNO01BQ3JCTDtJQUNGLENBQUMsQ0FBQztJQUVGLE9BQU87TUFBRUQsT0FBTztNQUFFQztJQUFPLENBQUM7RUFDNUI7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsTUFBTU8sbUJBQW1CQSxDQUFDQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDdEMsTUFBTUMsT0FBTyxHQUFHQyxLQUFLLENBQUNDLElBQUksQ0FBQyxJQUFJLENBQUN2RCxnQkFBZ0IsQ0FBQ3dELE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFFMUQsSUFBSUMsUUFBUSxHQUFHSixPQUFPO0lBRXRCLElBQUlELE9BQU8sQ0FBQ3JDLFVBQVUsRUFBRTtNQUN0QjBDLFFBQVEsR0FBR0EsUUFBUSxDQUFDQyxNQUFNLENBQUNDLElBQUksSUFBSUEsSUFBSSxDQUFDNUMsVUFBVSxLQUFLcUMsT0FBTyxDQUFDckMsVUFBVSxDQUFDO0lBQzVFO0lBRUEsSUFBSXFDLE9BQU8sQ0FBQ1EsV0FBVyxFQUFFO01BQ3ZCSCxRQUFRLEdBQUdBLFFBQVEsQ0FBQ0MsTUFBTSxDQUFDQyxJQUFJLElBQUlBLElBQUksQ0FBQ3RDLEtBQUssS0FBSytCLE9BQU8sQ0FBQ1EsV0FBVyxDQUFDO0lBQ3hFO0lBRUEsSUFBSVIsT0FBTyxDQUFDUyxLQUFLLEVBQUU7TUFDakIsTUFBTUEsS0FBSyxHQUFHLElBQUlyQyxJQUFJLENBQUM0QixPQUFPLENBQUNTLEtBQUssQ0FBQztNQUNyQ0osUUFBUSxHQUFHQSxRQUFRLENBQUNDLE1BQU0sQ0FBQ0MsSUFBSSxJQUFJLElBQUluQyxJQUFJLENBQUNtQyxJQUFJLENBQUNwQyxLQUFLLENBQUMsSUFBSXNDLEtBQUssQ0FBQztJQUNuRTtJQUVBLE9BQU9KLFFBQVEsQ0FBQ0ssSUFBSSxDQUFDLENBQUNDLENBQUMsRUFBRUMsQ0FBQyxLQUFLLElBQUl4QyxJQUFJLENBQUN3QyxDQUFDLENBQUN6QyxLQUFLLENBQUMsR0FBRyxJQUFJQyxJQUFJLENBQUN1QyxDQUFDLENBQUN4QyxLQUFLLENBQUMsQ0FBQztFQUN2RTs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFNMEMsdUJBQXVCQSxDQUFDQyxVQUFVLEVBQUVDLFVBQVUsRUFBRUMsS0FBSyxHQUFHLEVBQUUsRUFBRTtJQUNoRSxNQUFNQyxRQUFRLEdBQUcsSUFBSSxDQUFDckUsZ0JBQWdCLENBQUNzRSxHQUFHLENBQUNKLFVBQVUsQ0FBQztJQUV0RCxJQUFJLENBQUNHLFFBQVEsRUFBRTtNQUNiLE1BQU0sSUFBSUUsS0FBSyxDQUFDLG9CQUFvQkwsVUFBVSxZQUFZLENBQUM7SUFDN0Q7SUFFQSxNQUFNTSxZQUFZLEdBQUc7TUFDbkIsR0FBR0gsUUFBUTtNQUNYRixVQUFVO01BQ1ZNLFVBQVUsRUFBRSxJQUFJakQsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7TUFDcENpRCxhQUFhLEVBQUVOLEtBQUs7TUFDcEJPLE1BQU0sRUFBRTtJQUNWLENBQUM7O0lBRUQ7SUFDQSxNQUFNN0IsTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDaEIsZ0JBQWdCLENBQUMwQyxZQUFZLENBQUM7O0lBRXhEO0lBQ0EsSUFBSSxDQUFDeEUsZ0JBQWdCLENBQUM0RSxNQUFNLENBQUNWLFVBQVUsQ0FBQztJQUV4QyxJQUFJLENBQUNqQyxJQUFJLENBQUMsb0JBQW9CLEVBQUV1QyxZQUFZLENBQUM7SUFFN0MsT0FBTzFCLE1BQU07RUFDZjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFNK0Isc0JBQXNCQSxDQUFDWCxVQUFVLEVBQUVZLFVBQVUsRUFBRXBELE1BQU0sR0FBRyxFQUFFLEVBQUU7SUFDaEUsTUFBTTJDLFFBQVEsR0FBRyxJQUFJLENBQUNyRSxnQkFBZ0IsQ0FBQ3NFLEdBQUcsQ0FBQ0osVUFBVSxDQUFDO0lBRXRELElBQUksQ0FBQ0csUUFBUSxFQUFFO01BQ2IsTUFBTSxJQUFJRSxLQUFLLENBQUMsb0JBQW9CTCxVQUFVLFlBQVksQ0FBQztJQUM3RDtJQUVBLE1BQU1hLGFBQWEsR0FBRztNQUNwQixHQUFHVixRQUFRO01BQ1hTLFVBQVU7TUFDVkUsVUFBVSxFQUFFLElBQUl4RCxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUMsQ0FBQztNQUNwQ3dELGVBQWUsRUFBRXZELE1BQU07TUFDdkJpRCxNQUFNLEVBQUU7SUFDVixDQUFDOztJQUVEO0lBQ0EsSUFBSSxDQUFDM0UsZ0JBQWdCLENBQUM0RSxNQUFNLENBQUNWLFVBQVUsQ0FBQztJQUV4QyxJQUFJLENBQUNqQyxJQUFJLENBQUMsb0JBQW9CLEVBQUU4QyxhQUFhLENBQUM7SUFFOUMsT0FBT0EsYUFBYTtFQUN0Qjs7RUFFQTtBQUNGO0FBQ0E7RUFDRUcsaUJBQWlCQSxDQUFDQyxNQUFNLEVBQUVDLElBQUksRUFBRTtJQUM5QixJQUFJLENBQUNDLGFBQWEsQ0FBQ0QsSUFBSSxDQUFDO0lBQ3hCLElBQUksQ0FBQ3ZGLGVBQWUsQ0FBQ3lGLEdBQUcsQ0FBQ0gsTUFBTSxFQUFFO01BQy9CLEdBQUdDLElBQUk7TUFDUEcsU0FBUyxFQUFFLElBQUkvRCxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0lBRUYsSUFBSSxDQUFDUSxJQUFJLENBQUMsV0FBVyxFQUFFO01BQUVrRCxNQUFNO01BQUVDO0lBQUssQ0FBQyxDQUFDO0VBQzFDOztFQUVBO0FBQ0Y7QUFDQTtFQUNFSSxvQkFBb0JBLENBQUNMLE1BQU0sRUFBRTtJQUMzQixNQUFNTSxPQUFPLEdBQUcsSUFBSSxDQUFDNUYsZUFBZSxDQUFDK0UsTUFBTSxDQUFDTyxNQUFNLENBQUM7SUFDbkQsSUFBSU0sT0FBTyxFQUFFO01BQ1gsSUFBSSxDQUFDeEQsSUFBSSxDQUFDLGFBQWEsRUFBRTtRQUFFa0Q7TUFBTyxDQUFDLENBQUM7SUFDdEM7SUFDQSxPQUFPTSxPQUFPO0VBQ2hCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLE1BQU1sRCxrQkFBa0JBLENBQUNqQixNQUFNLEVBQUU7SUFDL0I7SUFDQTtJQUNBLE9BQU87TUFDTEEsTUFBTTtNQUNOb0UsS0FBSyxFQUFFLENBQUMsVUFBVSxDQUFDO01BQ25CQyxXQUFXLEVBQUUsQ0FDWHBHLGlCQUFpQixDQUFDaUIsYUFBYSxDQUFDQyxJQUFJLEVBQ3BDbEIsaUJBQWlCLENBQUNpQixhQUFhLENBQUNFLEtBQUssQ0FDdEM7TUFDRGtGLGdCQUFnQixFQUFFLENBQUMsVUFBVSxFQUFFLFVBQVU7SUFDM0MsQ0FBQztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLE1BQU1DLG9CQUFvQkEsQ0FBQy9FLFVBQVUsRUFBRWdGLGdCQUFnQixFQUFFO0lBQ3ZELE1BQU1DLGVBQWUsR0FBRyxJQUFJLENBQUNDLG9CQUFvQixDQUFDRixnQkFBZ0IsQ0FBQztJQUVuRSxJQUFJQyxlQUFlLENBQUM5QyxNQUFNLEtBQUssQ0FBQyxFQUFFO01BQ2hDLE9BQU8sSUFBSSxDQUFDeEQsT0FBTyxDQUFDQyxpQkFBaUI7SUFDdkM7O0lBRUE7SUFDQSxNQUFNdUcsV0FBVyxHQUFHRixlQUFlLENBQUNqQyxJQUFJLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEtBQUssQ0FBQ0EsQ0FBQyxDQUFDa0MsUUFBUSxJQUFJLENBQUMsS0FBS25DLENBQUMsQ0FBQ21DLFFBQVEsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUV6RixLQUFLLE1BQU1kLElBQUksSUFBSWEsV0FBVyxFQUFFO01BQzlCLElBQUksSUFBSSxDQUFDRSx1QkFBdUIsQ0FBQ2YsSUFBSSxFQUFFVSxnQkFBZ0IsQ0FBQyxFQUFFO1FBQ3hELElBQUksQ0FBQzdELElBQUksQ0FBQyxhQUFhLEVBQUU7VUFDdkJuQixVQUFVO1VBQ1ZxRSxNQUFNLEVBQUVDLElBQUksQ0FBQ2dCLEVBQUU7VUFDZnJGLFVBQVUsRUFBRXFFLElBQUksQ0FBQ3JFO1FBQ25CLENBQUMsQ0FBQztRQUVGLE9BQU9xRSxJQUFJLENBQUNyRSxVQUFVO01BQ3hCO0lBQ0Y7SUFFQSxPQUFPLElBQUksQ0FBQ3RCLE9BQU8sQ0FBQ0MsaUJBQWlCO0VBQ3ZDOztFQUVBO0FBQ0Y7QUFDQTs7RUFFRXVCLG1CQUFtQkEsQ0FBQ0YsVUFBVSxFQUFFO0lBQzlCLElBQUksQ0FBQyxJQUFJLENBQUN0QixPQUFPLENBQUNFLG1CQUFtQixDQUFDMEcsUUFBUSxDQUFDdEYsVUFBVSxDQUFDLEVBQUU7TUFDMUQsTUFBTSxJQUFJd0QsS0FBSyxDQUFDLHVCQUF1QnhELFVBQVUsY0FBYyxJQUFJLENBQUN0QixPQUFPLENBQUNFLG1CQUFtQixDQUFDMkcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDL0c7RUFDRjtFQUVBMUUsaUJBQWlCQSxDQUFDYixVQUFVLEVBQUU7SUFDNUIsT0FBTyxJQUFJLENBQUN0QixPQUFPLENBQUNHLGtCQUFrQixDQUFDeUcsUUFBUSxDQUFDdEYsVUFBVSxDQUFDO0VBQzdEO0VBRUEsTUFBTWMsZ0JBQWdCQSxDQUFDWCxjQUFjLEVBQUU7SUFDckMsTUFBTWdELFVBQVUsR0FBRyxZQUFZMUMsSUFBSSxDQUFDK0UsR0FBRyxDQUFDLENBQUMsSUFBSUMsSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUNDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7SUFFdEYsTUFBTUMsZUFBZSxHQUFHO01BQ3RCLEdBQUcxRixjQUFjO01BQ2pCZ0QsVUFBVTtNQUNWUyxNQUFNLEVBQUUsU0FBUztNQUNqQmtDLFdBQVcsRUFBRSxJQUFJckYsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxJQUFJLENBQUN6QixnQkFBZ0IsQ0FBQ3NGLEdBQUcsQ0FBQ3BCLFVBQVUsRUFBRTBDLGVBQWUsQ0FBQztJQUV0RCxJQUFJLENBQUMzRSxJQUFJLENBQUMsbUJBQW1CLEVBQUUyRSxlQUFlLENBQUM7SUFFL0MsT0FBTztNQUNMRSxPQUFPLEVBQUUsSUFBSTtNQUNiNUMsVUFBVTtNQUNWUyxNQUFNLEVBQUUsa0JBQWtCO01BQzFCeEMsT0FBTyxFQUFFLHlCQUF5QmpCLGNBQWMsQ0FBQ0gsVUFBVTtJQUM3RCxDQUFDO0VBQ0g7RUFFQSxNQUFNZSxnQkFBZ0JBLENBQUNaLGNBQWMsRUFBRTtJQUNyQyxJQUFJO01BQ0Y7TUFDQTs7TUFFQSxJQUFJLENBQUNlLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtRQUM3Qm5CLFVBQVUsRUFBRUksY0FBYyxDQUFDSixVQUFVO1FBQ3JDaUcsYUFBYSxFQUFFN0YsY0FBYyxDQUFDQyxrQkFBa0IsRUFBRUosVUFBVTtRQUM1RGlHLGFBQWEsRUFBRTlGLGNBQWMsQ0FBQ0gsVUFBVTtRQUN4Q2tHLFNBQVMsRUFBRS9GLGNBQWMsQ0FBQ0csS0FBSztRQUMvQjZGLFNBQVMsRUFBRWhHLGNBQWMsQ0FBQ0ssS0FBSztRQUMvQkcsTUFBTSxFQUFFUixjQUFjLENBQUNRO01BQ3pCLENBQUMsQ0FBQztNQUVGLE9BQU87UUFDTG9GLE9BQU8sRUFBRSxJQUFJO1FBQ2JoRyxVQUFVLEVBQUVJLGNBQWMsQ0FBQ0osVUFBVTtRQUNyQ0MsVUFBVSxFQUFFRyxjQUFjLENBQUNILFVBQVU7UUFDckNvRyxTQUFTLEVBQUUsSUFBSTNGLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztNQUNwQyxDQUFDO0lBQ0gsQ0FBQyxDQUFDLE9BQU9PLEtBQUssRUFBRTtNQUNkLElBQUksQ0FBQ0MsSUFBSSxDQUFDLE9BQU8sRUFBRTtRQUNqQkMsSUFBSSxFQUFFLHlCQUF5QjtRQUMvQnBCLFVBQVUsRUFBRUksY0FBYyxDQUFDSixVQUFVO1FBQ3JDa0IsS0FBSyxFQUFFQSxLQUFLLENBQUNHO01BQ2YsQ0FBQyxDQUFDO01BQ0YsTUFBTUgsS0FBSztJQUNiO0VBQ0Y7RUFFQVEsZUFBZUEsQ0FBQ3pCLFVBQVUsRUFBRXVCLGVBQWUsRUFBRUQsV0FBVyxFQUFFO0lBQ3hEO0lBQ0EsSUFBSSxDQUFDQyxlQUFlLENBQUNxRCxXQUFXLENBQUNVLFFBQVEsQ0FBQ2hFLFdBQVcsQ0FBQyxFQUFFO01BQ3RELE9BQU8sS0FBSztJQUNkOztJQUVBO0lBQ0EsSUFBSSxDQUFDQyxlQUFlLENBQUNzRCxnQkFBZ0IsQ0FBQ1MsUUFBUSxDQUFDdEYsVUFBVSxDQUFDQSxVQUFVLENBQUMsRUFBRTtNQUNyRSxPQUFPLEtBQUs7SUFDZDtJQUVBLE9BQU8sSUFBSTtFQUNiO0VBRUFzRSxhQUFhQSxDQUFDRCxJQUFJLEVBQUU7SUFDbEIsSUFBSSxDQUFDQSxJQUFJLENBQUNnQyxVQUFVLElBQUksQ0FBQ2hDLElBQUksQ0FBQ3JFLFVBQVUsRUFBRTtNQUN4QyxNQUFNLElBQUl3RCxLQUFLLENBQUMsMENBQTBDLENBQUM7SUFDN0Q7SUFFQSxJQUFJLENBQUN0RCxtQkFBbUIsQ0FBQ21FLElBQUksQ0FBQ3JFLFVBQVUsQ0FBQztFQUMzQztFQUVBaUYsb0JBQW9CQSxDQUFDRixnQkFBZ0IsRUFBRTtJQUNyQyxPQUFPeEMsS0FBSyxDQUFDQyxJQUFJLENBQUMsSUFBSSxDQUFDMUQsZUFBZSxDQUFDMkQsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDRSxNQUFNLENBQUMwQixJQUFJLElBQUk7TUFDOUQsT0FBTyxJQUFJLENBQUNpQyxvQkFBb0IsQ0FBQ2pDLElBQUksRUFBRVUsZ0JBQWdCLENBQUM7SUFDMUQsQ0FBQyxDQUFDO0VBQ0o7RUFFQXVCLG9CQUFvQkEsQ0FBQ2pDLElBQUksRUFBRVUsZ0JBQWdCLEVBQUU7SUFDM0M7SUFDQSxJQUFJVixJQUFJLENBQUNnQyxVQUFVLENBQUNFLFVBQVUsSUFBSXhCLGdCQUFnQixDQUFDd0IsVUFBVSxLQUFLbEMsSUFBSSxDQUFDZ0MsVUFBVSxDQUFDRSxVQUFVLEVBQUU7TUFDNUYsT0FBTyxLQUFLO0lBQ2Q7SUFFQSxJQUFJbEMsSUFBSSxDQUFDZ0MsVUFBVSxDQUFDRyxRQUFRLElBQUl6QixnQkFBZ0IsQ0FBQ3lCLFFBQVEsS0FBS25DLElBQUksQ0FBQ2dDLFVBQVUsQ0FBQ0csUUFBUSxFQUFFO01BQ3RGLE9BQU8sS0FBSztJQUNkO0lBRUEsSUFBSW5DLElBQUksQ0FBQ2dDLFVBQVUsQ0FBQ0ksSUFBSSxJQUFJcEMsSUFBSSxDQUFDZ0MsVUFBVSxDQUFDSSxJQUFJLENBQUN2RSxNQUFNLEdBQUcsQ0FBQyxFQUFFO01BQzNELE1BQU13RSxZQUFZLEdBQUczQixnQkFBZ0IsQ0FBQzBCLElBQUksSUFBSSxFQUFFO01BQ2hELE1BQU1FLGVBQWUsR0FBR3RDLElBQUksQ0FBQ2dDLFVBQVUsQ0FBQ0ksSUFBSSxDQUFDRyxLQUFLLENBQUNDLEdBQUcsSUFBSUgsWUFBWSxDQUFDcEIsUUFBUSxDQUFDdUIsR0FBRyxDQUFDLENBQUM7TUFDckYsSUFBSSxDQUFDRixlQUFlLEVBQUU7UUFDcEIsT0FBTyxLQUFLO01BQ2Q7SUFDRjtJQUVBLE9BQU8sSUFBSTtFQUNiO0VBRUF2Qix1QkFBdUJBLENBQUNmLElBQUksRUFBRVUsZ0JBQWdCLEVBQUU7SUFDOUM7SUFDQTtJQUNBLE9BQU8sSUFBSTtFQUNiO0FBQ0Y7QUFFQStCLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHdkksaUJBQWlCIiwiaWdub3JlTGlzdCI6W119